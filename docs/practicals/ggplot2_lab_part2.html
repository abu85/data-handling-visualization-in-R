<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Thanks to Roy Francis, NBIS, RaukR2023 for sharing it">
<meta name="description" content="Creating plots and graphs using the ggplot2 package.">

<title>ggplot2 Part 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href=".././scripts/00_precourse.html"> 
<span class="menu-text">Pre-course</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lectures" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lectures</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lectures">    
        <li>
    <a class="dropdown-item" href=".././slides/slides_tidyr.pdf">
 <span class="dropdown-text">tidyr lecture</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href=".././slides/slides_dplyr.pdf">
 <span class="dropdown-text">dplyr lecture</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href=".././slides/ggplot_gsvms_2026.html">
 <span class="dropdown-text">ggplot2 lecture</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lab-exercises" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lab exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lab-exercises">    
        <li>
    <a class="dropdown-item" href=".././scripts/tidyr_abs_2026.html">
 <span class="dropdown-text">tidyr practical</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href=".././scripts/dplyr_abs_2026.html">
 <span class="dropdown-text">dplyr practical</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href=".././practicals/ggplot2_lab_part1.html">
 <span class="dropdown-text">ggplot2 lab</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://swcarpentry.github.io/shell-novice/"> <i class="bi bi-softwerecarpentry" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:abu.siddique@slu.se"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">ggplot2 Part 2</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          Creating plots and graphs using the ggplot2 package.
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Thanks to Roy Francis, NBIS, RaukR2023 for sharing it </p>
            </div>
    </div>
      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#basics" id="toc-basics" class="nav-link active" data-scroll-target="#basics">Basics</a>
  <ul>
  <li><a href="#building-a-plot" id="toc-building-a-plot" class="nav-link" data-scroll-target="#building-a-plot">Building a plot</a></li>
  <li><a href="#multiple-geoms" id="toc-multiple-geoms" class="nav-link" data-scroll-target="#multiple-geoms">Multiple geoms</a></li>
  <li><a href="#using-colors" id="toc-using-colors" class="nav-link" data-scroll-target="#using-colors">Using colors</a></li>
  <li><a href="#aesthetic-parameter" id="toc-aesthetic-parameter" class="nav-link" data-scroll-target="#aesthetic-parameter">Aesthetic parameter</a></li>
  <li><a href="#aesthetic-mapping" id="toc-aesthetic-mapping" class="nav-link" data-scroll-target="#aesthetic-mapping">Aesthetic mapping</a></li>
  <li><a href="#discrete-colors" id="toc-discrete-colors" class="nav-link" data-scroll-target="#discrete-colors">Discrete colors</a></li>
  <li><a href="#continuous-colors" id="toc-continuous-colors" class="nav-link" data-scroll-target="#continuous-colors">Continuous colors</a></li>
  <li><a href="#titles" id="toc-titles" class="nav-link" data-scroll-target="#titles">Titles</a></li>
  <li><a href="#axes-modification" id="toc-axes-modification" class="nav-link" data-scroll-target="#axes-modification">Axes modification</a></li>
  <li><a href="#faceting" id="toc-faceting" class="nav-link" data-scroll-target="#faceting">Faceting</a></li>
  <li><a href="#themes" id="toc-themes" class="nav-link" data-scroll-target="#themes">Themes</a></li>
  <li><a href="#controlling-legends" id="toc-controlling-legends" class="nav-link" data-scroll-target="#controlling-legends">Controlling legends</a></li>
  <li><a href="#labelling" id="toc-labelling" class="nav-link" data-scroll-target="#labelling">Labelling</a></li>
  <li><a href="#annotations" id="toc-annotations" class="nav-link" data-scroll-target="#annotations">Annotations</a></li>
  <li><a href="#barplots" id="toc-barplots" class="nav-link" data-scroll-target="#barplots">Barplots</a></li>
  <li><a href="#flip-axes" id="toc-flip-axes" class="nav-link" data-scroll-target="#flip-axes">Flip axes</a></li>
  <li><a href="#error-bars" id="toc-error-bars" class="nav-link" data-scroll-target="#error-bars">Error Bars</a></li>
  </ul></li>
  <li><a href="#economist-scatterplot" id="toc-economist-scatterplot" class="nav-link" data-scroll-target="#economist-scatterplot">Economist Scatterplot</a>
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#points" id="toc-points" class="nav-link" data-scroll-target="#points">Points</a></li>
  <li><a href="#trendline" id="toc-trendline" class="nav-link" data-scroll-target="#trendline">Trendline</a></li>
  <li><a href="#text-labels" id="toc-text-labels" class="nav-link" data-scroll-target="#text-labels">Text Labels</a></li>
  <li><a href="#custom-font" id="toc-custom-font" class="nav-link" data-scroll-target="#custom-font">Custom Font</a></li>
  <li><a href="#label-overlap" id="toc-label-overlap" class="nav-link" data-scroll-target="#label-overlap">Label Overlap</a></li>
  <li><a href="#axes" id="toc-axes" class="nav-link" data-scroll-target="#axes">Axes</a></li>
  <li><a href="#scale-colors" id="toc-scale-colors" class="nav-link" data-scroll-target="#scale-colors">Scale Colors</a></li>
  <li><a href="#title" id="toc-title" class="nav-link" data-scroll-target="#title">Title</a></li>
  <li><a href="#theme" id="toc-theme" class="nav-link" data-scroll-target="#theme">Theme</a></li>
  </ul></li>
  <li><a href="#wsj-heatmap" id="toc-wsj-heatmap" class="nav-link" data-scroll-target="#wsj-heatmap">WSJ Heatmap</a>
  <ul>
  <li><a href="#data-1" id="toc-data-1" class="nav-link" data-scroll-target="#data-1">Data</a></li>
  <li><a href="#tidy-data" id="toc-tidy-data" class="nav-link" data-scroll-target="#tidy-data">Tidy Data</a></li>
  <li><a href="#tile" id="toc-tile" class="nav-link" data-scroll-target="#tile">Tile</a></li>
  <li><a href="#scales" id="toc-scales" class="nav-link" data-scroll-target="#scales">Scales</a></li>
  <li><a href="#title-1" id="toc-title-1" class="nav-link" data-scroll-target="#title-1">Title</a></li>
  <li><a href="#fixed-coords" id="toc-fixed-coords" class="nav-link" data-scroll-target="#fixed-coords">Fixed Coords</a></li>
  <li><a href="#annotation" id="toc-annotation" class="nav-link" data-scroll-target="#annotation">Annotation</a></li>
  <li><a href="#theme-1" id="toc-theme-1" class="nav-link" data-scroll-target="#theme-1">Theme</a>
  <ul class="collapse">
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements">Acknowledgements:</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>These are a series of exercises to help you get started and familiarize yourself with ggplot2 syntax, plot building logic and fine modification of plots. Practice using the <em>Basics</em> section and then move on to slightly more complex plots: a scatterplot and a heatmap.</p>
</div>
</div>
<p><br></p>
<div class="columns">
<div class="column" style="width:50%;">
<p><img src="assets/economist-scatterplot.png" class="img-fluid"></p>
</div><div class="column" style="width:50%;">
<p><img src="assets/wsj-heatmap.png" class="img-fluid"></p>
</div>
</div>
<p><br></p>
<section id="basics" class="level2">
<h2 class="anchored" data-anchor-id="basics">Basics</h2>
<p>First step is to make sure that the necessary packages are installed and loaded.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.4.3</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'patchwork' was built under R version 4.4.3</code></pre>
</div>
</div>
<p>We use the <code>iris</code> data to get started. This dataset has four continuous variables and one categorical variable. It is important to remember about the data type when plotting graphs.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"iris"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Sepal.Length</th>
<th style="text-align: right;">Sepal.Width</th>
<th style="text-align: right;">Petal.Length</th>
<th style="text-align: right;">Petal.Width</th>
<th style="text-align: left;">Species</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">3.5</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">setosa</td>
</tr>
<tr class="even">
<td style="text-align: right;">4.9</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">setosa</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4.7</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">1.3</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">setosa</td>
</tr>
<tr class="even">
<td style="text-align: right;">4.6</td>
<td style="text-align: right;">3.1</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">setosa</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5.0</td>
<td style="text-align: right;">3.6</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">setosa</td>
</tr>
<tr class="even">
<td style="text-align: right;">5.4</td>
<td style="text-align: right;">3.9</td>
<td style="text-align: right;">1.7</td>
<td style="text-align: right;">0.4</td>
<td style="text-align: left;">setosa</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="building-a-plot" class="level3">
<h3 class="anchored" data-anchor-id="building-a-plot">Building a plot</h3>
<p>ggplot2 plots are initialized by specifying the dataset. This can be saved to a variable or it draws a blank plot.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>Now we can specify what we want on the x and y axes using aesthetic mapping. And we specify the geometric using geoms. Note that the variable names do not have double quotes <code>""</code> like in base plots.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris)<span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="multiple-geoms" class="level3">
<h3 class="anchored" data-anchor-id="multiple-geoms">Multiple geoms</h3>
<p>Further geoms can be added. For example let’s add a regression line. When multiple geoms with the same aesthetics are used, they can be specified as a common mapping. Note that the order in which geoms are plotted depends on the order in which the geoms are supplied in the code. In the code below, the points are plotted first and then the regression line.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="using-colors" class="level3">
<h3 class="anchored" data-anchor-id="using-colors">Using colors</h3>
<p>We can use the categorical column <code>Species</code> to color the points. The color aesthetic is used by <code>geom_point</code> and <code>geom_smooth</code>. Three different regression lines are now drawn. Notice that a legend is automatically created.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width,<span class="at">color=</span>Species))<span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>If we wanted to keep a common regression line while keeping the colors for the points, we could specify color aesthetic only for <code>geom_point</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species))<span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="aesthetic-parameter" class="level3">
<h3 class="anchored" data-anchor-id="aesthetic-parameter">Aesthetic parameter</h3>
<p>We can change the size of all points by a fixed amount by specifying size outside the aesthetic parameter.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species),<span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="aesthetic-mapping" class="level3">
<h3 class="anchored" data-anchor-id="aesthetic-mapping">Aesthetic mapping</h3>
<p>We can map another variable as size of the points. This is done by specifying size inside the aesthetic mapping. Now the size of the points denote <code>Sepal.Width</code>. A new legend group is created to show this new aesthetic.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species,<span class="at">size=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="discrete-colors" class="level3">
<h3 class="anchored" data-anchor-id="discrete-colors">Discrete colors</h3>
<p>We can change the default colors by specifying new values inside a scale.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species,<span class="at">size=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"blue"</span>,<span class="st">"green"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="continuous-colors" class="level3">
<h3 class="anchored" data-anchor-id="continuous-colors">Continuous colors</h3>
<p>We can also map the colors to a continuous variable. This creates a color bar legend item.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="titles" class="level3">
<h3 class="anchored" data-anchor-id="titles">Titles</h3>
<p>Now let’s rename the axis labels, change the legend title and add a title, a subtitle and a caption. We change the legend title using <code>scale_color_continuous()</code>. All other labels are changed using <code>labs()</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_continuous</span>(<span class="at">name=</span><span class="st">"New Legend Title"</span>)<span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"This Is A Title"</span>,<span class="at">subtitle=</span><span class="st">"This is a subtitle"</span>,<span class="at">x=</span><span class="st">" Petal Length"</span>, </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Petal Width"</span>, <span class="at">caption=</span><span class="st">"This is a little caption."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="axes-modification" class="level3">
<h3 class="anchored" data-anchor-id="axes-modification">Axes modification</h3>
<p>Let’s say we are not happy with the x-axis breaks 2,4,6 etc. We would like to have 1,2,3… We change this using <code>scale_x_continuous()</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_continuous</span>(<span class="at">name=</span><span class="st">"New Legend Title"</span>)<span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"This Is A Title"</span>,<span class="at">subtitle=</span><span class="st">"This is a subtitle"</span>,<span class="at">x=</span><span class="st">" Petal Length"</span>, </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Petal Width"</span>, <span class="at">caption=</span><span class="st">"This is a little caption."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="faceting" class="level3">
<h3 class="anchored" data-anchor-id="faceting">Faceting</h3>
<p>We can create subplots using the faceting functionality. Let’s create three subplots for the three levels of Species.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_continuous</span>(<span class="at">name=</span><span class="st">"New Legend Title"</span>)<span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"This Is A Title"</span>,<span class="at">subtitle=</span><span class="st">"This is a subtitle"</span>,<span class="at">x=</span><span class="st">" Petal Length"</span>, </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Petal Width"</span>, <span class="at">caption=</span><span class="st">"This is a little caption."</span>)<span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="themes" class="level3">
<h3 class="anchored" data-anchor-id="themes">Themes</h3>
<p>The look of the plot can be changed using themes. Let’s can the default <code>theme_grey()</code> to <code>theme_bw()</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_continuous</span>(<span class="at">name=</span><span class="st">"New Legend Title"</span>)<span class="sc">+</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"This Is A Title"</span>,<span class="at">subtitle=</span><span class="st">"This is a subtitle"</span>,<span class="at">x=</span><span class="st">" Petal Length"</span>, </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Petal Width"</span>, <span class="at">caption=</span><span class="st">"This is a little caption."</span>)<span class="sc">+</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Species)<span class="sc">+</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>All non-data related aspects of the plot can be modified through themes. Let’s modify the colors of the title labels and turn off the gridlines. The various parameters for theme can be found using <code>?theme</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_continuous</span>(<span class="at">name=</span><span class="st">"New Legend Title"</span>)<span class="sc">+</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"This Is A Title"</span>,<span class="at">subtitle=</span><span class="st">"This is a subtitle"</span>,<span class="at">x=</span><span class="st">" Petal Length"</span>, </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Petal Width"</span>, <span class="at">caption=</span><span class="st">"This is a little caption."</span>)<span class="sc">+</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Species)<span class="sc">+</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"Blue"</span>,<span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"Green"</span>,<span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle=</span><span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"Pink"</span>),</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid=</span><span class="fu">element_blank</span>()</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Themes can be saved and reused.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>newtheme <span class="ot">&lt;-</span> <span class="fu">theme</span>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"Blue"</span>,<span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"Green"</span>,<span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle=</span><span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"Pink"</span>),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid=</span><span class="fu">element_blank</span>())</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_continuous</span>(<span class="at">name=</span><span class="st">"New Legend Title"</span>)<span class="sc">+</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"This Is A Title"</span>,<span class="at">subtitle=</span><span class="st">"This is a subtitle"</span>,<span class="at">x=</span><span class="st">" Petal Length"</span>, </span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Petal Width"</span>, <span class="at">caption=</span><span class="st">"This is a little caption."</span>)<span class="sc">+</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Species)<span class="sc">+</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  newtheme</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="controlling-legends" class="level3">
<h3 class="anchored" data-anchor-id="controlling-legends">Controlling legends</h3>
<p>Here we see two legends based on the two aesthetic mappings.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species,<span class="at">size=</span>Sepal.Width))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>If we don’t want to have the extra legend, we can turn off legends individually by aesthetic.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species,<span class="at">size=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size=</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>We can also turn off legends by geom.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species,<span class="at">size=</span>Sepal.Width),<span class="at">show.legend=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>Legends can be moved around using theme.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species,<span class="at">size=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification=</span><span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Legend rows can be controlled in a finer manner.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species,<span class="at">size=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size=</span><span class="fu">guide_legend</span>(<span class="at">nrow=</span><span class="dv">2</span>,<span class="at">byrow=</span><span class="cn">TRUE</span>),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">color=</span><span class="fu">guide_legend</span>(<span class="at">nrow=</span><span class="dv">3</span>,<span class="at">byrow=</span>T))<span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification=</span><span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="labelling" class="level3">
<h3 class="anchored" data-anchor-id="labelling">Labelling</h3>
<p>Items on the plot can be labelled using the <code>geom_text</code> or <code>geom_label</code> geoms.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species))<span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>Species,<span class="at">hjust=</span><span class="dv">0</span>),<span class="at">nudge_x=</span><span class="fl">0.5</span>,<span class="at">size=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species))<span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label=</span>Species,<span class="at">hjust=</span><span class="dv">0</span>),<span class="at">nudge_x=</span><span class="fl">0.5</span>,<span class="at">size=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<p>The R package <code>ggrepel</code> allows for non-overlapping labels.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species))<span class="sc">+</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label=</span>Species),<span class="at">size=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ggrepel: 134 unlabeled data points (too many overlaps). Consider
increasing max.overlaps</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="annotations" class="level3">
<h3 class="anchored" data-anchor-id="annotations">Annotations</h3>
<p>Custom annotations of any geom can be added arbitrarily anywhere on the plot.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species))<span class="sc">+</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">x=</span><span class="fl">2.5</span>,<span class="at">y=</span><span class="fl">2.1</span>,<span class="at">label=</span><span class="st">"There is a random line here"</span>)<span class="sc">+</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>,<span class="at">x=</span><span class="dv">2</span>,<span class="at">xend=</span><span class="dv">4</span>,<span class="at">y=</span><span class="fl">1.5</span>,<span class="at">yend=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="barplots" class="level3">
<h3 class="anchored" data-anchor-id="barplots">Barplots</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Species,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="flip-axes" class="level3">
<h3 class="anchored" data-anchor-id="flip-axes">Flip axes</h3>
<p>x and y axes can be flipped using <code>coord_flip</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Species,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="error-bars" class="level3">
<h3 class="anchored" data-anchor-id="error-bars">Error Bars</h3>
<p>An example of using error bars with points. The mean and standard deviation is computed. This is used to create upper and lower bounds for the error bars.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>dfr <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Species) <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean=</span><span class="fu">mean</span>(Sepal.Length),<span class="at">sd=</span><span class="fu">sd</span>(Sepal.Length)) <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">high=</span>mean<span class="sc">+</span>sd,<span class="at">low=</span>mean<span class="sc">-</span>sd)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dfr,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Species,<span class="at">y=</span>mean,<span class="at">color=</span>Species))<span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymax=</span>high,<span class="at">ymin=</span>low),<span class="at">width=</span><span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="economist-scatterplot" class="level2">
<h2 class="anchored" data-anchor-id="economist-scatterplot">Economist Scatterplot</h2>
<p>The aim of this challenge is to recreate the plot below originally published in <a href="https://www.economist.com/blogs/dailychart/2011/12/corruption-and-development">The Economist</a>. The graph is a scatterplot showing the relationship between <em>Corruption Index</em> and <em>Human Development Index</em> for various countries.</p>
<p><img src="assets/economist-scatterplot.png" class="img-fluid"></p>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>Download the data csv file.</p>
<p><a class="btn btn-secondary btn-sm" href="https://www.dropbox.com/s/7imn0eoey9ckxh5/data_economist.csv?dl=1" role="button">{{&lt; fa download &gt;}} data_economist.csv</a></p>
<p>Start by reading in the data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>ec <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"assets/data_economist.csv"</span>,<span class="at">header=</span>T)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">X</th>
<th style="text-align: left;">Country</th>
<th style="text-align: right;">HDI.Rank</th>
<th style="text-align: right;">HDI</th>
<th style="text-align: right;">CPI</th>
<th style="text-align: left;">Region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">172</td>
<td style="text-align: right;">0.398</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: left;">Asia Pacific</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Albania</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">0.739</td>
<td style="text-align: right;">3.1</td>
<td style="text-align: left;">East EU Cemt Asia</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">0.698</td>
<td style="text-align: right;">2.9</td>
<td style="text-align: left;">MENA</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Angola</td>
<td style="text-align: right;">148</td>
<td style="text-align: right;">0.486</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: left;">SSA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Argentina</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">0.797</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: left;">Americas</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">Armenia</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">0.716</td>
<td style="text-align: right;">2.6</td>
<td style="text-align: left;">East EU Cemt Asia</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Make sure that the fields are of the correct type. The x-axis field ‘CPI’ and the y-axis field ‘HDI’ must be of numeric type. The categorical field ‘Region’ must be of Factor type.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   173 obs. of  6 variables:
 $ X       : int  1 2 3 4 5 6 7 8 9 10 ...
 $ Country : chr  "Afghanistan" "Albania" "Algeria" "Angola" ...
 $ HDI.Rank: int  172 70 96 148 45 86 2 19 91 53 ...
 $ HDI     : num  0.398 0.739 0.698 0.486 0.797 0.716 0.929 0.885 0.7 0.771 ...
 $ CPI     : num  1.5 3.1 2.9 2 3 2.6 8.8 7.8 2.4 7.3 ...
 $ Region  : chr  "Asia Pacific" "East EU Cemt Asia" "MENA" "SSA" ...</code></pre>
</div>
</div>
<p>We need to first modify the region column. The current levels in the ‘Region’ field are:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(ec<span class="sc">$</span>Region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<p>But, the categories on the plot are different and need to be changed as follows:</p>
<pre><code>From                  To
EU W. Europe          OECD
Americas              Americas
Asia Pacific          Asia &amp; Oceania
East EU Cemt Asia     Central &amp; Eastern Europe
MENA                  Middle East &amp; North Africa
SSA                   Sub-Saharan Africa</code></pre>
<p>Since the ‘To’ strings are a bit too long to be in one line on the legend, use <code>\n</code> to break a line into two lines.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>\n</code> is the newline character in R.</p>
</div>
</div>
<pre><code>From                  To
EU W. Europe          OECD
Americas              Americas
Asia Pacific          Asia &amp;\nOceania
East EU Cemt Asia     Central &amp;\nEastern Europe
MENA                  Middle East &amp;\nNorth Africa
SSA                   Sub-Saharan\nAfrica</code></pre>
<p>The strings can be renamed using string replacement or substitution. But a easier way to do it is to use <code>factor()</code>. The arguments <code>levels</code> and <code>labels</code> in function <code>factor()</code> can be used to rename factors.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>ec<span class="sc">$</span>Region <span class="ot">&lt;-</span> <span class="fu">factor</span>(ec<span class="sc">$</span>Region,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"EU W. Europe"</span>,</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Americas"</span>,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Asia Pacific"</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"East EU Cemt Asia"</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"MENA"</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"SSA"</span>),</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"OECD"</span>,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Americas"</span>,</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Asia &amp;</span><span class="sc">\n</span><span class="st">Oceania"</span>,</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Central &amp;</span><span class="sc">\n</span><span class="st">Eastern Europe"</span>,</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Middle East &amp;</span><span class="sc">\n</span><span class="st">North Africa"</span>,</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Sub-Saharan</span><span class="sc">\n</span><span class="st">Africa"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Our new Regions should look like:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(ec<span class="sc">$</span>Region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "OECD"                        "Americas"                   
[3] "Asia &amp;\nOceania"             "Central &amp;\nEastern Europe"  
[5] "Middle East &amp;\nNorth Africa" "Sub-Saharan\nAfrica"        </code></pre>
</div>
</div>
</section>
<section id="points" class="level3">
<h3 class="anchored" data-anchor-id="points">Points</h3>
<p>Start building up the basic plot.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Provide data.frame ‘ec’ as the data and map field ‘CPI’ to the x-axis and ‘HDI’ to the y-axis. Use <code>geom_point()</code> to draw point geometry. To select shapes, see <a href="https://www.google.se/search?q=r+pch&amp;oq=R+pch">here</a>. Circular shape can be drawn using 1, 16, 19, 20 and 21. Using shape ‘21’ allows us to control stroke color, fill color and stroke thickness for the points. Check out <code>?geom_point</code> and look under ‘Aesthetics’ for the various possible aesthetic options. Set shape to 21, size to 3, stroke to 0.8 and fill to white.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ec,<span class="fu">aes</span>(<span class="at">x=</span>CPI,<span class="at">y=</span>HDI,<span class="at">color=</span>Region))<span class="sc">+</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">21</span>,<span class="at">size=</span><span class="dv">3</span>,<span class="at">stroke=</span><span class="fl">0.8</span>,<span class="at">fill=</span><span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Notice how ‘’ has created newlines in the Legend.</p>
</section>
<section id="trendline" class="level3">
<h3 class="anchored" data-anchor-id="trendline">Trendline</h3>
<p>Now, we add the trend line using <code>geom_smooth</code>. Check out <code>?geom_smooth</code> and look under ‘Arguments’ for argument options and ‘Aesthetics’ for the aesthetic options.</p>
<ul>
<li>Use method ‘lm’ and use a custom formula of <code>y~poly(x,2)</code> to approximate the curve seen on the plot. Turn off confidence interval shading. Set line thickness to 0.6 and line color to red.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ec,<span class="fu">aes</span>(<span class="at">x=</span>CPI,<span class="at">y=</span>HDI,<span class="at">color=</span>Region))<span class="sc">+</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">21</span>,<span class="at">size=</span><span class="dv">3</span>,<span class="at">stroke=</span><span class="fl">0.8</span>,<span class="at">fill=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>,<span class="at">formula=</span>y<span class="sc">~</span><span class="fu">poly</span>(x,<span class="dv">2</span>),<span class="at">se=</span>F,<span class="at">size=</span><span class="fl">0.6</span>,<span class="at">color=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Notice that the line in drawn over the points due to the plotting order. We want the points to be over the line. So reorder the geoms. Since we provided no aesthetic mappings to <code>geom_smooth</code>, there is no legend entry for the trendline. We can fake a legend entry by providing an aesthetic, for example; <code>aes(fill="red")</code>. We do not use the color aesthetic because it is already in use and would give us reduced control later on to modify this legend entry.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(ec,<span class="fu">aes</span>(<span class="at">x=</span>CPI,<span class="at">y=</span>HDI,<span class="at">color=</span>Region))<span class="sc">+</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">fill=</span><span class="st">"red"</span>),<span class="at">method=</span><span class="st">"lm"</span>,<span class="at">formula=</span>y<span class="sc">~</span><span class="fu">poly</span>(x,<span class="dv">2</span>),<span class="at">se=</span>F,<span class="at">color=</span><span class="st">"red"</span>,<span class="at">size=</span><span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">21</span>,<span class="at">size=</span><span class="dv">3</span>,<span class="at">stroke=</span><span class="fl">0.8</span>,<span class="at">fill=</span><span class="st">"white"</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="text-labels" class="level3">
<h3 class="anchored" data-anchor-id="text-labels">Text Labels</h3>
<p>Now we add the text labels. Only a subset of countries are plotted. The list of countries to label is shown below.</p>
<pre><code>"Congo","Afghanistan","Sudan","Myanmar","Iraq","Venezuela","Russia","Argentina","Brazil","Italy","South Africa","Cape Verde","Bhutan","Botswana","Britian","New Zealand","Greece","China","India","Rwanda","Spain","France","United States","Japan","Norway","Singapore","Barbados","Germany"</code></pre>
<ul>
<li>Use <code>geom_text</code> to subset the original data.frame to the reduced set above and plot the labels as text. See <code>?geom_text</code>.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Congo"</span>,<span class="st">"Afghanistan"</span>,<span class="st">"Sudan"</span>,<span class="st">"Myanmar"</span>,<span class="st">"Iraq"</span>,<span class="st">"Venezuela"</span>,<span class="st">"Russia"</span>,<span class="st">"Argentina"</span>,<span class="st">"Brazil"</span>,<span class="st">"Italy"</span>,<span class="st">"South Africa"</span>,<span class="st">"Cape Verde"</span>,<span class="st">"Bhutan"</span>,<span class="st">"Botswana"</span>,<span class="st">"Britian"</span>,<span class="st">"New Zealand"</span>,<span class="st">"Greece"</span>,<span class="st">"China"</span>,<span class="st">"India"</span>,<span class="st">"Rwanda"</span>,<span class="st">"Spain"</span>,<span class="st">"France"</span>,<span class="st">"United States"</span>,<span class="st">"Japan"</span>,<span class="st">"Norway"</span>,<span class="st">"Singapore"</span>,<span class="st">"Barbados"</span>,<span class="st">"Germany"</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>p<span class="sc">+</span><span class="fu">geom_text</span>(<span class="at">data=</span><span class="fu">subset</span>(ec,Country <span class="sc">%in%</span> labels),<span class="fu">aes</span>(<span class="at">label=</span>Country),<span class="at">color=</span><span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="custom-font" class="level3">
<h3 class="anchored" data-anchor-id="custom-font">Custom Font</h3>
<p>Custom font can be used for the labels by providing the font name to argument <code>family</code> like so <code>geom_text(family="fontname")</code>. If you do not want to bother with fonts, just avoid the <code>family</code> argument in <code>geom_text</code> and skip this part.</p>
<p>Using custom fonts can be tricky business. To use a font name, it must be installed on your system and it should be imported into the R environment. This can be done using the <code>extrafont</code> package. Try importing one of the fonts available on your system. Not all fonts work. <code>extrafont</code> prefers <strong>.ttf</strong> fonts. If a font doesn’t work, try another.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(extrafont)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">font_import</span>(<span class="at">pattern=</span><span class="st">"Gidole"</span>,<span class="at">prompt=</span><span class="cn">FALSE</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># load fonts for pdf</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">loadfonts</span>()</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="co"># list available fonts in R</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="fu">fonts</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The actual font used on the Economist graph is something close to <a href="https://www.fontshop.com/families/itc-itc-officina-sans">ITC Officina Sans</a>. Since this is not a free font, I am using a free font called <a href="https://gidole.github.io/">Gidole</a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>p<span class="sc">+</span><span class="fu">geom_text</span>(<span class="at">data=</span><span class="fu">subset</span>(ec,Country <span class="sc">%in%</span> labels),<span class="fu">aes</span>(<span class="at">label=</span>Country),</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">color=</span><span class="st">"black"</span>,<span class="at">family=</span><span class="st">"Gidole"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
font family not found in Windows font database</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="label-overlap" class="level3">
<h3 class="anchored" data-anchor-id="label-overlap">Label Overlap</h3>
<p>To avoid overlapping of labels, we can use a <code>ggplot2</code> extension package <code>ggrepel</code>. We can use function <code>geom_text_repel()</code> from the <code>ggrepel</code> package. <code>geom_text_repel()</code> has the same arguments/aesthetics as <code>geom_text</code> and a few more. Skip the <code>family=Gidole</code> part if you do not want to change the font.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span><span class="fu">geom_text_repel</span>(<span class="at">data=</span><span class="fu">subset</span>(ec,Country <span class="sc">%in%</span> labels),<span class="fu">aes</span>(<span class="at">label=</span>Country),</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">color=</span><span class="st">"black"</span>,<span class="at">box.padding=</span><span class="fu">unit</span>(<span class="dv">1</span>,<span class="st">'lines'</span>),<span class="at">segment.size=</span><span class="fl">0.25</span>,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">size=</span><span class="dv">3</span>,<span class="at">family=</span><span class="st">"Gidole"</span>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="axes" class="level3">
<h3 class="anchored" data-anchor-id="axes">Axes</h3>
<p>Next step is to adjust the axes breaks, axes labels, point colors and relabeling the trendline legend text.</p>
<ul>
<li>Change axes labels to ‘Corruption Perceptions Index, 2011 (10=least corrupt)’ on the x-axis and ‘Human Development Index, 2011 (1=best)’ on the y-axis. Set breaks on the x-axis from 1 to 10 by 1 increment and y-axis from 0.2 to 1.0 by 0.1 increments.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span><span class="fu">scale_x_continuous</span>(<span class="at">name=</span><span class="st">"Corruption Perceptions Index, 2011 (10=least corrupt)"</span>,</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">name=</span><span class="st">"Human Development Index, 2011 (1=best)"</span>,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">breaks=</span><span class="fu">seq</span>(<span class="at">from=</span><span class="dv">0</span>,<span class="at">to=</span><span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="dv">1</span>))</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="scale-colors" class="level3">
<h3 class="anchored" data-anchor-id="scale-colors">Scale Colors</h3>
<p>Now we want to change the color palette for the points and modify the legend text for the trendline.</p>
<ul>
<li>Use <code>scale_color_manual()</code> to provide custom colors. These are the colors to use for the points: <code>"#23576E","#099FDB","#29B00E", "#208F84","#F55840","#924F3E"</code>.</li>
<li>Use <code>scale_fill_manual</code> to change the trendline label since it’s a fill scale. The legend entry for the trendline should read ‘R^2=52%’.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span><span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#23576E"</span>,<span class="st">"#099FDB"</span>,<span class="st">"#29B00E"</span>, <span class="st">"#208F84"</span>,<span class="st">"#F55840"</span>,<span class="st">"#924F3E"</span>))<span class="sc">+</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">"trend"</span>,<span class="at">values=</span><span class="st">"red"</span>,<span class="at">labels=</span><span class="fu">expression</span>(<span class="fu">paste</span>(R<span class="sc">^</span><span class="dv">2</span>,<span class="st">"=52%"</span>)))</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database
Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : font
family not found in Windows font database</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="title" class="level3">
<h3 class="anchored" data-anchor-id="title">Title</h3>
<p>Title and caption can be added with <code>labs</code>.</p>
<ul>
<li>Set the title to ‘Corruption and human development’.</li>
<li>Set the caption to ‘Sources: Transparency International; UN Human Development Report’.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Corruption and human development"</span>,</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">caption=</span><span class="st">"Sources: Transparency International; UN Human Development Report"</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="theme" class="level3">
<h3 class="anchored" data-anchor-id="theme">Theme</h3>
<p>We want to move the legend to the top and as a single row. This can be done using <code>theme()</code> option <code>legend.position</code>. See <code>?theme</code>. <code>guides()</code> is used to set the number of rows to 1. We also set a custom font for all text elements using <code>base_family="Gidole"</code>. This can be skipped if a font change is not required.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span><span class="fu">guides</span>(<span class="at">color=</span><span class="fu">guide_legend</span>(<span class="at">nrow=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">theme_bw</span>(<span class="at">base_family=</span><span class="st">"Gidole"</span>)<span class="sc">+</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now we do some careful refining with themes.</p>
<ul>
<li>Turn off minor gridlines</li>
<li>Turn off major gridlines on x-axis</li>
<li>Remove the gray background</li>
<li>Remove panel border</li>
<li>Remove legend titles</li>
<li>Make axes titles italic</li>
<li>Turn off y-axis ticks</li>
<li>Change x-axis ticks to color grey60</li>
<li>Make plot title bold</li>
<li>Decrease size of caption to size 8</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>p<span class="sc">+</span><span class="fu">theme</span>(<span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(),</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.background=</span><span class="fu">element_blank</span>(),</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.border=</span><span class="fu">element_blank</span>(),</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"italic"</span>),</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks.x=</span><span class="fu">element_line</span>(<span class="at">color=</span><span class="st">"grey60"</span>),</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.caption=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">size=</span><span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>And now our plot is ready and we can compare with the original. Close? Close enough?</p>
<p><img src="assets/economist-scatterplot.png" class="img-fluid"></p>
<p>The full script for this challenge is summarized here:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read data</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>ec <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"assets/data_economist.csv"</span>,<span class="at">header=</span>T)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co"># refactor</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>ec<span class="sc">$</span>Region <span class="ot">&lt;-</span> <span class="fu">factor</span>(ec<span class="sc">$</span>Region,</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"EU W. Europe"</span>,<span class="st">"Americas"</span>,<span class="st">"Asia Pacific"</span>,</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"East EU Cemt Asia"</span>,<span class="st">"MENA"</span>,<span class="st">"SSA"</span>),</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"OECD"</span>,<span class="st">"Americas"</span>,<span class="st">"Asia &amp;</span><span class="sc">\n</span><span class="st">Oceania"</span>,</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Central &amp;</span><span class="sc">\n</span><span class="st">Eastern Europe"</span>,</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Middle East &amp;</span><span class="sc">\n</span><span class="st">North Africa"</span>,</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Sub-Saharan</span><span class="sc">\n</span><span class="st">Africa"</span>))</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a><span class="co"># labels</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Congo"</span>,<span class="st">"Afghanistan"</span>,<span class="st">"Sudan"</span>,<span class="st">"Myanmar"</span>,<span class="st">"Iraq"</span>,<span class="st">"Venezuela"</span>,<span class="st">"Russia"</span>,<span class="st">"Argentina"</span>,<span class="st">"Brazil"</span>,<span class="st">"Italy"</span>,<span class="st">"South Africa"</span>,<span class="st">"Cape Verde"</span>,<span class="st">"Bhutan"</span>,<span class="st">"Botswana"</span>,<span class="st">"Britian"</span>,<span class="st">"New Zealand"</span>,<span class="st">"Greece"</span>,<span class="st">"China"</span>,<span class="st">"India"</span>,<span class="st">"Rwanda"</span>,<span class="st">"Spain"</span>,<span class="st">"France"</span>,<span class="st">"United States"</span>,<span class="st">"Japan"</span>,<span class="st">"Norway"</span>,<span class="st">"Singapore"</span>,<span class="st">"Barbados"</span>,<span class="st">"Germany"</span>)</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(ec,<span class="fu">aes</span>(<span class="at">x=</span>CPI,<span class="at">y=</span>HDI,<span class="at">color=</span>Region))<span class="sc">+</span></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">fill=</span><span class="st">"red"</span>),<span class="at">method=</span><span class="st">"lm"</span>,<span class="at">formula=</span>y<span class="sc">~</span><span class="fu">poly</span>(x,<span class="dv">2</span>),<span class="at">se=</span>F,<span class="at">color=</span><span class="st">"red"</span>,<span class="at">size=</span><span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">21</span>,<span class="at">size=</span><span class="dv">3</span>,<span class="at">stroke=</span><span class="fl">0.8</span>,<span class="at">fill=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text_repel</span>(<span class="at">data=</span><span class="fu">subset</span>(ec,Country <span class="sc">%in%</span> labels),<span class="fu">aes</span>(<span class="at">label=</span>Country),</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">color=</span><span class="st">"black"</span>,<span class="at">box.padding=</span><span class="fu">unit</span>(<span class="dv">1</span>,<span class="st">'lines'</span>),<span class="at">segment.size=</span><span class="fl">0.25</span>,</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">size=</span><span class="dv">3</span>,<span class="at">family=</span><span class="st">"Gidole"</span>)<span class="sc">+</span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">name=</span><span class="st">"Corruption Perceptions Index, 2011 (10=least corrupt)"</span>,</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">name=</span><span class="st">"Human Development Index, 2011 (1=best)"</span>,</span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>                         <span class="at">breaks=</span><span class="fu">seq</span>(<span class="at">from=</span><span class="dv">0</span>,<span class="at">to=</span><span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#23576E"</span>,<span class="st">"#099FDB"</span>,<span class="st">"#29B00E"</span>, <span class="st">"#208F84"</span>,<span class="st">"#F55840"</span>,<span class="st">"#924F3E"</span>))<span class="sc">+</span></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>           <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">"trend"</span>,<span class="at">values=</span><span class="st">"red"</span>,<span class="at">labels=</span><span class="fu">expression</span>(<span class="fu">paste</span>(R<span class="sc">^</span><span class="dv">2</span>,<span class="st">"=52%"</span>)))<span class="sc">+</span></span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Corruption and human development"</span>,</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">caption=</span><span class="st">"Sources: Transparency International; UN Human Development Report"</span>)<span class="sc">+</span></span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">guides</span>(<span class="at">color=</span><span class="fu">guide_legend</span>(<span class="at">nrow=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>(<span class="at">base_family=</span><span class="st">"Gidole"</span>)<span class="sc">+</span></span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>,</span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(),</span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.grid.major.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.background=</span><span class="fu">element_blank</span>(),</span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.border=</span><span class="fu">element_blank</span>(),</span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"italic"</span>),</span>
<span id="cb79-39"><a href="#cb79-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb79-40"><a href="#cb79-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.ticks.x=</span><span class="fu">element_line</span>(<span class="at">color=</span><span class="st">"grey60"</span>),</span>
<span id="cb79-41"><a href="#cb79-41" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb79-42"><a href="#cb79-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.caption=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">size=</span><span class="dv">8</span>))</span>
<span id="cb79-43"><a href="#cb79-43" aria-hidden="true" tabindex="-1"></a>p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="wsj-heatmap" class="level2">
<h2 class="anchored" data-anchor-id="wsj-heatmap">WSJ Heatmap</h2>
<p>The aim of this challenge is to recreate the plot below originally published in <a href="http://graphics.wsj.com/infectious-diseases-and-vaccines/">The Wall Street Journal</a>. The plot is a heatmap showing the normalized number of cases of measles across 51 US states from 1928 to 2003. X-axis shows years and y-axis shows the names of states. The color of the tiles denote the number of measles cases per 100,000 people. Introduction of the measles vaccine is shown as the black line in 1963.</p>
<p><img src="assets/wsj-heatmap.png" class="img-fluid"></p>
<section id="data-1" class="level3">
<h3 class="anchored" data-anchor-id="data-1">Data</h3>
<p>Download the data csv file.</p>
<p><a class="btn btn-secondary btn-sm" href="https://www.dropbox.com/s/19p8vku0i9np26b/data_wsj.csv?dl=1" role="button">{} data_wsj.csv</a></p>
<p>Start by reading in the data. This .csv file has two lines of comments so we need to skip 2 lines while reading in the data. We also add <code>stringsAsFactors=F</code> to avoid the automatic conversion of character fields to factor type.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>me <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"assets/data_wsj.csv"</span>,<span class="at">header=</span>T,<span class="at">stringsAsFactors=</span>F,<span class="at">skip=</span><span class="dv">2</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(me)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 0%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 4%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 0%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 1%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">YEAR</th>
<th style="text-align: right;">WEEK</th>
<th style="text-align: left;">ALABAMA</th>
<th style="text-align: left;">ALASKA</th>
<th style="text-align: left;">ARIZONA</th>
<th style="text-align: left;">ARKANSAS</th>
<th style="text-align: left;">CALIFORNIA</th>
<th style="text-align: left;">COLORADO</th>
<th style="text-align: left;">CONNECTICUT</th>
<th style="text-align: left;">DELAWARE</th>
<th style="text-align: left;">DISTRICT.OF.COLUMBIA</th>
<th style="text-align: left;">FLORIDA</th>
<th style="text-align: left;">GEORGIA</th>
<th style="text-align: left;">HAWAII</th>
<th style="text-align: left;">IDAHO</th>
<th style="text-align: left;">ILLINOIS</th>
<th style="text-align: left;">INDIANA</th>
<th style="text-align: left;">IOWA</th>
<th style="text-align: left;">KANSAS</th>
<th style="text-align: left;">KENTUCKY</th>
<th style="text-align: left;">LOUISIANA</th>
<th style="text-align: left;">MAINE</th>
<th style="text-align: left;">MARYLAND</th>
<th style="text-align: left;">MASSACHUSETTS</th>
<th style="text-align: left;">MICHIGAN</th>
<th style="text-align: left;">MINNESOTA</th>
<th style="text-align: left;">MISSISSIPPI</th>
<th style="text-align: left;">MISSOURI</th>
<th style="text-align: left;">MONTANA</th>
<th style="text-align: left;">NEBRASKA</th>
<th style="text-align: left;">NEVADA</th>
<th style="text-align: left;">NEW.HAMPSHIRE</th>
<th style="text-align: left;">NEW.JERSEY</th>
<th style="text-align: left;">NEW.MEXICO</th>
<th style="text-align: left;">NEW.YORK</th>
<th style="text-align: left;">NORTH.CAROLINA</th>
<th style="text-align: left;">NORTH.DAKOTA</th>
<th style="text-align: left;">OHIO</th>
<th style="text-align: left;">OKLAHOMA</th>
<th style="text-align: left;">OREGON</th>
<th style="text-align: left;">PENNSYLVANIA</th>
<th style="text-align: left;">RHODE.ISLAND</th>
<th style="text-align: left;">SOUTH.CAROLINA</th>
<th style="text-align: left;">SOUTH.DAKOTA</th>
<th style="text-align: left;">TENNESSEE</th>
<th style="text-align: left;">TEXAS</th>
<th style="text-align: left;">UTAH</th>
<th style="text-align: left;">VERMONT</th>
<th style="text-align: left;">VIRGINIA</th>
<th style="text-align: left;">WASHINGTON</th>
<th style="text-align: left;">WEST.VIRGINIA</th>
<th style="text-align: left;">WISCONSIN</th>
<th style="text-align: left;">WYOMING</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">3.67</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">1.90</td>
<td style="text-align: left;">4.11</td>
<td style="text-align: left;">1.38</td>
<td style="text-align: left;">8.38</td>
<td style="text-align: left;">4.50</td>
<td style="text-align: left;">8.58</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.21</td>
<td style="text-align: left;">1.17</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.50</td>
<td style="text-align: left;">1.34</td>
<td style="text-align: left;">0.16</td>
<td style="text-align: left;">0.81</td>
<td style="text-align: left;">3.08</td>
<td style="text-align: left;">1.89</td>
<td style="text-align: left;">4.52</td>
<td style="text-align: left;">10.87</td>
<td style="text-align: left;">25.66</td>
<td style="text-align: left;">5.68</td>
<td style="text-align: left;">0.31</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">1.19</td>
<td style="text-align: left;">0.18</td>
<td style="text-align: left;">1.60</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">3.55</td>
<td style="text-align: left;">14.90</td>
<td style="text-align: left;">7.60</td>
<td style="text-align: left;">47.86</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">2.51</td>
<td style="text-align: left;">4.86</td>
<td style="text-align: left;">4.91</td>
<td style="text-align: left;">6.97</td>
<td style="text-align: left;">1.18</td>
<td style="text-align: left;">42.04</td>
<td style="text-align: left;">5.69</td>
<td style="text-align: left;">22.03</td>
<td style="text-align: left;">1.18</td>
<td style="text-align: left;">0.40</td>
<td style="text-align: left;">0.28</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">14.83</td>
<td style="text-align: left;">3.36</td>
<td style="text-align: left;">1.54</td>
<td style="text-align: left;">0.91</td>
</tr>
<tr class="even">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">6.25</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">6.40</td>
<td style="text-align: left;">9.91</td>
<td style="text-align: left;">1.80</td>
<td style="text-align: left;">6.02</td>
<td style="text-align: left;">9.00</td>
<td style="text-align: left;">7.30</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.49</td>
<td style="text-align: left;">5.96</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.45</td>
<td style="text-align: left;">0.77</td>
<td style="text-align: left;">2.71</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">1.35</td>
<td style="text-align: left;">1.99</td>
<td style="text-align: left;">3.00</td>
<td style="text-align: left;">7.40</td>
<td style="text-align: left;">15.47</td>
<td style="text-align: left;">28.50</td>
<td style="text-align: left;">7.59</td>
<td style="text-align: left;">0.23</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.83</td>
<td style="text-align: left;">0.18</td>
<td style="text-align: left;">0.29</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">4.74</td>
<td style="text-align: left;">11.06</td>
<td style="text-align: left;">9.65</td>
<td style="text-align: left;">119.70</td>
<td style="text-align: left;">0.15</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">2.56</td>
<td style="text-align: left;">4.91</td>
<td style="text-align: left;">8.74</td>
<td style="text-align: left;">0.74</td>
<td style="text-align: left;">83.90</td>
<td style="text-align: left;">6.57</td>
<td style="text-align: left;">16.96</td>
<td style="text-align: left;">0.63</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.56</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">17.34</td>
<td style="text-align: left;">4.19</td>
<td style="text-align: left;">0.96</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">7.95</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">4.50</td>
<td style="text-align: left;">11.15</td>
<td style="text-align: left;">1.31</td>
<td style="text-align: left;">2.86</td>
<td style="text-align: left;">8.81</td>
<td style="text-align: left;">15.88</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.42</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.45</td>
<td style="text-align: left;">0.61</td>
<td style="text-align: left;">1.71</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">1.41</td>
<td style="text-align: left;">5.26</td>
<td style="text-align: left;">2.33</td>
<td style="text-align: left;">6.78</td>
<td style="text-align: left;">21.43</td>
<td style="text-align: left;">34.76</td>
<td style="text-align: left;">9.39</td>
<td style="text-align: left;">0.15</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">1.69</td>
<td style="text-align: left;">0.74</td>
<td style="text-align: left;">0.36</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">6.68</td>
<td style="text-align: left;">14.90</td>
<td style="text-align: left;">8.54</td>
<td style="text-align: left;">110.90</td>
<td style="text-align: left;">1.20</td>
<td style="text-align: left;">4.86</td>
<td style="text-align: left;">6.27</td>
<td style="text-align: left;">3.63</td>
<td style="text-align: left;">8.12</td>
<td style="text-align: left;">2.65</td>
<td style="text-align: left;">77.46</td>
<td style="text-align: left;">2.04</td>
<td style="text-align: left;">24.66</td>
<td style="text-align: left;">0.62</td>
<td style="text-align: left;">0.20</td>
<td style="text-align: left;">1.12</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">15.67</td>
<td style="text-align: left;">4.19</td>
<td style="text-align: left;">4.79</td>
<td style="text-align: left;">1.36</td>
</tr>
<tr class="even">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">12.58</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">1.90</td>
<td style="text-align: left;">13.75</td>
<td style="text-align: left;">1.87</td>
<td style="text-align: left;">13.71</td>
<td style="text-align: left;">10.40</td>
<td style="text-align: left;">4.29</td>
<td style="text-align: left;">4.18</td>
<td style="text-align: left;">0.91</td>
<td style="text-align: left;">8.65</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.81</td>
<td style="text-align: left;">4.11</td>
<td style="text-align: left;">3.51</td>
<td style="text-align: left;">1.14</td>
<td style="text-align: left;">5.49</td>
<td style="text-align: left;">4.02</td>
<td style="text-align: left;">9.41</td>
<td style="text-align: left;">22.67</td>
<td style="text-align: left;">31.28</td>
<td style="text-align: left;">8.66</td>
<td style="text-align: left;">0.12</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">1.58</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.44</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">14.53</td>
<td style="text-align: left;">6.78</td>
<td style="text-align: left;">27.64</td>
<td style="text-align: left;">9.32</td>
<td style="text-align: left;">131.60</td>
<td style="text-align: left;">3.91</td>
<td style="text-align: left;">4.40</td>
<td style="text-align: left;">4.74</td>
<td style="text-align: left;">2.24</td>
<td style="text-align: left;">8.39</td>
<td style="text-align: left;">0.15</td>
<td style="text-align: left;">64.75</td>
<td style="text-align: left;">2.19</td>
<td style="text-align: left;">18.86</td>
<td style="text-align: left;">0.37</td>
<td style="text-align: left;">0.20</td>
<td style="text-align: left;">6.70</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">12.77</td>
<td style="text-align: left;">4.66</td>
<td style="text-align: left;">1.64</td>
<td style="text-align: left;">3.64</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">8.03</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.47</td>
<td style="text-align: left;">20.79</td>
<td style="text-align: left;">2.38</td>
<td style="text-align: left;">5.13</td>
<td style="text-align: left;">16.80</td>
<td style="text-align: left;">5.58</td>
<td style="text-align: left;">4.59</td>
<td style="text-align: left;">0.49</td>
<td style="text-align: left;">10.82</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.22</td>
<td style="text-align: left;">1.11</td>
<td style="text-align: left;">2.49</td>
<td style="text-align: left;">3.06</td>
<td style="text-align: left;">1.51</td>
<td style="text-align: left;">7.99</td>
<td style="text-align: left;">10.27</td>
<td style="text-align: left;">7.90</td>
<td style="text-align: left;">31.30</td>
<td style="text-align: left;">35.24</td>
<td style="text-align: left;">9.84</td>
<td style="text-align: left;">0.31</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">2.22</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">0.22</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">3.42</td>
<td style="text-align: left;">9.25</td>
<td style="text-align: left;">37.74</td>
<td style="text-align: left;">10.64</td>
<td style="text-align: left;">119.01</td>
<td style="text-align: left;">0.90</td>
<td style="text-align: left;">6.13</td>
<td style="text-align: left;">4.61</td>
<td style="text-align: left;">4.59</td>
<td style="text-align: left;">15.17</td>
<td style="text-align: left;">1.03</td>
<td style="text-align: left;">74.99</td>
<td style="text-align: left;">3.94</td>
<td style="text-align: left;">20.05</td>
<td style="text-align: left;">1.57</td>
<td style="text-align: left;">0.40</td>
<td style="text-align: left;">6.70</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">18.83</td>
<td style="text-align: left;">7.37</td>
<td style="text-align: left;">2.91</td>
<td style="text-align: left;">0.91</td>
</tr>
<tr class="even">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">7.27</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">6.40</td>
<td style="text-align: left;">26.58</td>
<td style="text-align: left;">2.79</td>
<td style="text-align: left;">8.09</td>
<td style="text-align: left;">17.76</td>
<td style="text-align: left;">3.43</td>
<td style="text-align: left;">7.52</td>
<td style="text-align: left;">1.67</td>
<td style="text-align: left;">6.75</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">1.33</td>
<td style="text-align: left;">5.04</td>
<td style="text-align: left;">2.65</td>
<td style="text-align: left;">1.19</td>
<td style="text-align: left;">11.53</td>
<td style="text-align: left;">9.54</td>
<td style="text-align: left;">5.52</td>
<td style="text-align: left;">34.97</td>
<td style="text-align: left;">37.89</td>
<td style="text-align: left;">4.09</td>
<td style="text-align: left;">0.08</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">2.69</td>
<td style="text-align: left;">0.55</td>
<td style="text-align: left;">0.22</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">15.60</td>
<td style="text-align: left;">10.66</td>
<td style="text-align: left;">36.30</td>
<td style="text-align: left;">12.60</td>
<td style="text-align: left;">153.60</td>
<td style="text-align: left;">2.56</td>
<td style="text-align: left;">5.33</td>
<td style="text-align: left;">5.72</td>
<td style="text-align: left;">4.91</td>
<td style="text-align: left;">11.52</td>
<td style="text-align: left;">0.74</td>
<td style="text-align: left;">82.12</td>
<td style="text-align: left;">2.04</td>
<td style="text-align: left;">12.54</td>
<td style="text-align: left;">3.44</td>
<td style="text-align: left;">0.60</td>
<td style="text-align: left;">1.12</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">17.73</td>
<td style="text-align: left;">5.01</td>
<td style="text-align: left;">3.25</td>
<td style="text-align: left;">10.45</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Check the data type for the fields.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(me)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   3952 obs. of  53 variables:
 $ YEAR                : int  1928 1928 1928 1928 1928 1928 1928 1928 1928 1928 ...
 $ WEEK                : int  1 2 3 4 5 6 7 8 9 10 ...
 $ ALABAMA             : chr  "3.67" "6.25" "7.95" "12.58" ...
 $ ALASKA              : chr  "-" "-" "-" "-" ...
 $ ARIZONA             : chr  "1.90" "6.40" "4.50" "1.90" ...
 $ ARKANSAS            : chr  "4.11" "9.91" "11.15" "13.75" ...
 $ CALIFORNIA          : chr  "1.38" "1.80" "1.31" "1.87" ...
 $ COLORADO            : chr  "8.38" "6.02" "2.86" "13.71" ...
 $ CONNECTICUT         : chr  "4.50" "9.00" "8.81" "10.40" ...
 $ DELAWARE            : chr  "8.58" "7.30" "15.88" "4.29" ...
 $ DISTRICT.OF.COLUMBIA: chr  "-" "-" "-" "4.18" ...
 $ FLORIDA             : chr  "0.21" "0.49" "0.42" "0.91" ...
 $ GEORGIA             : chr  "1.17" "5.96" "-" "8.65" ...
 $ HAWAII              : chr  "-" "-" "-" "-" ...
 $ IDAHO               : chr  "-" "0.45" "0.45" "-" ...
 $ ILLINOIS            : chr  "0.50" "0.77" "0.61" "0.81" ...
 $ INDIANA             : chr  "1.34" "2.71" "1.71" "4.11" ...
 $ IOWA                : chr  "0.16" "-" "-" "3.51" ...
 $ KANSAS              : chr  "0.81" "1.35" "1.41" "1.14" ...
 $ KENTUCKY            : chr  "3.08" "1.99" "5.26" "5.49" ...
 $ LOUISIANA           : chr  "1.89" "3.00" "2.33" "4.02" ...
 $ MAINE               : chr  "4.52" "7.40" "6.78" "9.41" ...
 $ MARYLAND            : chr  "10.87" "15.47" "21.43" "22.67" ...
 $ MASSACHUSETTS       : chr  "25.66" "28.50" "34.76" "31.28" ...
 $ MICHIGAN            : chr  "5.68" "7.59" "9.39" "8.66" ...
 $ MINNESOTA           : chr  "0.31" "0.23" "0.15" "0.12" ...
 $ MISSISSIPPI         : chr  "-" "-" "-" "-" ...
 $ MISSOURI            : chr  "1.19" "0.83" "1.69" "1.58" ...
 $ MONTANA             : chr  "0.18" "0.18" "0.74" "-" ...
 $ NEBRASKA            : chr  "1.60" "0.29" "0.36" "0.44" ...
 $ NEVADA              : chr  "-" "-" "-" "-" ...
 $ NEW.HAMPSHIRE       : chr  "-" "-" "-" "14.53" ...
 $ NEW.JERSEY          : chr  "3.55" "4.74" "6.68" "6.78" ...
 $ NEW.MEXICO          : chr  "14.90" "11.06" "14.90" "27.64" ...
 $ NEW.YORK            : chr  "7.60" "9.65" "8.54" "9.32" ...
 $ NORTH.CAROLINA      : chr  "47.86" "119.70" "110.90" "131.60" ...
 $ NORTH.DAKOTA        : chr  "-" "0.15" "1.20" "3.91" ...
 $ OHIO                : chr  "2.51" "-" "4.86" "4.40" ...
 $ OKLAHOMA            : chr  "4.86" "2.56" "6.27" "4.74" ...
 $ OREGON              : chr  "4.91" "4.91" "3.63" "2.24" ...
 $ PENNSYLVANIA        : chr  "6.97" "8.74" "8.12" "8.39" ...
 $ RHODE.ISLAND        : chr  "1.18" "0.74" "2.65" "0.15" ...
 $ SOUTH.CAROLINA      : chr  "42.04" "83.90" "77.46" "64.75" ...
 $ SOUTH.DAKOTA        : chr  "5.69" "6.57" "2.04" "2.19" ...
 $ TENNESSEE           : chr  "22.03" "16.96" "24.66" "18.86" ...
 $ TEXAS               : chr  "1.18" "0.63" "0.62" "0.37" ...
 $ UTAH                : chr  "0.40" "-" "0.20" "0.20" ...
 $ VERMONT             : chr  "0.28" "0.56" "1.12" "6.70" ...
 $ VIRGINIA            : chr  "-" "-" "-" "-" ...
 $ WASHINGTON          : chr  "14.83" "17.34" "15.67" "12.77" ...
 $ WEST.VIRGINIA       : chr  "3.36" "4.19" "4.19" "4.66" ...
 $ WISCONSIN           : chr  "1.54" "0.96" "4.79" "1.64" ...
 $ WYOMING             : chr  "0.91" "-" "1.36" "3.64" ...</code></pre>
</div>
</div>
<p>Looking at this dataset, there is going to be quite a bit of data clean-up and tidying before we can plot it. Here are the steps we need to take:</p>
<ul>
<li>The data needs to be transformed to long format.</li>
<li>Replace all “-” with NAs</li>
<li>The number of cases across each state is a character and needs to be converted to numeric</li>
<li>Collapse (sum) week-level data to year.</li>
<li>Abbreviate state names</li>
</ul>
</section>
<section id="tidy-data" class="level3">
<h3 class="anchored" data-anchor-id="tidy-data">Tidy Data</h3>
<p>Convert the wide format to long format using the function <code>gather()</code> from package <code>dplyr</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>me1 <span class="ot">&lt;-</span> me <span class="sc">%&gt;%</span> <span class="fu">gather</span>(<span class="at">key=</span>state,<span class="at">value=</span>value,<span class="sc">-</span>YEAR,<span class="sc">-</span>WEEK)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(me1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">YEAR</th>
<th style="text-align: right;">WEEK</th>
<th style="text-align: left;">state</th>
<th style="text-align: left;">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">ALABAMA</td>
<td style="text-align: left;">3.67</td>
</tr>
<tr class="even">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">ALABAMA</td>
<td style="text-align: left;">6.25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">ALABAMA</td>
<td style="text-align: left;">7.95</td>
</tr>
<tr class="even">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">ALABAMA</td>
<td style="text-align: left;">12.58</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">ALABAMA</td>
<td style="text-align: left;">8.03</td>
</tr>
<tr class="even">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">ALABAMA</td>
<td style="text-align: left;">7.27</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Now, replace all ‘-’ with NA in the field value. We use the function <code>str_replace()</code> from R package <code>stringr</code>. Then convert the value field to numeric.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>me2 <span class="ot">&lt;-</span> me1 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">value=</span><span class="fu">str_replace</span>(value,<span class="st">"^-$"</span>,<span class="cn">NA_character_</span>),</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">value=</span><span class="fu">as.numeric</span>(value))</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(me2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">YEAR</th>
<th style="text-align: right;">WEEK</th>
<th style="text-align: left;">state</th>
<th style="text-align: right;">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">ALABAMA</td>
<td style="text-align: right;">3.67</td>
</tr>
<tr class="even">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">ALABAMA</td>
<td style="text-align: right;">6.25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">ALABAMA</td>
<td style="text-align: right;">7.95</td>
</tr>
<tr class="even">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">ALABAMA</td>
<td style="text-align: right;">12.58</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">ALABAMA</td>
<td style="text-align: right;">8.03</td>
</tr>
<tr class="even">
<td style="text-align: right;">1928</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">ALABAMA</td>
<td style="text-align: right;">7.27</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Sum up the week-level information to year-level information. This means rather than having</p>
<pre><code>  YEAR WEEK   state value
1 1928    1 ALABAMA  3.67
2 1928    2 ALABAMA  6.25
3 1928    3 ALABAMA  7.95
...
5501 1957   41 ALASKA  2.16
5502 1957   42 ALASKA  0.43
5503 1957   43 ALASKA  1.30
...</code></pre>
<p>we should have one value per year per state.</p>
<pre><code>  YEAR    state value
1 1928  ALABAMA  3.67
2 1929  ALABAMA  3.20
...
5501 1957  ALASKA  2.16
5502 1958  ALASKA  2.05
...</code></pre>
<p>The solution is to sum up all the cases for a state for all weeks within a year into one value for that year. This can be done using the <code>summarise()</code> function from package <code>dplyr</code>.</p>
<ul>
<li>A custom function is used to sum over weeks. If all values are NA, then result is NA. If some values are NA, the NAs are removed and the remaining numbers are summed.</li>
<li>The dots in state names are replaced by spaces and the words are converted to title case (First letter capital and rest lowercase).</li>
<li>We also convert the column names to lowercase for consistency.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>fun1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">ifelse</span>(<span class="fu">all</span>(<span class="fu">is.na</span>(x)),<span class="cn">NA</span>,<span class="fu">sum</span>(x,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>me3 <span class="ot">&lt;-</span> me2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(YEAR,state) <span class="sc">%&gt;%</span> </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">summarise</span>(<span class="at">total=</span><span class="fu">fun1</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">state=</span><span class="fu">str_replace_all</span>(state,<span class="st">"[.]"</span>,<span class="st">" "</span>),</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">state=</span><span class="fu">str_to_title</span>(state))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'YEAR'. You can override using the
`.groups` argument.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(me3) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">colnames</span>(me3))</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(me3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: left;">state</th>
<th style="text-align: right;">total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1928</td>
<td style="text-align: left;">Alabama</td>
<td style="text-align: right;">334.99</td>
</tr>
<tr class="even">
<td style="text-align: right;">1928</td>
<td style="text-align: left;">Alaska</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1928</td>
<td style="text-align: left;">Arizona</td>
<td style="text-align: right;">200.75</td>
</tr>
<tr class="even">
<td style="text-align: right;">1928</td>
<td style="text-align: left;">Arkansas</td>
<td style="text-align: right;">481.77</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1928</td>
<td style="text-align: left;">California</td>
<td style="text-align: right;">69.22</td>
</tr>
<tr class="even">
<td style="text-align: right;">1928</td>
<td style="text-align: left;">Colorado</td>
<td style="text-align: right;">206.98</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(me3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>gropd_df [3,876 × 3] (S3: grouped_df/tbl_df/tbl/data.frame)
 $ year : int [1:3876] 1928 1928 1928 1928 1928 1928 1928 1928 1928 1928 ...
 $ state: chr [1:3876] "Alabama" "Alaska" "Arizona" "Arkansas" ...
 $ total: num [1:3876] 335 NA 200.8 481.8 69.2 ...
 - attr(*, "groups")= tibble [76 × 2] (S3: tbl_df/tbl/data.frame)
  ..$ year : int [1:76] 1928 1929 1930 1931 1932 1933 1934 1935 1936 1937 ...
  ..$ .rows: list&lt;int&gt; [1:76] 
  .. ..$ : int [1:51] 1 2 3 4 5 6 7 8 9 10 ...
  .. ..$ : int [1:51] 52 53 54 55 56 57 58 59 60 61 ...
  .. ..$ : int [1:51] 103 104 105 106 107 108 109 110 111 112 ...
  .. ..$ : int [1:51] 154 155 156 157 158 159 160 161 162 163 ...
  .. ..$ : int [1:51] 205 206 207 208 209 210 211 212 213 214 ...
  .. ..$ : int [1:51] 256 257 258 259 260 261 262 263 264 265 ...
  .. ..$ : int [1:51] 307 308 309 310 311 312 313 314 315 316 ...
  .. ..$ : int [1:51] 358 359 360 361 362 363 364 365 366 367 ...
  .. ..$ : int [1:51] 409 410 411 412 413 414 415 416 417 418 ...
  .. ..$ : int [1:51] 460 461 462 463 464 465 466 467 468 469 ...
  .. ..$ : int [1:51] 511 512 513 514 515 516 517 518 519 520 ...
  .. ..$ : int [1:51] 562 563 564 565 566 567 568 569 570 571 ...
  .. ..$ : int [1:51] 613 614 615 616 617 618 619 620 621 622 ...
  .. ..$ : int [1:51] 664 665 666 667 668 669 670 671 672 673 ...
  .. ..$ : int [1:51] 715 716 717 718 719 720 721 722 723 724 ...
  .. ..$ : int [1:51] 766 767 768 769 770 771 772 773 774 775 ...
  .. ..$ : int [1:51] 817 818 819 820 821 822 823 824 825 826 ...
  .. ..$ : int [1:51] 868 869 870 871 872 873 874 875 876 877 ...
  .. ..$ : int [1:51] 919 920 921 922 923 924 925 926 927 928 ...
  .. ..$ : int [1:51] 970 971 972 973 974 975 976 977 978 979 ...
  .. ..$ : int [1:51] 1021 1022 1023 1024 1025 1026 1027 1028 1029 1030 ...
  .. ..$ : int [1:51] 1072 1073 1074 1075 1076 1077 1078 1079 1080 1081 ...
  .. ..$ : int [1:51] 1123 1124 1125 1126 1127 1128 1129 1130 1131 1132 ...
  .. ..$ : int [1:51] 1174 1175 1176 1177 1178 1179 1180 1181 1182 1183 ...
  .. ..$ : int [1:51] 1225 1226 1227 1228 1229 1230 1231 1232 1233 1234 ...
  .. ..$ : int [1:51] 1276 1277 1278 1279 1280 1281 1282 1283 1284 1285 ...
  .. ..$ : int [1:51] 1327 1328 1329 1330 1331 1332 1333 1334 1335 1336 ...
  .. ..$ : int [1:51] 1378 1379 1380 1381 1382 1383 1384 1385 1386 1387 ...
  .. ..$ : int [1:51] 1429 1430 1431 1432 1433 1434 1435 1436 1437 1438 ...
  .. ..$ : int [1:51] 1480 1481 1482 1483 1484 1485 1486 1487 1488 1489 ...
  .. ..$ : int [1:51] 1531 1532 1533 1534 1535 1536 1537 1538 1539 1540 ...
  .. ..$ : int [1:51] 1582 1583 1584 1585 1586 1587 1588 1589 1590 1591 ...
  .. ..$ : int [1:51] 1633 1634 1635 1636 1637 1638 1639 1640 1641 1642 ...
  .. ..$ : int [1:51] 1684 1685 1686 1687 1688 1689 1690 1691 1692 1693 ...
  .. ..$ : int [1:51] 1735 1736 1737 1738 1739 1740 1741 1742 1743 1744 ...
  .. ..$ : int [1:51] 1786 1787 1788 1789 1790 1791 1792 1793 1794 1795 ...
  .. ..$ : int [1:51] 1837 1838 1839 1840 1841 1842 1843 1844 1845 1846 ...
  .. ..$ : int [1:51] 1888 1889 1890 1891 1892 1893 1894 1895 1896 1897 ...
  .. ..$ : int [1:51] 1939 1940 1941 1942 1943 1944 1945 1946 1947 1948 ...
  .. ..$ : int [1:51] 1990 1991 1992 1993 1994 1995 1996 1997 1998 1999 ...
  .. ..$ : int [1:51] 2041 2042 2043 2044 2045 2046 2047 2048 2049 2050 ...
  .. ..$ : int [1:51] 2092 2093 2094 2095 2096 2097 2098 2099 2100 2101 ...
  .. ..$ : int [1:51] 2143 2144 2145 2146 2147 2148 2149 2150 2151 2152 ...
  .. ..$ : int [1:51] 2194 2195 2196 2197 2198 2199 2200 2201 2202 2203 ...
  .. ..$ : int [1:51] 2245 2246 2247 2248 2249 2250 2251 2252 2253 2254 ...
  .. ..$ : int [1:51] 2296 2297 2298 2299 2300 2301 2302 2303 2304 2305 ...
  .. ..$ : int [1:51] 2347 2348 2349 2350 2351 2352 2353 2354 2355 2356 ...
  .. ..$ : int [1:51] 2398 2399 2400 2401 2402 2403 2404 2405 2406 2407 ...
  .. ..$ : int [1:51] 2449 2450 2451 2452 2453 2454 2455 2456 2457 2458 ...
  .. ..$ : int [1:51] 2500 2501 2502 2503 2504 2505 2506 2507 2508 2509 ...
  .. ..$ : int [1:51] 2551 2552 2553 2554 2555 2556 2557 2558 2559 2560 ...
  .. ..$ : int [1:51] 2602 2603 2604 2605 2606 2607 2608 2609 2610 2611 ...
  .. ..$ : int [1:51] 2653 2654 2655 2656 2657 2658 2659 2660 2661 2662 ...
  .. ..$ : int [1:51] 2704 2705 2706 2707 2708 2709 2710 2711 2712 2713 ...
  .. ..$ : int [1:51] 2755 2756 2757 2758 2759 2760 2761 2762 2763 2764 ...
  .. ..$ : int [1:51] 2806 2807 2808 2809 2810 2811 2812 2813 2814 2815 ...
  .. ..$ : int [1:51] 2857 2858 2859 2860 2861 2862 2863 2864 2865 2866 ...
  .. ..$ : int [1:51] 2908 2909 2910 2911 2912 2913 2914 2915 2916 2917 ...
  .. ..$ : int [1:51] 2959 2960 2961 2962 2963 2964 2965 2966 2967 2968 ...
  .. ..$ : int [1:51] 3010 3011 3012 3013 3014 3015 3016 3017 3018 3019 ...
  .. ..$ : int [1:51] 3061 3062 3063 3064 3065 3066 3067 3068 3069 3070 ...
  .. ..$ : int [1:51] 3112 3113 3114 3115 3116 3117 3118 3119 3120 3121 ...
  .. ..$ : int [1:51] 3163 3164 3165 3166 3167 3168 3169 3170 3171 3172 ...
  .. ..$ : int [1:51] 3214 3215 3216 3217 3218 3219 3220 3221 3222 3223 ...
  .. ..$ : int [1:51] 3265 3266 3267 3268 3269 3270 3271 3272 3273 3274 ...
  .. ..$ : int [1:51] 3316 3317 3318 3319 3320 3321 3322 3323 3324 3325 ...
  .. ..$ : int [1:51] 3367 3368 3369 3370 3371 3372 3373 3374 3375 3376 ...
  .. ..$ : int [1:51] 3418 3419 3420 3421 3422 3423 3424 3425 3426 3427 ...
  .. ..$ : int [1:51] 3469 3470 3471 3472 3473 3474 3475 3476 3477 3478 ...
  .. ..$ : int [1:51] 3520 3521 3522 3523 3524 3525 3526 3527 3528 3529 ...
  .. ..$ : int [1:51] 3571 3572 3573 3574 3575 3576 3577 3578 3579 3580 ...
  .. ..$ : int [1:51] 3622 3623 3624 3625 3626 3627 3628 3629 3630 3631 ...
  .. ..$ : int [1:51] 3673 3674 3675 3676 3677 3678 3679 3680 3681 3682 ...
  .. ..$ : int [1:51] 3724 3725 3726 3727 3728 3729 3730 3731 3732 3733 ...
  .. ..$ : int [1:51] 3775 3776 3777 3778 3779 3780 3781 3782 3783 3784 ...
  .. ..$ : int [1:51] 3826 3827 3828 3829 3830 3831 3832 3833 3834 3835 ...
  .. ..@ ptype: int(0) 
  ..- attr(*, ".drop")= logi TRUE</code></pre>
</div>
</div>
<p>The data is now ready for plotting.</p>
</section>
<section id="tile" class="level3">
<h3 class="anchored" data-anchor-id="tile">Tile</h3>
<p>We can build up a basic ggplot and heatmap tiles can be plotted using the geom <code>geom_tile</code>. ‘year’ is mapped to the x-axis, ‘state’ to the y-axis and fill color for the tiles is the ‘total’ value.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(me3,<span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span>state,<span class="at">fill=</span>total))<span class="sc">+</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_tile</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>Add borders around the tiles. We use <code>reorder(state,desc(state))</code> to reverse the order of states so that it reads A-Z from top to bottom.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(me3,<span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span><span class="fu">reorder</span>(state,<span class="fu">desc</span>(state)),<span class="at">fill=</span>total))<span class="sc">+</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>(<span class="at">color=</span><span class="st">"white"</span>,<span class="at">size=</span><span class="fl">0.25</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="scales" class="level3">
<h3 class="anchored" data-anchor-id="scales">Scales</h3>
<p>The extra space on left and right (gray) of the plot is removed using argument <code>expand</code> in <code>scales</code>. X-axis breaks are redefined at 10 year intervals from 1930 to 2010. Custom colors are used for the tiles: <code>"#e7f0fa","#c9e2f6","#95cbee","#0099dc","#4ab04a", "#ffd73e","#eec73a","#e29421","#f05336","#ce472e"</code>. Since the color scale is a fill color on a continuous value and we want to supply n new colors, we use <code>scale_fill_gradientn</code>. Tiles with missing value is set to the color <code>"grey90"</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#e7f0fa"</span>,<span class="st">"#c9e2f6"</span>,<span class="st">"#95cbee"</span>,<span class="st">"#0099dc"</span>,<span class="st">"#4ab04a"</span>, <span class="st">"#ffd73e"</span>,<span class="st">"#eec73a"</span>,<span class="st">"#e29421"</span>,<span class="st">"#f05336"</span>,<span class="st">"#ce472e"</span>)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">1930</span>,<span class="dv">2010</span>,<span class="at">by=</span><span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradientn</span>(<span class="at">colors=</span>cols,<span class="at">na.value=</span><span class="st">"grey95"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>The fill scale can be further refined to resemble that of the original plot.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#e7f0fa"</span>,<span class="st">"#c9e2f6"</span>,<span class="st">"#95cbee"</span>,<span class="st">"#0099dc"</span>,<span class="st">"#4ab04a"</span>, <span class="st">"#ffd73e"</span>,<span class="st">"#eec73a"</span>,<span class="st">"#e29421"</span>,<span class="st">"#f05336"</span>,<span class="st">"#ce472e"</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_x_continuous</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">1930</span>,<span class="dv">2010</span>,<span class="at">by=</span><span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_gradientn</span>(<span class="at">colors=</span>cols,<span class="at">na.value=</span><span class="st">"grey95"</span>,</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">4000</span>),</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">values=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.01</span>,<span class="fl">0.02</span>,<span class="fl">0.03</span>,<span class="fl">0.09</span>,<span class="fl">0.1</span>,<span class="fl">0.15</span>,<span class="fl">0.25</span>,<span class="fl">0.4</span>,<span class="fl">0.5</span>,<span class="dv">1</span>),</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"0k"</span>,<span class="st">"1k"</span>,<span class="st">"2k"</span>,<span class="st">"3k"</span>,<span class="st">"4k"</span>),</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>                             <span class="at">guide=</span><span class="fu">guide_colourbar</span>(<span class="at">ticks=</span>T,<span class="at">nbin=</span><span class="dv">50</span>,</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">barheight=</span>.<span class="dv">5</span>,<span class="at">label=</span>T, </span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">barwidth=</span><span class="dv">10</span>))</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="title-1" class="level3">
<h3 class="anchored" data-anchor-id="title-1">Title</h3>
<p>We can remove the x and y axes titles and add a plot title.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span><span class="fu">labs</span>(<span class="at">x=</span><span class="st">""</span>,<span class="at">y=</span><span class="st">""</span>,<span class="at">fill=</span><span class="st">""</span>,<span class="at">title=</span><span class="st">"Measles"</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fixed-coords" class="level3">
<h3 class="anchored" data-anchor-id="fixed-coords">Fixed Coords</h3>
<p>We can use <code>coord_fixed()</code> to fix the coordinates for equal values in x and y direction. This should render perfectly square tiles.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span><span class="fu">coord_fixed</span>()</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="annotation" class="level3">
<h3 class="anchored" data-anchor-id="annotation">Annotation</h3>
<p>Add the annotation line and text to denote the introduction of the vaccine. The line is at the position 1963. Custom font ‘Gidole’ is used here. This can be skipped.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span><span class="fu">geom_segment</span>(<span class="at">x=</span><span class="dv">1963</span>,<span class="at">xend=</span><span class="dv">1963</span>,<span class="at">y=</span><span class="dv">0</span>,<span class="at">yend=</span><span class="fl">51.5</span>,<span class="at">size=</span>.<span class="dv">6</span>,<span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">label=</span><span class="st">"Vaccine introduced"</span>,<span class="at">x=</span><span class="dv">1963</span>,<span class="at">y=</span><span class="dv">53</span>, </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">vjust=</span><span class="dv">1</span>,<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">size=</span><span class="fu">I</span>(<span class="dv">3</span>),<span class="at">family=</span><span class="st">"Gidole"</span>)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :
font family not found in Windows font database</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="theme-1" class="level3">
<h3 class="anchored" data-anchor-id="theme-1">Theme</h3>
<p>Here we change the following aspects of the plot using <code>theme</code>:</p>
<ul>
<li>Change theme to <code>theme_minimal</code> to remove unnecessary plot elements.</li>
<li>Optional custom font. See ‘Custom font’ section under ‘Economist Scatterplot’.</li>
<li>Position the legend to bottom center.</li>
<li>Set legend font to color grey20.</li>
<li>Adjust size and justification of x and y axes text</li>
<li>Adjust title justification</li>
<li>Remove all gridlines</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>p<span class="sc">+</span><span class="fu">theme_minimal</span>(<span class="at">base_family=</span><span class="st">"Gidole"</span>)<span class="sc">+</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>,</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification=</span><span class="st">"center"</span>,</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.direction=</span><span class="st">"horizontal"</span>,</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"grey20"</span>),</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">6</span>,<span class="at">hjust=</span><span class="dv">1</span>,<span class="at">vjust=</span><span class="fl">0.5</span>),</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">title=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="sc">-</span>.<span class="dv">07</span>,<span class="at">vjust=</span><span class="dv">1</span>),</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid=</span><span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ggplot2_lab_part2_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<p>Our plot is ready and we can compare it to the original version.</p>
<p><img src="assets/wsj-heatmap.png" class="img-fluid"></p>
<p>The full code for this challenge is here:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># custom summing function</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>fun1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">ifelse</span>(<span class="fu">all</span>(<span class="fu">is.na</span>(x)),<span class="cn">NA</span>,<span class="fu">sum</span>(x,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co"># read data</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>me3 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"assets/data_wsj.csv"</span>,<span class="at">header=</span>T,</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">stringsAsFactors=</span>F,<span class="at">skip=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">gather</span>(<span class="at">key=</span>state,<span class="at">value=</span>value,<span class="sc">-</span>YEAR,<span class="sc">-</span>WEEK) <span class="sc">%&gt;%</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">value=</span><span class="fu">str_replace</span>(value,<span class="st">"^-$"</span>,<span class="cn">NA_character_</span>),</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>                            <span class="at">value=</span><span class="fu">as.numeric</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(YEAR,state) <span class="sc">%&gt;%</span> </span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">summarise</span>(<span class="at">total=</span><span class="fu">fun1</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">mutate</span>(<span class="at">state=</span><span class="fu">str_replace_all</span>(state,<span class="st">"[.]"</span>,<span class="st">" "</span>),</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>                             <span class="at">state=</span><span class="fu">str_to_title</span>(state))</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(me3) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">colnames</span>(me3))</span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a><span class="co"># custom colors</span></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#e7f0fa"</span>,<span class="st">"#c9e2f6"</span>,<span class="st">"#95cbee"</span>,<span class="st">"#0099dc"</span>,<span class="st">"#4ab04a"</span>, <span class="st">"#ffd73e"</span>,<span class="st">"#eec73a"</span>,<span class="st">"#e29421"</span>,<span class="st">"#f05336"</span>,<span class="st">"#ce472e"</span>)</span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting</span></span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(me3,<span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span><span class="fu">reorder</span>(state,<span class="fu">desc</span>(state)),<span class="at">fill=</span>total))<span class="sc">+</span></span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>(<span class="at">color=</span><span class="st">"white"</span>,<span class="at">size=</span><span class="fl">0.25</span>)<span class="sc">+</span></span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_discrete</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">1930</span>,<span class="dv">2010</span>,<span class="at">by=</span><span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_gradientn</span>(<span class="at">colors=</span>cols,<span class="at">na.value=</span><span class="st">"grey95"</span>,</span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a>                           <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">4000</span>),</span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a>                           <span class="at">values=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.01</span>,<span class="fl">0.02</span>,<span class="fl">0.03</span>,<span class="fl">0.09</span>,<span class="fl">0.1</span>,<span class="fl">0.15</span>,<span class="fl">0.25</span>,<span class="fl">0.4</span>,<span class="fl">0.5</span>,<span class="dv">1</span>),</span>
<span id="cb101-28"><a href="#cb101-28" aria-hidden="true" tabindex="-1"></a>                           <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"0k"</span>,<span class="st">"1k"</span>,<span class="st">"2k"</span>,<span class="st">"3k"</span>,<span class="st">"4k"</span>),</span>
<span id="cb101-29"><a href="#cb101-29" aria-hidden="true" tabindex="-1"></a>                           <span class="at">guide=</span><span class="fu">guide_colourbar</span>(<span class="at">ticks=</span>T,<span class="at">nbin=</span><span class="dv">50</span>,</span>
<span id="cb101-30"><a href="#cb101-30" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">barheight=</span>.<span class="dv">5</span>,<span class="at">label=</span>T, </span>
<span id="cb101-31"><a href="#cb101-31" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">barwidth=</span><span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb101-32"><a href="#cb101-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x=</span><span class="st">""</span>,<span class="at">y=</span><span class="st">""</span>,<span class="at">fill=</span><span class="st">""</span>,<span class="at">title=</span><span class="st">"Measles"</span>)<span class="sc">+</span></span>
<span id="cb101-33"><a href="#cb101-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_fixed</span>()<span class="sc">+</span></span>
<span id="cb101-34"><a href="#cb101-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_segment</span>(<span class="at">x=</span><span class="dv">1963</span>,<span class="at">xend=</span><span class="dv">1963</span>,<span class="at">y=</span><span class="dv">0</span>,<span class="at">yend=</span><span class="fl">51.5</span>,<span class="at">size=</span>.<span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb101-35"><a href="#cb101-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">label=</span><span class="st">"Vaccine introduced"</span>,<span class="at">x=</span><span class="dv">1963</span>,<span class="at">y=</span><span class="dv">53</span>, </span>
<span id="cb101-36"><a href="#cb101-36" aria-hidden="true" tabindex="-1"></a>               <span class="at">vjust=</span><span class="dv">1</span>,<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">size=</span><span class="fu">I</span>(<span class="dv">3</span>),<span class="at">family=</span><span class="st">"Gidole"</span>)<span class="sc">+</span></span>
<span id="cb101-37"><a href="#cb101-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>(<span class="at">base_family=</span><span class="st">"Gidole"</span>)<span class="sc">+</span></span>
<span id="cb101-38"><a href="#cb101-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(.<span class="dv">5</span>,<span class="sc">-</span>.<span class="dv">13</span>),</span>
<span id="cb101-39"><a href="#cb101-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.direction=</span><span class="st">"horizontal"</span>,</span>
<span id="cb101-40"><a href="#cb101-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"grey20"</span>),</span>
<span id="cb101-41"><a href="#cb101-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin=</span>grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fu">c</span>(.<span class="dv">5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>,<span class="dv">0</span>),<span class="st">"cm"</span>),</span>
<span id="cb101-42"><a href="#cb101-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">6</span>,<span class="at">hjust=</span><span class="dv">1</span>,<span class="at">vjust=</span><span class="fl">0.5</span>),</span>
<span id="cb101-43"><a href="#cb101-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb101-44"><a href="#cb101-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb101-45"><a href="#cb101-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid=</span><span class="fu">element_blank</span>(),</span>
<span id="cb101-46"><a href="#cb101-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">title=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="sc">-</span>.<span class="dv">07</span>,<span class="at">vjust=</span><span class="dv">1</span>),</span>
<span id="cb101-47"><a href="#cb101-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid=</span><span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="acknowledgements" class="level4">
<h4 class="anchored" data-anchor-id="acknowledgements">Acknowledgements:</h4>
<p>• This document was adapted from <a href="https://nbisweden.github.io/raukr-2023/labs/ggplot/">RaukR-2023</a>, • shared under <a href="https://choosealicense.com/licenses/gpl-3.0/">GPL-3 License</a> • <a href="https://www.slubi.se/">SLUBI</a></p>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/yourdomain\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb102" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "ggplot2 Part 2"</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Thanks to Roy Francis, NBIS, RaukR2023 for sharing it"</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Creating plots and graphs using the ggplot2 package."</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> "assets/featured.jpg"</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="co">    title-block-banner: true</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a><span class="co">    smooth-scroll: true</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 4</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: right</span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a><span class="co">    number-types: true</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a><span class="co">    number-depth: 4</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: kable</span></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a><span class="co">    standalone: false</span></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-align: left</span></span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: pulse</span></span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight: kate</span></span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a>These are a series of exercises to help you get started and familiarize yourself with ggplot2 syntax, plot building logic and fine modification of plots. Practice using the *Basics* section and then move on to slightly more complex plots: a scatterplot and a heatmap.</span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-31"><a href="#cb102-31" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb102-32"><a href="#cb102-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-33"><a href="#cb102-33" aria-hidden="true" tabindex="-1"></a>:::: {.columns}</span>
<span id="cb102-34"><a href="#cb102-34" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb102-35"><a href="#cb102-35" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/economist-scatterplot.png)</span></span>
<span id="cb102-36"><a href="#cb102-36" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb102-37"><a href="#cb102-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-38"><a href="#cb102-38" aria-hidden="true" tabindex="-1"></a>::: {.column width="50%"}</span>
<span id="cb102-39"><a href="#cb102-39" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/wsj-heatmap.png)</span></span>
<span id="cb102-40"><a href="#cb102-40" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb102-41"><a href="#cb102-41" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb102-42"><a href="#cb102-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-43"><a href="#cb102-43" aria-hidden="true" tabindex="-1"></a>&lt;br&gt;</span>
<span id="cb102-44"><a href="#cb102-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-45"><a href="#cb102-45" aria-hidden="true" tabindex="-1"></a><span class="fu">## Basics</span></span>
<span id="cb102-46"><a href="#cb102-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-47"><a href="#cb102-47" aria-hidden="true" tabindex="-1"></a>First step is to make sure that the necessary packages are installed and loaded.</span>
<span id="cb102-48"><a href="#cb102-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-51"><a href="#cb102-51" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-52"><a href="#cb102-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb102-53"><a href="#cb102-53" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb102-54"><a href="#cb102-54" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb102-55"><a href="#cb102-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-56"><a href="#cb102-56" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb102-57"><a href="#cb102-57" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb102-58"><a href="#cb102-58" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb102-59"><a href="#cb102-59" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-60"><a href="#cb102-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-61"><a href="#cb102-61" aria-hidden="true" tabindex="-1"></a>We use the <span class="in">`iris`</span> data to get started. This dataset has four continuous variables and one categorical variable. It is important to remember about the data type when plotting graphs.</span>
<span id="cb102-62"><a href="#cb102-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-65"><a href="#cb102-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-66"><a href="#cb102-66" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"iris"</span>)</span>
<span id="cb102-67"><a href="#cb102-67" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris)</span>
<span id="cb102-68"><a href="#cb102-68" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-69"><a href="#cb102-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-70"><a href="#cb102-70" aria-hidden="true" tabindex="-1"></a><span class="fu">### Building a plot</span></span>
<span id="cb102-71"><a href="#cb102-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-72"><a href="#cb102-72" aria-hidden="true" tabindex="-1"></a>ggplot2 plots are initialized by specifying the dataset. This can be saved to a variable or it draws a blank plot.</span>
<span id="cb102-73"><a href="#cb102-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-76"><a href="#cb102-76" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-77"><a href="#cb102-77" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-78"><a href="#cb102-78" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 4</span></span>
<span id="cb102-79"><a href="#cb102-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-80"><a href="#cb102-80" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris)</span>
<span id="cb102-81"><a href="#cb102-81" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-82"><a href="#cb102-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-83"><a href="#cb102-83" aria-hidden="true" tabindex="-1"></a>Now we can specify what we want on the x and y axes using aesthetic mapping. And we specify the geometric using geoms. Note that the variable names do not have double quotes <span class="in">`""`</span> like in base plots.</span>
<span id="cb102-84"><a href="#cb102-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-87"><a href="#cb102-87" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-88"><a href="#cb102-88" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-89"><a href="#cb102-89" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 4</span></span>
<span id="cb102-90"><a href="#cb102-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-91"><a href="#cb102-91" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris)<span class="sc">+</span></span>
<span id="cb102-92"><a href="#cb102-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))</span>
<span id="cb102-93"><a href="#cb102-93" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-94"><a href="#cb102-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-95"><a href="#cb102-95" aria-hidden="true" tabindex="-1"></a><span class="fu">### Multiple geoms</span></span>
<span id="cb102-96"><a href="#cb102-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-97"><a href="#cb102-97" aria-hidden="true" tabindex="-1"></a>Further geoms can be added. For example let's add a regression line. When multiple geoms with the same aesthetics are used, they can be specified as a common mapping. Note that the order in which geoms are plotted depends on the order in which the geoms are supplied in the code. In the code below, the points are plotted first and then the regression line.</span>
<span id="cb102-98"><a href="#cb102-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-101"><a href="#cb102-101" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-102"><a href="#cb102-102" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-103"><a href="#cb102-103" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 4</span></span>
<span id="cb102-104"><a href="#cb102-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-105"><a href="#cb102-105" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-106"><a href="#cb102-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb102-107"><a href="#cb102-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span>
<span id="cb102-108"><a href="#cb102-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-109"><a href="#cb102-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-110"><a href="#cb102-110" aria-hidden="true" tabindex="-1"></a><span class="fu">### Using colors</span></span>
<span id="cb102-111"><a href="#cb102-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-112"><a href="#cb102-112" aria-hidden="true" tabindex="-1"></a>We can use the categorical column <span class="in">`Species`</span> to color the points. The color aesthetic is used by <span class="in">`geom_point`</span> and <span class="in">`geom_smooth`</span>. Three different regression lines are now drawn. Notice that a legend is automatically created.</span>
<span id="cb102-113"><a href="#cb102-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-116"><a href="#cb102-116" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-117"><a href="#cb102-117" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-118"><a href="#cb102-118" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb102-119"><a href="#cb102-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-120"><a href="#cb102-120" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width,<span class="at">color=</span>Species))<span class="sc">+</span></span>
<span id="cb102-121"><a href="#cb102-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb102-122"><a href="#cb102-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span>
<span id="cb102-123"><a href="#cb102-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-124"><a href="#cb102-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-125"><a href="#cb102-125" aria-hidden="true" tabindex="-1"></a>If we wanted to keep a common regression line while keeping the colors for the points, we could specify color aesthetic only for <span class="in">`geom_point`</span>.</span>
<span id="cb102-126"><a href="#cb102-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-129"><a href="#cb102-129" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-130"><a href="#cb102-130" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-131"><a href="#cb102-131" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb102-132"><a href="#cb102-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-133"><a href="#cb102-133" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-134"><a href="#cb102-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species))<span class="sc">+</span></span>
<span id="cb102-135"><a href="#cb102-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span>
<span id="cb102-136"><a href="#cb102-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-137"><a href="#cb102-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-138"><a href="#cb102-138" aria-hidden="true" tabindex="-1"></a><span class="fu">### Aesthetic parameter</span></span>
<span id="cb102-139"><a href="#cb102-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-140"><a href="#cb102-140" aria-hidden="true" tabindex="-1"></a>We can change the size of all points by a fixed amount by specifying size outside the aesthetic parameter.</span>
<span id="cb102-141"><a href="#cb102-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-144"><a href="#cb102-144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-145"><a href="#cb102-145" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-146"><a href="#cb102-146" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb102-147"><a href="#cb102-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-148"><a href="#cb102-148" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-149"><a href="#cb102-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species),<span class="at">size=</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb102-150"><a href="#cb102-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span>
<span id="cb102-151"><a href="#cb102-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-152"><a href="#cb102-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-153"><a href="#cb102-153" aria-hidden="true" tabindex="-1"></a><span class="fu">### Aesthetic mapping</span></span>
<span id="cb102-154"><a href="#cb102-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-155"><a href="#cb102-155" aria-hidden="true" tabindex="-1"></a>We can map another variable as size of the points. This is done by specifying size inside the aesthetic mapping. Now the size of the points denote <span class="in">`Sepal.Width`</span>. A new legend group is created to show this new aesthetic.</span>
<span id="cb102-156"><a href="#cb102-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-159"><a href="#cb102-159" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-160"><a href="#cb102-160" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-161"><a href="#cb102-161" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb102-162"><a href="#cb102-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-163"><a href="#cb102-163" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-164"><a href="#cb102-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species,<span class="at">size=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb102-165"><a href="#cb102-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span>
<span id="cb102-166"><a href="#cb102-166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-167"><a href="#cb102-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-168"><a href="#cb102-168" aria-hidden="true" tabindex="-1"></a><span class="fu">### Discrete colors</span></span>
<span id="cb102-169"><a href="#cb102-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-170"><a href="#cb102-170" aria-hidden="true" tabindex="-1"></a>We can change the default colors by specifying new values inside a scale.</span>
<span id="cb102-171"><a href="#cb102-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-174"><a href="#cb102-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-175"><a href="#cb102-175" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-176"><a href="#cb102-176" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb102-177"><a href="#cb102-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-178"><a href="#cb102-178" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-179"><a href="#cb102-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species,<span class="at">size=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb102-180"><a href="#cb102-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb102-181"><a href="#cb102-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"blue"</span>,<span class="st">"green"</span>))</span>
<span id="cb102-182"><a href="#cb102-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-183"><a href="#cb102-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-184"><a href="#cb102-184" aria-hidden="true" tabindex="-1"></a><span class="fu">### Continuous colors</span></span>
<span id="cb102-185"><a href="#cb102-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-186"><a href="#cb102-186" aria-hidden="true" tabindex="-1"></a>We can also map the colors to a continuous variable. This creates a color bar legend item.</span>
<span id="cb102-187"><a href="#cb102-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-190"><a href="#cb102-190" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-191"><a href="#cb102-191" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-192"><a href="#cb102-192" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb102-193"><a href="#cb102-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-194"><a href="#cb102-194" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-195"><a href="#cb102-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb102-196"><a href="#cb102-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span>
<span id="cb102-197"><a href="#cb102-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-198"><a href="#cb102-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-199"><a href="#cb102-199" aria-hidden="true" tabindex="-1"></a><span class="fu">### Titles</span></span>
<span id="cb102-200"><a href="#cb102-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-201"><a href="#cb102-201" aria-hidden="true" tabindex="-1"></a>Now let's rename the axis labels, change the legend title and add a title, a subtitle and a caption. We change the legend title using <span class="in">`scale_color_continuous()`</span>. All other labels are changed using <span class="in">`labs()`</span>.</span>
<span id="cb102-202"><a href="#cb102-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-205"><a href="#cb102-205" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-206"><a href="#cb102-206" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-207"><a href="#cb102-207" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb102-208"><a href="#cb102-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-209"><a href="#cb102-209" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-210"><a href="#cb102-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb102-211"><a href="#cb102-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb102-212"><a href="#cb102-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_continuous</span>(<span class="at">name=</span><span class="st">"New Legend Title"</span>)<span class="sc">+</span></span>
<span id="cb102-213"><a href="#cb102-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"This Is A Title"</span>,<span class="at">subtitle=</span><span class="st">"This is a subtitle"</span>,<span class="at">x=</span><span class="st">" Petal Length"</span>, </span>
<span id="cb102-214"><a href="#cb102-214" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Petal Width"</span>, <span class="at">caption=</span><span class="st">"This is a little caption."</span>)</span>
<span id="cb102-215"><a href="#cb102-215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-216"><a href="#cb102-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-217"><a href="#cb102-217" aria-hidden="true" tabindex="-1"></a><span class="fu">### Axes modification</span></span>
<span id="cb102-218"><a href="#cb102-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-219"><a href="#cb102-219" aria-hidden="true" tabindex="-1"></a>Let's say we are not happy with the x-axis breaks 2,4,6 etc. We would like to have 1,2,3... We change this using <span class="in">`scale_x_continuous()`</span>.</span>
<span id="cb102-220"><a href="#cb102-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-223"><a href="#cb102-223" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-224"><a href="#cb102-224" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-225"><a href="#cb102-225" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb102-226"><a href="#cb102-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-227"><a href="#cb102-227" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-228"><a href="#cb102-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb102-229"><a href="#cb102-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb102-230"><a href="#cb102-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_continuous</span>(<span class="at">name=</span><span class="st">"New Legend Title"</span>)<span class="sc">+</span></span>
<span id="cb102-231"><a href="#cb102-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb102-232"><a href="#cb102-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"This Is A Title"</span>,<span class="at">subtitle=</span><span class="st">"This is a subtitle"</span>,<span class="at">x=</span><span class="st">" Petal Length"</span>, </span>
<span id="cb102-233"><a href="#cb102-233" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Petal Width"</span>, <span class="at">caption=</span><span class="st">"This is a little caption."</span>)</span>
<span id="cb102-234"><a href="#cb102-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-235"><a href="#cb102-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-236"><a href="#cb102-236" aria-hidden="true" tabindex="-1"></a><span class="fu">### Faceting</span></span>
<span id="cb102-237"><a href="#cb102-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-238"><a href="#cb102-238" aria-hidden="true" tabindex="-1"></a>We can create subplots using the faceting functionality. Let's create three subplots for the three levels of Species.</span>
<span id="cb102-239"><a href="#cb102-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-242"><a href="#cb102-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-243"><a href="#cb102-243" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-244"><a href="#cb102-244" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb102-245"><a href="#cb102-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-246"><a href="#cb102-246" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-247"><a href="#cb102-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb102-248"><a href="#cb102-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb102-249"><a href="#cb102-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_continuous</span>(<span class="at">name=</span><span class="st">"New Legend Title"</span>)<span class="sc">+</span></span>
<span id="cb102-250"><a href="#cb102-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb102-251"><a href="#cb102-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"This Is A Title"</span>,<span class="at">subtitle=</span><span class="st">"This is a subtitle"</span>,<span class="at">x=</span><span class="st">" Petal Length"</span>, </span>
<span id="cb102-252"><a href="#cb102-252" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Petal Width"</span>, <span class="at">caption=</span><span class="st">"This is a little caption."</span>)<span class="sc">+</span></span>
<span id="cb102-253"><a href="#cb102-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Species)</span>
<span id="cb102-254"><a href="#cb102-254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-255"><a href="#cb102-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-256"><a href="#cb102-256" aria-hidden="true" tabindex="-1"></a><span class="fu">### Themes</span></span>
<span id="cb102-257"><a href="#cb102-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-258"><a href="#cb102-258" aria-hidden="true" tabindex="-1"></a>The look of the plot can be changed using themes. Let's can the default <span class="in">`theme_grey()`</span> to <span class="in">`theme_bw()`</span>.</span>
<span id="cb102-259"><a href="#cb102-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-262"><a href="#cb102-262" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-263"><a href="#cb102-263" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-264"><a href="#cb102-264" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb102-265"><a href="#cb102-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-266"><a href="#cb102-266" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-267"><a href="#cb102-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb102-268"><a href="#cb102-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb102-269"><a href="#cb102-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_continuous</span>(<span class="at">name=</span><span class="st">"New Legend Title"</span>)<span class="sc">+</span></span>
<span id="cb102-270"><a href="#cb102-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb102-271"><a href="#cb102-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"This Is A Title"</span>,<span class="at">subtitle=</span><span class="st">"This is a subtitle"</span>,<span class="at">x=</span><span class="st">" Petal Length"</span>, </span>
<span id="cb102-272"><a href="#cb102-272" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Petal Width"</span>, <span class="at">caption=</span><span class="st">"This is a little caption."</span>)<span class="sc">+</span></span>
<span id="cb102-273"><a href="#cb102-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Species)<span class="sc">+</span></span>
<span id="cb102-274"><a href="#cb102-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb102-275"><a href="#cb102-275" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-276"><a href="#cb102-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-277"><a href="#cb102-277" aria-hidden="true" tabindex="-1"></a>All non-data related aspects of the plot can be modified through themes. Let's modify the colors of the title labels and turn off the gridlines. The various parameters for theme can be found using <span class="in">`?theme`</span>.</span>
<span id="cb102-278"><a href="#cb102-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-281"><a href="#cb102-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-282"><a href="#cb102-282" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-283"><a href="#cb102-283" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb102-284"><a href="#cb102-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-285"><a href="#cb102-285" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-286"><a href="#cb102-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb102-287"><a href="#cb102-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb102-288"><a href="#cb102-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_continuous</span>(<span class="at">name=</span><span class="st">"New Legend Title"</span>)<span class="sc">+</span></span>
<span id="cb102-289"><a href="#cb102-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb102-290"><a href="#cb102-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"This Is A Title"</span>,<span class="at">subtitle=</span><span class="st">"This is a subtitle"</span>,<span class="at">x=</span><span class="st">" Petal Length"</span>, </span>
<span id="cb102-291"><a href="#cb102-291" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Petal Width"</span>, <span class="at">caption=</span><span class="st">"This is a little caption."</span>)<span class="sc">+</span></span>
<span id="cb102-292"><a href="#cb102-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Species)<span class="sc">+</span></span>
<span id="cb102-293"><a href="#cb102-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb102-294"><a href="#cb102-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb102-295"><a href="#cb102-295" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"Blue"</span>,<span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb102-296"><a href="#cb102-296" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"Green"</span>,<span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb102-297"><a href="#cb102-297" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle=</span><span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"Pink"</span>),</span>
<span id="cb102-298"><a href="#cb102-298" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid=</span><span class="fu">element_blank</span>()</span>
<span id="cb102-299"><a href="#cb102-299" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb102-300"><a href="#cb102-300" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-301"><a href="#cb102-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-302"><a href="#cb102-302" aria-hidden="true" tabindex="-1"></a>Themes can be saved and reused.</span>
<span id="cb102-303"><a href="#cb102-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-306"><a href="#cb102-306" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-307"><a href="#cb102-307" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-308"><a href="#cb102-308" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb102-309"><a href="#cb102-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-310"><a href="#cb102-310" aria-hidden="true" tabindex="-1"></a>newtheme <span class="ot">&lt;-</span> <span class="fu">theme</span>(</span>
<span id="cb102-311"><a href="#cb102-311" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"Blue"</span>,<span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb102-312"><a href="#cb102-312" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"Green"</span>,<span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb102-313"><a href="#cb102-313" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle=</span><span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"Pink"</span>),</span>
<span id="cb102-314"><a href="#cb102-314" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid=</span><span class="fu">element_blank</span>())</span>
<span id="cb102-315"><a href="#cb102-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-316"><a href="#cb102-316" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-317"><a href="#cb102-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb102-318"><a href="#cb102-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb102-319"><a href="#cb102-319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_continuous</span>(<span class="at">name=</span><span class="st">"New Legend Title"</span>)<span class="sc">+</span></span>
<span id="cb102-320"><a href="#cb102-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)<span class="sc">+</span></span>
<span id="cb102-321"><a href="#cb102-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"This Is A Title"</span>,<span class="at">subtitle=</span><span class="st">"This is a subtitle"</span>,<span class="at">x=</span><span class="st">" Petal Length"</span>, </span>
<span id="cb102-322"><a href="#cb102-322" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Petal Width"</span>, <span class="at">caption=</span><span class="st">"This is a little caption."</span>)<span class="sc">+</span></span>
<span id="cb102-323"><a href="#cb102-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Species)<span class="sc">+</span></span>
<span id="cb102-324"><a href="#cb102-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb102-325"><a href="#cb102-325" aria-hidden="true" tabindex="-1"></a>  newtheme</span>
<span id="cb102-326"><a href="#cb102-326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-327"><a href="#cb102-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-328"><a href="#cb102-328" aria-hidden="true" tabindex="-1"></a><span class="fu">### Controlling legends</span></span>
<span id="cb102-329"><a href="#cb102-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-330"><a href="#cb102-330" aria-hidden="true" tabindex="-1"></a>Here we see two legends based on the two aesthetic mappings.</span>
<span id="cb102-331"><a href="#cb102-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-334"><a href="#cb102-334" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-335"><a href="#cb102-335" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-336"><a href="#cb102-336" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb102-337"><a href="#cb102-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-338"><a href="#cb102-338" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-339"><a href="#cb102-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species,<span class="at">size=</span>Sepal.Width))</span>
<span id="cb102-340"><a href="#cb102-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-341"><a href="#cb102-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-342"><a href="#cb102-342" aria-hidden="true" tabindex="-1"></a>If we don't want to have the extra legend, we can turn off legends individually by aesthetic.</span>
<span id="cb102-343"><a href="#cb102-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-346"><a href="#cb102-346" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-347"><a href="#cb102-347" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-348"><a href="#cb102-348" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb102-349"><a href="#cb102-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-350"><a href="#cb102-350" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-351"><a href="#cb102-351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species,<span class="at">size=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb102-352"><a href="#cb102-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size=</span><span class="st">"none"</span>)</span>
<span id="cb102-353"><a href="#cb102-353" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-354"><a href="#cb102-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-355"><a href="#cb102-355" aria-hidden="true" tabindex="-1"></a>We can also turn off legends by geom.</span>
<span id="cb102-356"><a href="#cb102-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-359"><a href="#cb102-359" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-360"><a href="#cb102-360" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-361"><a href="#cb102-361" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb102-362"><a href="#cb102-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-363"><a href="#cb102-363" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-364"><a href="#cb102-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species,<span class="at">size=</span>Sepal.Width),<span class="at">show.legend=</span><span class="cn">FALSE</span>)</span>
<span id="cb102-365"><a href="#cb102-365" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-366"><a href="#cb102-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-367"><a href="#cb102-367" aria-hidden="true" tabindex="-1"></a>Legends can be moved around using theme.</span>
<span id="cb102-368"><a href="#cb102-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-371"><a href="#cb102-371" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-372"><a href="#cb102-372" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-373"><a href="#cb102-373" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb102-374"><a href="#cb102-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-375"><a href="#cb102-375" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-376"><a href="#cb102-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species,<span class="at">size=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb102-377"><a href="#cb102-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>,</span>
<span id="cb102-378"><a href="#cb102-378" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification=</span><span class="st">"right"</span>)</span>
<span id="cb102-379"><a href="#cb102-379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-380"><a href="#cb102-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-381"><a href="#cb102-381" aria-hidden="true" tabindex="-1"></a>Legend rows can be controlled in a finer manner.</span>
<span id="cb102-382"><a href="#cb102-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-385"><a href="#cb102-385" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-386"><a href="#cb102-386" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-387"><a href="#cb102-387" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb102-388"><a href="#cb102-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-389"><a href="#cb102-389" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-390"><a href="#cb102-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species,<span class="at">size=</span>Sepal.Width))<span class="sc">+</span></span>
<span id="cb102-391"><a href="#cb102-391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size=</span><span class="fu">guide_legend</span>(<span class="at">nrow=</span><span class="dv">2</span>,<span class="at">byrow=</span><span class="cn">TRUE</span>),</span>
<span id="cb102-392"><a href="#cb102-392" aria-hidden="true" tabindex="-1"></a>         <span class="at">color=</span><span class="fu">guide_legend</span>(<span class="at">nrow=</span><span class="dv">3</span>,<span class="at">byrow=</span>T))<span class="sc">+</span></span>
<span id="cb102-393"><a href="#cb102-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>,</span>
<span id="cb102-394"><a href="#cb102-394" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification=</span><span class="st">"right"</span>)</span>
<span id="cb102-395"><a href="#cb102-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-396"><a href="#cb102-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-397"><a href="#cb102-397" aria-hidden="true" tabindex="-1"></a><span class="fu">### Labelling</span></span>
<span id="cb102-398"><a href="#cb102-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-399"><a href="#cb102-399" aria-hidden="true" tabindex="-1"></a>Items on the plot can be labelled using the <span class="in">`geom_text`</span> or <span class="in">`geom_label`</span> geoms.</span>
<span id="cb102-400"><a href="#cb102-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-403"><a href="#cb102-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-404"><a href="#cb102-404" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-405"><a href="#cb102-405" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb102-406"><a href="#cb102-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-407"><a href="#cb102-407" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-408"><a href="#cb102-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species))<span class="sc">+</span></span>
<span id="cb102-409"><a href="#cb102-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>Species,<span class="at">hjust=</span><span class="dv">0</span>),<span class="at">nudge_x=</span><span class="fl">0.5</span>,<span class="at">size=</span><span class="dv">3</span>)</span>
<span id="cb102-410"><a href="#cb102-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-411"><a href="#cb102-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-414"><a href="#cb102-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-415"><a href="#cb102-415" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-416"><a href="#cb102-416" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 5</span></span>
<span id="cb102-417"><a href="#cb102-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-418"><a href="#cb102-418" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-419"><a href="#cb102-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species))<span class="sc">+</span></span>
<span id="cb102-420"><a href="#cb102-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label=</span>Species,<span class="at">hjust=</span><span class="dv">0</span>),<span class="at">nudge_x=</span><span class="fl">0.5</span>,<span class="at">size=</span><span class="dv">3</span>)</span>
<span id="cb102-421"><a href="#cb102-421" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-422"><a href="#cb102-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-423"><a href="#cb102-423" aria-hidden="true" tabindex="-1"></a>The R package <span class="in">`ggrepel`</span> allows for non-overlapping labels.</span>
<span id="cb102-424"><a href="#cb102-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-427"><a href="#cb102-427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-428"><a href="#cb102-428" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-429"><a href="#cb102-429" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb102-430"><a href="#cb102-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-431"><a href="#cb102-431" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb102-432"><a href="#cb102-432" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-433"><a href="#cb102-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species))<span class="sc">+</span></span>
<span id="cb102-434"><a href="#cb102-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label=</span>Species),<span class="at">size=</span><span class="dv">3</span>)</span>
<span id="cb102-435"><a href="#cb102-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-436"><a href="#cb102-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-437"><a href="#cb102-437" aria-hidden="true" tabindex="-1"></a><span class="fu">### Annotations</span></span>
<span id="cb102-438"><a href="#cb102-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-439"><a href="#cb102-439" aria-hidden="true" tabindex="-1"></a>Custom annotations of any geom can be added arbitrarily anywhere on the plot.</span>
<span id="cb102-440"><a href="#cb102-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-443"><a href="#cb102-443" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-444"><a href="#cb102-444" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-445"><a href="#cb102-445" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb102-446"><a href="#cb102-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-447"><a href="#cb102-447" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Petal.Length,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-448"><a href="#cb102-448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Species))<span class="sc">+</span></span>
<span id="cb102-449"><a href="#cb102-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">x=</span><span class="fl">2.5</span>,<span class="at">y=</span><span class="fl">2.1</span>,<span class="at">label=</span><span class="st">"There is a random line here"</span>)<span class="sc">+</span></span>
<span id="cb102-450"><a href="#cb102-450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"segment"</span>,<span class="at">x=</span><span class="dv">2</span>,<span class="at">xend=</span><span class="dv">4</span>,<span class="at">y=</span><span class="fl">1.5</span>,<span class="at">yend=</span><span class="dv">2</span>)</span>
<span id="cb102-451"><a href="#cb102-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-452"><a href="#cb102-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-453"><a href="#cb102-453" aria-hidden="true" tabindex="-1"></a><span class="fu">### Barplots</span></span>
<span id="cb102-454"><a href="#cb102-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-457"><a href="#cb102-457" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-458"><a href="#cb102-458" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-459"><a href="#cb102-459" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb102-460"><a href="#cb102-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-461"><a href="#cb102-461" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Species,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-462"><a href="#cb102-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>)</span>
<span id="cb102-463"><a href="#cb102-463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-464"><a href="#cb102-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-465"><a href="#cb102-465" aria-hidden="true" tabindex="-1"></a><span class="fu">### Flip axes</span></span>
<span id="cb102-466"><a href="#cb102-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-467"><a href="#cb102-467" aria-hidden="true" tabindex="-1"></a>x and y axes can be flipped using <span class="in">`coord_flip`</span>.</span>
<span id="cb102-468"><a href="#cb102-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-471"><a href="#cb102-471" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-472"><a href="#cb102-472" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-473"><a href="#cb102-473" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb102-474"><a href="#cb102-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-475"><a href="#cb102-475" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>iris,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Species,<span class="at">y=</span>Petal.Width))<span class="sc">+</span></span>
<span id="cb102-476"><a href="#cb102-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb102-477"><a href="#cb102-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb102-478"><a href="#cb102-478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-479"><a href="#cb102-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-480"><a href="#cb102-480" aria-hidden="true" tabindex="-1"></a><span class="fu">### Error Bars</span></span>
<span id="cb102-481"><a href="#cb102-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-482"><a href="#cb102-482" aria-hidden="true" tabindex="-1"></a>An example of using error bars with points. The mean and standard deviation is computed. This is used to create upper and lower bounds for the error bars.</span>
<span id="cb102-483"><a href="#cb102-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-486"><a href="#cb102-486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-487"><a href="#cb102-487" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-488"><a href="#cb102-488" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb102-489"><a href="#cb102-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-490"><a href="#cb102-490" aria-hidden="true" tabindex="-1"></a>dfr <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Species) <span class="sc">%&gt;%</span> </span>
<span id="cb102-491"><a href="#cb102-491" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean=</span><span class="fu">mean</span>(Sepal.Length),<span class="at">sd=</span><span class="fu">sd</span>(Sepal.Length)) <span class="sc">%&gt;%</span></span>
<span id="cb102-492"><a href="#cb102-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">high=</span>mean<span class="sc">+</span>sd,<span class="at">low=</span>mean<span class="sc">-</span>sd)</span>
<span id="cb102-493"><a href="#cb102-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-494"><a href="#cb102-494" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dfr,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>Species,<span class="at">y=</span>mean,<span class="at">color=</span>Species))<span class="sc">+</span></span>
<span id="cb102-495"><a href="#cb102-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb102-496"><a href="#cb102-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymax=</span>high,<span class="at">ymin=</span>low),<span class="at">width=</span><span class="fl">0.2</span>)</span>
<span id="cb102-497"><a href="#cb102-497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-498"><a href="#cb102-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-499"><a href="#cb102-499" aria-hidden="true" tabindex="-1"></a><span class="fu">## Economist Scatterplot</span></span>
<span id="cb102-500"><a href="#cb102-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-501"><a href="#cb102-501" aria-hidden="true" tabindex="-1"></a>The aim of this challenge is to recreate the plot below originally published in <span class="co">[</span><span class="ot">The Economist</span><span class="co">](https://www.economist.com/blogs/dailychart/2011/12/corruption-and-development)</span>. The graph is a scatterplot showing the relationship between *Corruption Index* and *Human Development Index* for various countries.</span>
<span id="cb102-502"><a href="#cb102-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-503"><a href="#cb102-503" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/economist-scatterplot.png)</span></span>
<span id="cb102-504"><a href="#cb102-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-505"><a href="#cb102-505" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data</span></span>
<span id="cb102-506"><a href="#cb102-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-507"><a href="#cb102-507" aria-hidden="true" tabindex="-1"></a>Download the data csv file.</span>
<span id="cb102-508"><a href="#cb102-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-509"><a href="#cb102-509" aria-hidden="true" tabindex="-1"></a>&lt;a class="btn btn-secondary btn-sm" href="https://www.dropbox.com/s/7imn0eoey9ckxh5/data_economist.csv?dl=1" role="button"&gt;{{&lt; fa download &gt;}} data_economist.csv&lt;/a&gt;</span>
<span id="cb102-510"><a href="#cb102-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-511"><a href="#cb102-511" aria-hidden="true" tabindex="-1"></a>Start by reading in the data.</span>
<span id="cb102-512"><a href="#cb102-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-515"><a href="#cb102-515" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-516"><a href="#cb102-516" aria-hidden="true" tabindex="-1"></a>ec <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"assets/data_economist.csv"</span>,<span class="at">header=</span>T)</span>
<span id="cb102-517"><a href="#cb102-517" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ec)</span>
<span id="cb102-518"><a href="#cb102-518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-519"><a href="#cb102-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-520"><a href="#cb102-520" aria-hidden="true" tabindex="-1"></a>Make sure that the fields are of the correct type. The x-axis field 'CPI' and the y-axis field 'HDI' must be of numeric type. The categorical field 'Region' must be of Factor type.</span>
<span id="cb102-521"><a href="#cb102-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-524"><a href="#cb102-524" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-525"><a href="#cb102-525" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ec)</span>
<span id="cb102-526"><a href="#cb102-526" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-527"><a href="#cb102-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-528"><a href="#cb102-528" aria-hidden="true" tabindex="-1"></a>We need to first modify the region column. The current levels in the 'Region' field are:</span>
<span id="cb102-529"><a href="#cb102-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-532"><a href="#cb102-532" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-533"><a href="#cb102-533" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(ec<span class="sc">$</span>Region)</span>
<span id="cb102-534"><a href="#cb102-534" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-535"><a href="#cb102-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-536"><a href="#cb102-536" aria-hidden="true" tabindex="-1"></a>But, the categories on the plot are different and need to be changed as follows:</span>
<span id="cb102-537"><a href="#cb102-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-538"><a href="#cb102-538" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb102-539"><a href="#cb102-539" aria-hidden="true" tabindex="-1"></a><span class="in">From                  To</span></span>
<span id="cb102-540"><a href="#cb102-540" aria-hidden="true" tabindex="-1"></a><span class="in">EU W. Europe          OECD</span></span>
<span id="cb102-541"><a href="#cb102-541" aria-hidden="true" tabindex="-1"></a><span class="in">Americas              Americas</span></span>
<span id="cb102-542"><a href="#cb102-542" aria-hidden="true" tabindex="-1"></a><span class="in">Asia Pacific          Asia &amp; Oceania</span></span>
<span id="cb102-543"><a href="#cb102-543" aria-hidden="true" tabindex="-1"></a><span class="in">East EU Cemt Asia     Central &amp; Eastern Europe</span></span>
<span id="cb102-544"><a href="#cb102-544" aria-hidden="true" tabindex="-1"></a><span class="in">MENA                  Middle East &amp; North Africa</span></span>
<span id="cb102-545"><a href="#cb102-545" aria-hidden="true" tabindex="-1"></a><span class="in">SSA                   Sub-Saharan Africa</span></span>
<span id="cb102-546"><a href="#cb102-546" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-547"><a href="#cb102-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-548"><a href="#cb102-548" aria-hidden="true" tabindex="-1"></a>Since the 'To' strings are a bit too long to be in one line on the legend, use <span class="in">`\n`</span> to break a line into two lines.</span>
<span id="cb102-549"><a href="#cb102-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-550"><a href="#cb102-550" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb102-551"><a href="#cb102-551" aria-hidden="true" tabindex="-1"></a><span class="in">`\n`</span> is the newline character in R.</span>
<span id="cb102-552"><a href="#cb102-552" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb102-553"><a href="#cb102-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-554"><a href="#cb102-554" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb102-555"><a href="#cb102-555" aria-hidden="true" tabindex="-1"></a><span class="in">From                  To</span></span>
<span id="cb102-556"><a href="#cb102-556" aria-hidden="true" tabindex="-1"></a><span class="in">EU W. Europe          OECD</span></span>
<span id="cb102-557"><a href="#cb102-557" aria-hidden="true" tabindex="-1"></a><span class="in">Americas              Americas</span></span>
<span id="cb102-558"><a href="#cb102-558" aria-hidden="true" tabindex="-1"></a><span class="in">Asia Pacific          Asia &amp;\nOceania</span></span>
<span id="cb102-559"><a href="#cb102-559" aria-hidden="true" tabindex="-1"></a><span class="in">East EU Cemt Asia     Central &amp;\nEastern Europe</span></span>
<span id="cb102-560"><a href="#cb102-560" aria-hidden="true" tabindex="-1"></a><span class="in">MENA                  Middle East &amp;\nNorth Africa</span></span>
<span id="cb102-561"><a href="#cb102-561" aria-hidden="true" tabindex="-1"></a><span class="in">SSA                   Sub-Saharan\nAfrica</span></span>
<span id="cb102-562"><a href="#cb102-562" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-563"><a href="#cb102-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-564"><a href="#cb102-564" aria-hidden="true" tabindex="-1"></a>The strings can be renamed using string replacement or substitution. But a easier way to do it is to use <span class="in">`factor()`</span>. The arguments <span class="in">`levels`</span> and <span class="in">`labels`</span> in function <span class="in">`factor()`</span> can be used to rename factors.</span>
<span id="cb102-565"><a href="#cb102-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-568"><a href="#cb102-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-569"><a href="#cb102-569" aria-hidden="true" tabindex="-1"></a>ec<span class="sc">$</span>Region <span class="ot">&lt;-</span> <span class="fu">factor</span>(ec<span class="sc">$</span>Region,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"EU W. Europe"</span>,</span>
<span id="cb102-570"><a href="#cb102-570" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Americas"</span>,</span>
<span id="cb102-571"><a href="#cb102-571" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Asia Pacific"</span>,</span>
<span id="cb102-572"><a href="#cb102-572" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"East EU Cemt Asia"</span>,</span>
<span id="cb102-573"><a href="#cb102-573" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"MENA"</span>,</span>
<span id="cb102-574"><a href="#cb102-574" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"SSA"</span>),</span>
<span id="cb102-575"><a href="#cb102-575" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"OECD"</span>,</span>
<span id="cb102-576"><a href="#cb102-576" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Americas"</span>,</span>
<span id="cb102-577"><a href="#cb102-577" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Asia &amp;</span><span class="sc">\n</span><span class="st">Oceania"</span>,</span>
<span id="cb102-578"><a href="#cb102-578" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Central &amp;</span><span class="sc">\n</span><span class="st">Eastern Europe"</span>,</span>
<span id="cb102-579"><a href="#cb102-579" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Middle East &amp;</span><span class="sc">\n</span><span class="st">North Africa"</span>,</span>
<span id="cb102-580"><a href="#cb102-580" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Sub-Saharan</span><span class="sc">\n</span><span class="st">Africa"</span>))</span>
<span id="cb102-581"><a href="#cb102-581" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-582"><a href="#cb102-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-583"><a href="#cb102-583" aria-hidden="true" tabindex="-1"></a>Our new Regions should look like:</span>
<span id="cb102-584"><a href="#cb102-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-587"><a href="#cb102-587" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-588"><a href="#cb102-588" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(ec<span class="sc">$</span>Region)</span>
<span id="cb102-589"><a href="#cb102-589" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-590"><a href="#cb102-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-591"><a href="#cb102-591" aria-hidden="true" tabindex="-1"></a><span class="fu">### Points</span></span>
<span id="cb102-592"><a href="#cb102-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-593"><a href="#cb102-593" aria-hidden="true" tabindex="-1"></a>Start building up the basic plot.</span>
<span id="cb102-594"><a href="#cb102-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-595"><a href="#cb102-595" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb102-596"><a href="#cb102-596" aria-hidden="true" tabindex="-1"></a>Provide data.frame 'ec' as the data and map field 'CPI' to the x-axis and 'HDI' to the y-axis. Use <span class="in">`geom_point()`</span> to draw point geometry. To select shapes, see <span class="co">[</span><span class="ot">here</span><span class="co">](https://www.google.se/search?q=r+pch&amp;oq=R+pch)</span>. Circular shape can be drawn using 1, 16, 19, 20 and 21. Using shape '21' allows us to control stroke color, fill color and stroke thickness for the points. Check out <span class="in">`?geom_point`</span> and look under 'Aesthetics' for the various possible aesthetic options. Set shape to 21, size to 3, stroke to 0.8 and fill to white.</span>
<span id="cb102-597"><a href="#cb102-597" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb102-598"><a href="#cb102-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-601"><a href="#cb102-601" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-602"><a href="#cb102-602" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-603"><a href="#cb102-603" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb102-604"><a href="#cb102-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-605"><a href="#cb102-605" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ec,<span class="fu">aes</span>(<span class="at">x=</span>CPI,<span class="at">y=</span>HDI,<span class="at">color=</span>Region))<span class="sc">+</span></span>
<span id="cb102-606"><a href="#cb102-606" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">21</span>,<span class="at">size=</span><span class="dv">3</span>,<span class="at">stroke=</span><span class="fl">0.8</span>,<span class="at">fill=</span><span class="st">"white"</span>)</span>
<span id="cb102-607"><a href="#cb102-607" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-608"><a href="#cb102-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-609"><a href="#cb102-609" aria-hidden="true" tabindex="-1"></a>Notice how '\n' has created newlines in the Legend.</span>
<span id="cb102-610"><a href="#cb102-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-611"><a href="#cb102-611" aria-hidden="true" tabindex="-1"></a><span class="fu">### Trendline</span></span>
<span id="cb102-612"><a href="#cb102-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-613"><a href="#cb102-613" aria-hidden="true" tabindex="-1"></a>Now, we add the trend line using <span class="in">`geom_smooth`</span>. Check out <span class="in">`?geom_smooth`</span> and look under 'Arguments' for argument options and 'Aesthetics' for the aesthetic options.</span>
<span id="cb102-614"><a href="#cb102-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-615"><a href="#cb102-615" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use method 'lm' and use a custom formula of <span class="in">`y~poly(x,2)`</span> to approximate the curve seen on the plot. Turn off confidence interval shading. Set line thickness to 0.6 and line color to red.</span>
<span id="cb102-616"><a href="#cb102-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-619"><a href="#cb102-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-620"><a href="#cb102-620" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-621"><a href="#cb102-621" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb102-622"><a href="#cb102-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-623"><a href="#cb102-623" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ec,<span class="fu">aes</span>(<span class="at">x=</span>CPI,<span class="at">y=</span>HDI,<span class="at">color=</span>Region))<span class="sc">+</span></span>
<span id="cb102-624"><a href="#cb102-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">21</span>,<span class="at">size=</span><span class="dv">3</span>,<span class="at">stroke=</span><span class="fl">0.8</span>,<span class="at">fill=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb102-625"><a href="#cb102-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>,<span class="at">formula=</span>y<span class="sc">~</span><span class="fu">poly</span>(x,<span class="dv">2</span>),<span class="at">se=</span>F,<span class="at">size=</span><span class="fl">0.6</span>,<span class="at">color=</span><span class="st">"red"</span>)</span>
<span id="cb102-626"><a href="#cb102-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-627"><a href="#cb102-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-628"><a href="#cb102-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-629"><a href="#cb102-629" aria-hidden="true" tabindex="-1"></a>Notice that the line in drawn over the points due to the plotting order. We want the points to be over the line. So reorder the geoms. Since we provided no aesthetic mappings to <span class="in">`geom_smooth`</span>, there is no legend entry for the trendline. We can fake a legend entry by providing an aesthetic, for example; <span class="in">`aes(fill="red")`</span>. We do not use the color aesthetic because it is already in use and would give us reduced control later on to modify this legend entry.</span>
<span id="cb102-630"><a href="#cb102-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-633"><a href="#cb102-633" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-634"><a href="#cb102-634" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb102-635"><a href="#cb102-635" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb102-636"><a href="#cb102-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-637"><a href="#cb102-637" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(ec,<span class="fu">aes</span>(<span class="at">x=</span>CPI,<span class="at">y=</span>HDI,<span class="at">color=</span>Region))<span class="sc">+</span></span>
<span id="cb102-638"><a href="#cb102-638" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">fill=</span><span class="st">"red"</span>),<span class="at">method=</span><span class="st">"lm"</span>,<span class="at">formula=</span>y<span class="sc">~</span><span class="fu">poly</span>(x,<span class="dv">2</span>),<span class="at">se=</span>F,<span class="at">color=</span><span class="st">"red"</span>,<span class="at">size=</span><span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb102-639"><a href="#cb102-639" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">21</span>,<span class="at">size=</span><span class="dv">3</span>,<span class="at">stroke=</span><span class="fl">0.8</span>,<span class="at">fill=</span><span class="st">"white"</span>)</span>
<span id="cb102-640"><a href="#cb102-640" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb102-641"><a href="#cb102-641" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-642"><a href="#cb102-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-643"><a href="#cb102-643" aria-hidden="true" tabindex="-1"></a><span class="fu">### Text Labels</span></span>
<span id="cb102-644"><a href="#cb102-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-645"><a href="#cb102-645" aria-hidden="true" tabindex="-1"></a>Now we add the text labels. Only a subset of countries are plotted. The list of countries to label is shown below.</span>
<span id="cb102-646"><a href="#cb102-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-647"><a href="#cb102-647" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb102-648"><a href="#cb102-648" aria-hidden="true" tabindex="-1"></a><span class="in">"Congo","Afghanistan","Sudan","Myanmar","Iraq","Venezuela","Russia","Argentina","Brazil","Italy","South Africa","Cape Verde","Bhutan","Botswana","Britian","New Zealand","Greece","China","India","Rwanda","Spain","France","United States","Japan","Norway","Singapore","Barbados","Germany"</span></span>
<span id="cb102-649"><a href="#cb102-649" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-650"><a href="#cb102-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-651"><a href="#cb102-651" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`geom_text`</span> to subset the original data.frame to the reduced set above and plot the labels as text. See <span class="in">`?geom_text`</span>.</span>
<span id="cb102-652"><a href="#cb102-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-655"><a href="#cb102-655" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-656"><a href="#cb102-656" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb102-657"><a href="#cb102-657" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb102-658"><a href="#cb102-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-659"><a href="#cb102-659" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Congo"</span>,<span class="st">"Afghanistan"</span>,<span class="st">"Sudan"</span>,<span class="st">"Myanmar"</span>,<span class="st">"Iraq"</span>,<span class="st">"Venezuela"</span>,<span class="st">"Russia"</span>,<span class="st">"Argentina"</span>,<span class="st">"Brazil"</span>,<span class="st">"Italy"</span>,<span class="st">"South Africa"</span>,<span class="st">"Cape Verde"</span>,<span class="st">"Bhutan"</span>,<span class="st">"Botswana"</span>,<span class="st">"Britian"</span>,<span class="st">"New Zealand"</span>,<span class="st">"Greece"</span>,<span class="st">"China"</span>,<span class="st">"India"</span>,<span class="st">"Rwanda"</span>,<span class="st">"Spain"</span>,<span class="st">"France"</span>,<span class="st">"United States"</span>,<span class="st">"Japan"</span>,<span class="st">"Norway"</span>,<span class="st">"Singapore"</span>,<span class="st">"Barbados"</span>,<span class="st">"Germany"</span>)</span>
<span id="cb102-660"><a href="#cb102-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-661"><a href="#cb102-661" aria-hidden="true" tabindex="-1"></a>p<span class="sc">+</span><span class="fu">geom_text</span>(<span class="at">data=</span><span class="fu">subset</span>(ec,Country <span class="sc">%in%</span> labels),<span class="fu">aes</span>(<span class="at">label=</span>Country),<span class="at">color=</span><span class="st">"black"</span>)</span>
<span id="cb102-662"><a href="#cb102-662" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-663"><a href="#cb102-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-664"><a href="#cb102-664" aria-hidden="true" tabindex="-1"></a><span class="fu">### Custom Font</span></span>
<span id="cb102-665"><a href="#cb102-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-666"><a href="#cb102-666" aria-hidden="true" tabindex="-1"></a>Custom font can be used for the labels by providing the font name to argument <span class="in">`family`</span> like so <span class="in">`geom_text(family="fontname")`</span>. If you do not want to bother with fonts, just avoid the <span class="in">`family`</span> argument in <span class="in">`geom_text`</span> and skip this part.</span>
<span id="cb102-667"><a href="#cb102-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-668"><a href="#cb102-668" aria-hidden="true" tabindex="-1"></a>Using custom fonts can be tricky business. To use a font name, it must be installed on your system and it should be imported into the R environment. This can be done using the <span class="in">`extrafont`</span> package. Try importing one of the fonts available on your system. Not all fonts work. <span class="in">`extrafont`</span> prefers **.ttf** fonts. If a font doesn't work, try another.</span>
<span id="cb102-669"><a href="#cb102-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-672"><a href="#cb102-672" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-673"><a href="#cb102-673" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-674"><a href="#cb102-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-675"><a href="#cb102-675" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(extrafont)</span>
<span id="cb102-676"><a href="#cb102-676" aria-hidden="true" tabindex="-1"></a><span class="fu">font_import</span>(<span class="at">pattern=</span><span class="st">"Gidole"</span>,<span class="at">prompt=</span><span class="cn">FALSE</span>)</span>
<span id="cb102-677"><a href="#cb102-677" aria-hidden="true" tabindex="-1"></a><span class="co"># load fonts for pdf</span></span>
<span id="cb102-678"><a href="#cb102-678" aria-hidden="true" tabindex="-1"></a><span class="fu">loadfonts</span>()</span>
<span id="cb102-679"><a href="#cb102-679" aria-hidden="true" tabindex="-1"></a><span class="co"># list available fonts in R</span></span>
<span id="cb102-680"><a href="#cb102-680" aria-hidden="true" tabindex="-1"></a><span class="fu">fonts</span>()</span>
<span id="cb102-681"><a href="#cb102-681" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-682"><a href="#cb102-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-683"><a href="#cb102-683" aria-hidden="true" tabindex="-1"></a>The actual font used on the Economist graph is something close to <span class="co">[</span><span class="ot">ITC Officina Sans</span><span class="co">](https://www.fontshop.com/families/itc-itc-officina-sans)</span>. Since this is not a free font, I am using a free font called <span class="co">[</span><span class="ot">Gidole</span><span class="co">](https://gidole.github.io/)</span>.</span>
<span id="cb102-684"><a href="#cb102-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-687"><a href="#cb102-687" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-688"><a href="#cb102-688" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb102-689"><a href="#cb102-689" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb102-690"><a href="#cb102-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-691"><a href="#cb102-691" aria-hidden="true" tabindex="-1"></a>p<span class="sc">+</span><span class="fu">geom_text</span>(<span class="at">data=</span><span class="fu">subset</span>(ec,Country <span class="sc">%in%</span> labels),<span class="fu">aes</span>(<span class="at">label=</span>Country),</span>
<span id="cb102-692"><a href="#cb102-692" aria-hidden="true" tabindex="-1"></a>            <span class="at">color=</span><span class="st">"black"</span>,<span class="at">family=</span><span class="st">"Gidole"</span>)</span>
<span id="cb102-693"><a href="#cb102-693" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-694"><a href="#cb102-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-695"><a href="#cb102-695" aria-hidden="true" tabindex="-1"></a><span class="fu">### Label Overlap</span></span>
<span id="cb102-696"><a href="#cb102-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-697"><a href="#cb102-697" aria-hidden="true" tabindex="-1"></a>To avoid overlapping of labels, we can use a <span class="in">`ggplot2`</span> extension package <span class="in">`ggrepel`</span>. We can use function <span class="in">`geom_text_repel()`</span> from the <span class="in">`ggrepel`</span> package. <span class="in">`geom_text_repel()`</span> has the same arguments/aesthetics as <span class="in">`geom_text`</span> and a few more. Skip the <span class="in">`family=Gidole`</span> part if you do not want to change the font.</span>
<span id="cb102-698"><a href="#cb102-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-701"><a href="#cb102-701" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-702"><a href="#cb102-702" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb102-703"><a href="#cb102-703" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb102-704"><a href="#cb102-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-705"><a href="#cb102-705" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb102-706"><a href="#cb102-706" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span><span class="fu">geom_text_repel</span>(<span class="at">data=</span><span class="fu">subset</span>(ec,Country <span class="sc">%in%</span> labels),<span class="fu">aes</span>(<span class="at">label=</span>Country),</span>
<span id="cb102-707"><a href="#cb102-707" aria-hidden="true" tabindex="-1"></a>                       <span class="at">color=</span><span class="st">"black"</span>,<span class="at">box.padding=</span><span class="fu">unit</span>(<span class="dv">1</span>,<span class="st">'lines'</span>),<span class="at">segment.size=</span><span class="fl">0.25</span>,</span>
<span id="cb102-708"><a href="#cb102-708" aria-hidden="true" tabindex="-1"></a>                       <span class="at">size=</span><span class="dv">3</span>,<span class="at">family=</span><span class="st">"Gidole"</span>)</span>
<span id="cb102-709"><a href="#cb102-709" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb102-710"><a href="#cb102-710" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-711"><a href="#cb102-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-712"><a href="#cb102-712" aria-hidden="true" tabindex="-1"></a><span class="fu">### Axes</span></span>
<span id="cb102-713"><a href="#cb102-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-714"><a href="#cb102-714" aria-hidden="true" tabindex="-1"></a>Next step is to adjust the axes breaks, axes labels, point colors and relabeling the trendline legend text.</span>
<span id="cb102-715"><a href="#cb102-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-716"><a href="#cb102-716" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Change axes labels to 'Corruption Perceptions Index, 2011 (10=least corrupt)' on the x-axis and 'Human Development Index, 2011 (1=best)' on the y-axis. Set breaks on the x-axis from 1 to 10 by 1 increment and y-axis from 0.2 to 1.0 by 0.1 increments.</span>
<span id="cb102-717"><a href="#cb102-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-720"><a href="#cb102-720" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-721"><a href="#cb102-721" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb102-722"><a href="#cb102-722" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb102-723"><a href="#cb102-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-724"><a href="#cb102-724" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span><span class="fu">scale_x_continuous</span>(<span class="at">name=</span><span class="st">"Corruption Perceptions Index, 2011 (10=least corrupt)"</span>,</span>
<span id="cb102-725"><a href="#cb102-725" aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb102-726"><a href="#cb102-726" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">name=</span><span class="st">"Human Development Index, 2011 (1=best)"</span>,</span>
<span id="cb102-727"><a href="#cb102-727" aria-hidden="true" tabindex="-1"></a>                         <span class="at">breaks=</span><span class="fu">seq</span>(<span class="at">from=</span><span class="dv">0</span>,<span class="at">to=</span><span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="dv">1</span>))</span>
<span id="cb102-728"><a href="#cb102-728" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb102-729"><a href="#cb102-729" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-730"><a href="#cb102-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-731"><a href="#cb102-731" aria-hidden="true" tabindex="-1"></a><span class="fu">### Scale Colors</span></span>
<span id="cb102-732"><a href="#cb102-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-733"><a href="#cb102-733" aria-hidden="true" tabindex="-1"></a>Now we want to change the color palette for the points and modify the legend text for the trendline.</span>
<span id="cb102-734"><a href="#cb102-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-735"><a href="#cb102-735" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`scale_color_manual()`</span> to provide custom colors. These are the colors to use for the points: <span class="in">`"#23576E","#099FDB","#29B00E", "#208F84","#F55840","#924F3E"`</span>. </span>
<span id="cb102-736"><a href="#cb102-736" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`scale_fill_manual`</span> to change the trendline label since it's a fill scale. The legend entry for the trendline should read 'R^2=52%'.</span>
<span id="cb102-737"><a href="#cb102-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-740"><a href="#cb102-740" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-741"><a href="#cb102-741" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb102-742"><a href="#cb102-742" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb102-743"><a href="#cb102-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-744"><a href="#cb102-744" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span><span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#23576E"</span>,<span class="st">"#099FDB"</span>,<span class="st">"#29B00E"</span>, <span class="st">"#208F84"</span>,<span class="st">"#F55840"</span>,<span class="st">"#924F3E"</span>))<span class="sc">+</span></span>
<span id="cb102-745"><a href="#cb102-745" aria-hidden="true" tabindex="-1"></a>       <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">"trend"</span>,<span class="at">values=</span><span class="st">"red"</span>,<span class="at">labels=</span><span class="fu">expression</span>(<span class="fu">paste</span>(R<span class="sc">^</span><span class="dv">2</span>,<span class="st">"=52%"</span>)))</span>
<span id="cb102-746"><a href="#cb102-746" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb102-747"><a href="#cb102-747" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-748"><a href="#cb102-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-749"><a href="#cb102-749" aria-hidden="true" tabindex="-1"></a><span class="fu">### Title</span></span>
<span id="cb102-750"><a href="#cb102-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-751"><a href="#cb102-751" aria-hidden="true" tabindex="-1"></a>Title and caption can be added with <span class="in">`labs`</span>.</span>
<span id="cb102-752"><a href="#cb102-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-753"><a href="#cb102-753" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Set the title to 'Corruption and human development'. </span>
<span id="cb102-754"><a href="#cb102-754" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Set the caption to 'Sources: Transparency International; UN Human Development Report'.</span>
<span id="cb102-755"><a href="#cb102-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-756"><a href="#cb102-756" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=FALSE}</span></span>
<span id="cb102-757"><a href="#cb102-757" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-height: 5</span></span>
<span id="cb102-758"><a href="#cb102-758" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-width: 7</span></span>
<span id="cb102-759"><a href="#cb102-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-760"><a href="#cb102-760" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- p+labs(title="Corruption and human development",</span></span>
<span id="cb102-761"><a href="#cb102-761" aria-hidden="true" tabindex="-1"></a><span class="in">            caption="Sources: Transparency International; UN Human Development Report")</span></span>
<span id="cb102-762"><a href="#cb102-762" aria-hidden="true" tabindex="-1"></a><span class="in">p</span></span>
<span id="cb102-763"><a href="#cb102-763" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-764"><a href="#cb102-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-765"><a href="#cb102-765" aria-hidden="true" tabindex="-1"></a><span class="fu">### Theme</span></span>
<span id="cb102-766"><a href="#cb102-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-767"><a href="#cb102-767" aria-hidden="true" tabindex="-1"></a>We want to move the legend to the top and as a single row. This can be done using <span class="in">`theme()`</span> option <span class="in">`legend.position`</span>. See <span class="in">`?theme`</span>. <span class="in">`guides()`</span> is used to set the number of rows to 1. We also set a custom font for all text elements using <span class="in">`base_family="Gidole"`</span>. This can be skipped if a font change is not required.</span>
<span id="cb102-768"><a href="#cb102-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-769"><a href="#cb102-769" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=FALSE}</span></span>
<span id="cb102-770"><a href="#cb102-770" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-height: 5</span></span>
<span id="cb102-771"><a href="#cb102-771" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-width: 7</span></span>
<span id="cb102-772"><a href="#cb102-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-773"><a href="#cb102-773" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- p+guides(color=guide_legend(nrow=1))+</span></span>
<span id="cb102-774"><a href="#cb102-774" aria-hidden="true" tabindex="-1"></a><span class="in">       theme_bw(base_family="Gidole")+</span></span>
<span id="cb102-775"><a href="#cb102-775" aria-hidden="true" tabindex="-1"></a><span class="in">       theme(legend.position="top")</span></span>
<span id="cb102-776"><a href="#cb102-776" aria-hidden="true" tabindex="-1"></a><span class="in">p</span></span>
<span id="cb102-777"><a href="#cb102-777" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-778"><a href="#cb102-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-779"><a href="#cb102-779" aria-hidden="true" tabindex="-1"></a>Now we do some careful refining with themes.</span>
<span id="cb102-780"><a href="#cb102-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-781"><a href="#cb102-781" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Turn off minor gridlines</span>
<span id="cb102-782"><a href="#cb102-782" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Turn off major gridlines on x-axis</span>
<span id="cb102-783"><a href="#cb102-783" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Remove the gray background</span>
<span id="cb102-784"><a href="#cb102-784" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Remove panel border</span>
<span id="cb102-785"><a href="#cb102-785" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Remove legend titles</span>
<span id="cb102-786"><a href="#cb102-786" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Make axes titles italic</span>
<span id="cb102-787"><a href="#cb102-787" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Turn off y-axis ticks</span>
<span id="cb102-788"><a href="#cb102-788" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Change x-axis ticks to color grey60</span>
<span id="cb102-789"><a href="#cb102-789" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Make plot title bold</span>
<span id="cb102-790"><a href="#cb102-790" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Decrease size of caption to size 8</span>
<span id="cb102-791"><a href="#cb102-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-792"><a href="#cb102-792" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=FALSE}</span></span>
<span id="cb102-793"><a href="#cb102-793" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-height: 5</span></span>
<span id="cb102-794"><a href="#cb102-794" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-width: 7</span></span>
<span id="cb102-795"><a href="#cb102-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-796"><a href="#cb102-796" aria-hidden="true" tabindex="-1"></a><span class="in">p+theme(panel.grid.minor=element_blank(),</span></span>
<span id="cb102-797"><a href="#cb102-797" aria-hidden="true" tabindex="-1"></a><span class="in">          panel.grid.major.x=element_blank(),</span></span>
<span id="cb102-798"><a href="#cb102-798" aria-hidden="true" tabindex="-1"></a><span class="in">          panel.background=element_blank(),</span></span>
<span id="cb102-799"><a href="#cb102-799" aria-hidden="true" tabindex="-1"></a><span class="in">          panel.border=element_blank(),</span></span>
<span id="cb102-800"><a href="#cb102-800" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.title=element_blank(),</span></span>
<span id="cb102-801"><a href="#cb102-801" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.title=element_text(face="italic"),</span></span>
<span id="cb102-802"><a href="#cb102-802" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.ticks.y=element_blank(),</span></span>
<span id="cb102-803"><a href="#cb102-803" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.ticks.x=element_line(color="grey60"),</span></span>
<span id="cb102-804"><a href="#cb102-804" aria-hidden="true" tabindex="-1"></a><span class="in">          plot.title=element_text(face="bold"),</span></span>
<span id="cb102-805"><a href="#cb102-805" aria-hidden="true" tabindex="-1"></a><span class="in">          plot.caption=element_text(hjust=0,size=8))</span></span>
<span id="cb102-806"><a href="#cb102-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-807"><a href="#cb102-807" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-808"><a href="#cb102-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-809"><a href="#cb102-809" aria-hidden="true" tabindex="-1"></a>And now our plot is ready and we can compare with the original. Close? Close enough?</span>
<span id="cb102-810"><a href="#cb102-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-811"><a href="#cb102-811" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/economist-scatterplot.png)</span></span>
<span id="cb102-812"><a href="#cb102-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-813"><a href="#cb102-813" aria-hidden="true" tabindex="-1"></a>The full script for this challenge is summarized here:</span>
<span id="cb102-814"><a href="#cb102-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-817"><a href="#cb102-817" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-818"><a href="#cb102-818" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-819"><a href="#cb102-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-820"><a href="#cb102-820" aria-hidden="true" tabindex="-1"></a><span class="co"># read data</span></span>
<span id="cb102-821"><a href="#cb102-821" aria-hidden="true" tabindex="-1"></a>ec <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"assets/data_economist.csv"</span>,<span class="at">header=</span>T)</span>
<span id="cb102-822"><a href="#cb102-822" aria-hidden="true" tabindex="-1"></a><span class="co"># refactor</span></span>
<span id="cb102-823"><a href="#cb102-823" aria-hidden="true" tabindex="-1"></a>ec<span class="sc">$</span>Region <span class="ot">&lt;-</span> <span class="fu">factor</span>(ec<span class="sc">$</span>Region,</span>
<span id="cb102-824"><a href="#cb102-824" aria-hidden="true" tabindex="-1"></a>                    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"EU W. Europe"</span>,<span class="st">"Americas"</span>,<span class="st">"Asia Pacific"</span>,</span>
<span id="cb102-825"><a href="#cb102-825" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"East EU Cemt Asia"</span>,<span class="st">"MENA"</span>,<span class="st">"SSA"</span>),</span>
<span id="cb102-826"><a href="#cb102-826" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"OECD"</span>,<span class="st">"Americas"</span>,<span class="st">"Asia &amp;</span><span class="sc">\n</span><span class="st">Oceania"</span>,</span>
<span id="cb102-827"><a href="#cb102-827" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Central &amp;</span><span class="sc">\n</span><span class="st">Eastern Europe"</span>,</span>
<span id="cb102-828"><a href="#cb102-828" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Middle East &amp;</span><span class="sc">\n</span><span class="st">North Africa"</span>,</span>
<span id="cb102-829"><a href="#cb102-829" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Sub-Saharan</span><span class="sc">\n</span><span class="st">Africa"</span>))</span>
<span id="cb102-830"><a href="#cb102-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-831"><a href="#cb102-831" aria-hidden="true" tabindex="-1"></a><span class="co"># labels</span></span>
<span id="cb102-832"><a href="#cb102-832" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Congo"</span>,<span class="st">"Afghanistan"</span>,<span class="st">"Sudan"</span>,<span class="st">"Myanmar"</span>,<span class="st">"Iraq"</span>,<span class="st">"Venezuela"</span>,<span class="st">"Russia"</span>,<span class="st">"Argentina"</span>,<span class="st">"Brazil"</span>,<span class="st">"Italy"</span>,<span class="st">"South Africa"</span>,<span class="st">"Cape Verde"</span>,<span class="st">"Bhutan"</span>,<span class="st">"Botswana"</span>,<span class="st">"Britian"</span>,<span class="st">"New Zealand"</span>,<span class="st">"Greece"</span>,<span class="st">"China"</span>,<span class="st">"India"</span>,<span class="st">"Rwanda"</span>,<span class="st">"Spain"</span>,<span class="st">"France"</span>,<span class="st">"United States"</span>,<span class="st">"Japan"</span>,<span class="st">"Norway"</span>,<span class="st">"Singapore"</span>,<span class="st">"Barbados"</span>,<span class="st">"Germany"</span>)</span>
<span id="cb102-833"><a href="#cb102-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-834"><a href="#cb102-834" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting</span></span>
<span id="cb102-835"><a href="#cb102-835" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(ec,<span class="fu">aes</span>(<span class="at">x=</span>CPI,<span class="at">y=</span>HDI,<span class="at">color=</span>Region))<span class="sc">+</span></span>
<span id="cb102-836"><a href="#cb102-836" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">fill=</span><span class="st">"red"</span>),<span class="at">method=</span><span class="st">"lm"</span>,<span class="at">formula=</span>y<span class="sc">~</span><span class="fu">poly</span>(x,<span class="dv">2</span>),<span class="at">se=</span>F,<span class="at">color=</span><span class="st">"red"</span>,<span class="at">size=</span><span class="fl">0.6</span>)<span class="sc">+</span></span>
<span id="cb102-837"><a href="#cb102-837" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">21</span>,<span class="at">size=</span><span class="dv">3</span>,<span class="at">stroke=</span><span class="fl">0.8</span>,<span class="at">fill=</span><span class="st">"white"</span>)<span class="sc">+</span></span>
<span id="cb102-838"><a href="#cb102-838" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text_repel</span>(<span class="at">data=</span><span class="fu">subset</span>(ec,Country <span class="sc">%in%</span> labels),<span class="fu">aes</span>(<span class="at">label=</span>Country),</span>
<span id="cb102-839"><a href="#cb102-839" aria-hidden="true" tabindex="-1"></a>                       <span class="at">color=</span><span class="st">"black"</span>,<span class="at">box.padding=</span><span class="fu">unit</span>(<span class="dv">1</span>,<span class="st">'lines'</span>),<span class="at">segment.size=</span><span class="fl">0.25</span>,</span>
<span id="cb102-840"><a href="#cb102-840" aria-hidden="true" tabindex="-1"></a>                       <span class="at">size=</span><span class="dv">3</span>,<span class="at">family=</span><span class="st">"Gidole"</span>)<span class="sc">+</span></span>
<span id="cb102-841"><a href="#cb102-841" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">name=</span><span class="st">"Corruption Perceptions Index, 2011 (10=least corrupt)"</span>,</span>
<span id="cb102-842"><a href="#cb102-842" aria-hidden="true" tabindex="-1"></a>                          <span class="at">breaks=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb102-843"><a href="#cb102-843" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">name=</span><span class="st">"Human Development Index, 2011 (1=best)"</span>,</span>
<span id="cb102-844"><a href="#cb102-844" aria-hidden="true" tabindex="-1"></a>                         <span class="at">breaks=</span><span class="fu">seq</span>(<span class="at">from=</span><span class="dv">0</span>,<span class="at">to=</span><span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.1</span>),<span class="at">limits=</span><span class="fu">c</span>(<span class="fl">0.2</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb102-845"><a href="#cb102-845" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"#23576E"</span>,<span class="st">"#099FDB"</span>,<span class="st">"#29B00E"</span>, <span class="st">"#208F84"</span>,<span class="st">"#F55840"</span>,<span class="st">"#924F3E"</span>))<span class="sc">+</span></span>
<span id="cb102-846"><a href="#cb102-846" aria-hidden="true" tabindex="-1"></a>           <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">"trend"</span>,<span class="at">values=</span><span class="st">"red"</span>,<span class="at">labels=</span><span class="fu">expression</span>(<span class="fu">paste</span>(R<span class="sc">^</span><span class="dv">2</span>,<span class="st">"=52%"</span>)))<span class="sc">+</span></span>
<span id="cb102-847"><a href="#cb102-847" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Corruption and human development"</span>,</span>
<span id="cb102-848"><a href="#cb102-848" aria-hidden="true" tabindex="-1"></a>           <span class="at">caption=</span><span class="st">"Sources: Transparency International; UN Human Development Report"</span>)<span class="sc">+</span></span>
<span id="cb102-849"><a href="#cb102-849" aria-hidden="true" tabindex="-1"></a>      <span class="fu">guides</span>(<span class="at">color=</span><span class="fu">guide_legend</span>(<span class="at">nrow=</span><span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb102-850"><a href="#cb102-850" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_bw</span>(<span class="at">base_family=</span><span class="st">"Gidole"</span>)<span class="sc">+</span></span>
<span id="cb102-851"><a href="#cb102-851" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"top"</span>,</span>
<span id="cb102-852"><a href="#cb102-852" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(),</span>
<span id="cb102-853"><a href="#cb102-853" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.grid.major.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb102-854"><a href="#cb102-854" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.background=</span><span class="fu">element_blank</span>(),</span>
<span id="cb102-855"><a href="#cb102-855" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.border=</span><span class="fu">element_blank</span>(),</span>
<span id="cb102-856"><a href="#cb102-856" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb102-857"><a href="#cb102-857" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"italic"</span>),</span>
<span id="cb102-858"><a href="#cb102-858" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb102-859"><a href="#cb102-859" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.ticks.x=</span><span class="fu">element_line</span>(<span class="at">color=</span><span class="st">"grey60"</span>),</span>
<span id="cb102-860"><a href="#cb102-860" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>),</span>
<span id="cb102-861"><a href="#cb102-861" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.caption=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">size=</span><span class="dv">8</span>))</span>
<span id="cb102-862"><a href="#cb102-862" aria-hidden="true" tabindex="-1"></a>p1</span>
<span id="cb102-863"><a href="#cb102-863" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-864"><a href="#cb102-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-865"><a href="#cb102-865" aria-hidden="true" tabindex="-1"></a><span class="fu">## WSJ Heatmap</span></span>
<span id="cb102-866"><a href="#cb102-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-867"><a href="#cb102-867" aria-hidden="true" tabindex="-1"></a>The aim of this challenge is to recreate the plot below originally published in <span class="co">[</span><span class="ot">The Wall Street Journal</span><span class="co">](http://graphics.wsj.com/infectious-diseases-and-vaccines/)</span>. The plot is a heatmap showing the normalized number of cases of measles across 51 US states from 1928 to 2003. X-axis shows years and y-axis shows the names of states. The color of the tiles denote the number of measles cases per 100,000 people. Introduction of the measles vaccine is shown as the black line in 1963.</span>
<span id="cb102-868"><a href="#cb102-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-869"><a href="#cb102-869" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/wsj-heatmap.png)</span></span>
<span id="cb102-870"><a href="#cb102-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-871"><a href="#cb102-871" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data</span></span>
<span id="cb102-872"><a href="#cb102-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-873"><a href="#cb102-873" aria-hidden="true" tabindex="-1"></a>Download the data csv file.</span>
<span id="cb102-874"><a href="#cb102-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-875"><a href="#cb102-875" aria-hidden="true" tabindex="-1"></a>&lt;a class="btn btn-secondary btn-sm" href="https://www.dropbox.com/s/19p8vku0i9np26b/data_wsj.csv?dl=1" role="button"&gt;{} data_wsj.csv&lt;/a&gt;</span>
<span id="cb102-876"><a href="#cb102-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-877"><a href="#cb102-877" aria-hidden="true" tabindex="-1"></a>Start by reading in the data. This .csv file has two lines of comments so we need to skip 2 lines while reading in the data. We also add <span class="in">`stringsAsFactors=F`</span> to avoid the automatic conversion of character fields to factor type.</span>
<span id="cb102-878"><a href="#cb102-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-881"><a href="#cb102-881" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-882"><a href="#cb102-882" aria-hidden="true" tabindex="-1"></a>me <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"assets/data_wsj.csv"</span>,<span class="at">header=</span>T,<span class="at">stringsAsFactors=</span>F,<span class="at">skip=</span><span class="dv">2</span>)</span>
<span id="cb102-883"><a href="#cb102-883" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(me)</span>
<span id="cb102-884"><a href="#cb102-884" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-885"><a href="#cb102-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-886"><a href="#cb102-886" aria-hidden="true" tabindex="-1"></a>Check the data type for the fields.</span>
<span id="cb102-887"><a href="#cb102-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-890"><a href="#cb102-890" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-891"><a href="#cb102-891" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(me)</span>
<span id="cb102-892"><a href="#cb102-892" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-893"><a href="#cb102-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-894"><a href="#cb102-894" aria-hidden="true" tabindex="-1"></a>Looking at this dataset, there is going to be quite a bit of data clean-up and tidying before we can plot it. Here are the steps we need to take:</span>
<span id="cb102-895"><a href="#cb102-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-896"><a href="#cb102-896" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The data needs to be transformed to long format.</span>
<span id="cb102-897"><a href="#cb102-897" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Replace all "-" with NAs</span>
<span id="cb102-898"><a href="#cb102-898" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The number of cases across each state is a character and needs to be converted to numeric</span>
<span id="cb102-899"><a href="#cb102-899" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Collapse (sum) week-level data to year.</span>
<span id="cb102-900"><a href="#cb102-900" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Abbreviate state names</span>
<span id="cb102-901"><a href="#cb102-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-902"><a href="#cb102-902" aria-hidden="true" tabindex="-1"></a><span class="fu">### Tidy Data</span></span>
<span id="cb102-903"><a href="#cb102-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-904"><a href="#cb102-904" aria-hidden="true" tabindex="-1"></a>Convert the wide format to long format using the function <span class="in">`gather()`</span> from package <span class="in">`dplyr`</span>.</span>
<span id="cb102-905"><a href="#cb102-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-908"><a href="#cb102-908" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-909"><a href="#cb102-909" aria-hidden="true" tabindex="-1"></a>me1 <span class="ot">&lt;-</span> me <span class="sc">%&gt;%</span> <span class="fu">gather</span>(<span class="at">key=</span>state,<span class="at">value=</span>value,<span class="sc">-</span>YEAR,<span class="sc">-</span>WEEK)</span>
<span id="cb102-910"><a href="#cb102-910" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(me1)</span>
<span id="cb102-911"><a href="#cb102-911" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-912"><a href="#cb102-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-913"><a href="#cb102-913" aria-hidden="true" tabindex="-1"></a>Now, replace all '-' with NA in the field value. We use the function <span class="in">`str_replace()`</span> from R package <span class="in">`stringr`</span>. Then convert the value field to numeric.</span>
<span id="cb102-914"><a href="#cb102-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-917"><a href="#cb102-917" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-918"><a href="#cb102-918" aria-hidden="true" tabindex="-1"></a>me2 <span class="ot">&lt;-</span> me1 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">value=</span><span class="fu">str_replace</span>(value,<span class="st">"^-$"</span>,<span class="cn">NA_character_</span>),</span>
<span id="cb102-919"><a href="#cb102-919" aria-hidden="true" tabindex="-1"></a>                      <span class="at">value=</span><span class="fu">as.numeric</span>(value))</span>
<span id="cb102-920"><a href="#cb102-920" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(me2)</span>
<span id="cb102-921"><a href="#cb102-921" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-922"><a href="#cb102-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-923"><a href="#cb102-923" aria-hidden="true" tabindex="-1"></a>Sum up the week-level information to year-level information. This means rather than having</span>
<span id="cb102-924"><a href="#cb102-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-925"><a href="#cb102-925" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb102-926"><a href="#cb102-926" aria-hidden="true" tabindex="-1"></a><span class="in">  YEAR WEEK   state value</span></span>
<span id="cb102-927"><a href="#cb102-927" aria-hidden="true" tabindex="-1"></a><span class="in">1 1928    1 ALABAMA  3.67</span></span>
<span id="cb102-928"><a href="#cb102-928" aria-hidden="true" tabindex="-1"></a><span class="in">2 1928    2 ALABAMA  6.25</span></span>
<span id="cb102-929"><a href="#cb102-929" aria-hidden="true" tabindex="-1"></a><span class="in">3 1928    3 ALABAMA  7.95</span></span>
<span id="cb102-930"><a href="#cb102-930" aria-hidden="true" tabindex="-1"></a><span class="in">...</span></span>
<span id="cb102-931"><a href="#cb102-931" aria-hidden="true" tabindex="-1"></a><span class="in">5501 1957   41 ALASKA  2.16</span></span>
<span id="cb102-932"><a href="#cb102-932" aria-hidden="true" tabindex="-1"></a><span class="in">5502 1957   42 ALASKA  0.43</span></span>
<span id="cb102-933"><a href="#cb102-933" aria-hidden="true" tabindex="-1"></a><span class="in">5503 1957   43 ALASKA  1.30</span></span>
<span id="cb102-934"><a href="#cb102-934" aria-hidden="true" tabindex="-1"></a><span class="in">...</span></span>
<span id="cb102-935"><a href="#cb102-935" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-936"><a href="#cb102-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-937"><a href="#cb102-937" aria-hidden="true" tabindex="-1"></a>we should have one value per year per state.</span>
<span id="cb102-938"><a href="#cb102-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-939"><a href="#cb102-939" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb102-940"><a href="#cb102-940" aria-hidden="true" tabindex="-1"></a><span class="in">  YEAR    state value</span></span>
<span id="cb102-941"><a href="#cb102-941" aria-hidden="true" tabindex="-1"></a><span class="in">1 1928  ALABAMA  3.67</span></span>
<span id="cb102-942"><a href="#cb102-942" aria-hidden="true" tabindex="-1"></a><span class="in">2 1929  ALABAMA  3.20</span></span>
<span id="cb102-943"><a href="#cb102-943" aria-hidden="true" tabindex="-1"></a><span class="in">...</span></span>
<span id="cb102-944"><a href="#cb102-944" aria-hidden="true" tabindex="-1"></a><span class="in">5501 1957  ALASKA  2.16</span></span>
<span id="cb102-945"><a href="#cb102-945" aria-hidden="true" tabindex="-1"></a><span class="in">5502 1958  ALASKA  2.05</span></span>
<span id="cb102-946"><a href="#cb102-946" aria-hidden="true" tabindex="-1"></a><span class="in">...</span></span>
<span id="cb102-947"><a href="#cb102-947" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-948"><a href="#cb102-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-949"><a href="#cb102-949" aria-hidden="true" tabindex="-1"></a>The solution is to sum up all the cases for a state for all weeks within a year into one value for that year. This can be done using the <span class="in">`summarise()`</span> function from package <span class="in">`dplyr`</span>.</span>
<span id="cb102-950"><a href="#cb102-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-951"><a href="#cb102-951" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A custom function is used to sum over weeks. If all values are NA, then result is NA. If some values are NA, the NAs are removed and the remaining numbers are summed.</span>
<span id="cb102-952"><a href="#cb102-952" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The dots in state names are replaced by spaces and the words are converted to title case (First letter capital and rest lowercase). </span>
<span id="cb102-953"><a href="#cb102-953" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We also convert the column names to lowercase for consistency.</span>
<span id="cb102-954"><a href="#cb102-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-957"><a href="#cb102-957" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-958"><a href="#cb102-958" aria-hidden="true" tabindex="-1"></a>fun1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">ifelse</span>(<span class="fu">all</span>(<span class="fu">is.na</span>(x)),<span class="cn">NA</span>,<span class="fu">sum</span>(x,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb102-959"><a href="#cb102-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-960"><a href="#cb102-960" aria-hidden="true" tabindex="-1"></a>me3 <span class="ot">&lt;-</span> me2 <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(YEAR,state) <span class="sc">%&gt;%</span> </span>
<span id="cb102-961"><a href="#cb102-961" aria-hidden="true" tabindex="-1"></a>                <span class="fu">summarise</span>(<span class="at">total=</span><span class="fu">fun1</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb102-962"><a href="#cb102-962" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">state=</span><span class="fu">str_replace_all</span>(state,<span class="st">"[.]"</span>,<span class="st">" "</span>),</span>
<span id="cb102-963"><a href="#cb102-963" aria-hidden="true" tabindex="-1"></a>                       <span class="at">state=</span><span class="fu">str_to_title</span>(state))</span>
<span id="cb102-964"><a href="#cb102-964" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(me3) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">colnames</span>(me3))</span>
<span id="cb102-965"><a href="#cb102-965" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(me3)</span>
<span id="cb102-966"><a href="#cb102-966" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-967"><a href="#cb102-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-970"><a href="#cb102-970" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-971"><a href="#cb102-971" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(me3)</span>
<span id="cb102-972"><a href="#cb102-972" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-973"><a href="#cb102-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-974"><a href="#cb102-974" aria-hidden="true" tabindex="-1"></a>The data is now ready for plotting.</span>
<span id="cb102-975"><a href="#cb102-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-976"><a href="#cb102-976" aria-hidden="true" tabindex="-1"></a><span class="fu">### Tile</span></span>
<span id="cb102-977"><a href="#cb102-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-978"><a href="#cb102-978" aria-hidden="true" tabindex="-1"></a>We can build up a basic ggplot and heatmap tiles can be plotted using the geom <span class="in">`geom_tile`</span>. 'year' is mapped to the x-axis, 'state' to the y-axis and fill color for the tiles is the 'total' value.</span>
<span id="cb102-979"><a href="#cb102-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-982"><a href="#cb102-982" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-983"><a href="#cb102-983" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb102-984"><a href="#cb102-984" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 9</span></span>
<span id="cb102-985"><a href="#cb102-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-986"><a href="#cb102-986" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(me3,<span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span>state,<span class="at">fill=</span>total))<span class="sc">+</span></span>
<span id="cb102-987"><a href="#cb102-987" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_tile</span>()</span>
<span id="cb102-988"><a href="#cb102-988" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-989"><a href="#cb102-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-990"><a href="#cb102-990" aria-hidden="true" tabindex="-1"></a>Add borders around the tiles. We use <span class="in">`reorder(state,desc(state))`</span> to reverse the order of states so that it reads A-Z from top to bottom.</span>
<span id="cb102-991"><a href="#cb102-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-994"><a href="#cb102-994" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-995"><a href="#cb102-995" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb102-996"><a href="#cb102-996" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 9</span></span>
<span id="cb102-997"><a href="#cb102-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-998"><a href="#cb102-998" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(me3,<span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span><span class="fu">reorder</span>(state,<span class="fu">desc</span>(state)),<span class="at">fill=</span>total))<span class="sc">+</span></span>
<span id="cb102-999"><a href="#cb102-999" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>(<span class="at">color=</span><span class="st">"white"</span>,<span class="at">size=</span><span class="fl">0.25</span>)</span>
<span id="cb102-1000"><a href="#cb102-1000" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb102-1001"><a href="#cb102-1001" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1002"><a href="#cb102-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1003"><a href="#cb102-1003" aria-hidden="true" tabindex="-1"></a><span class="fu">### Scales</span></span>
<span id="cb102-1004"><a href="#cb102-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1005"><a href="#cb102-1005" aria-hidden="true" tabindex="-1"></a>The extra space on left and right (gray) of the plot is removed using argument <span class="in">`expand`</span> in <span class="in">`scales`</span>. X-axis breaks are redefined at 10 year intervals from 1930 to 2010. Custom colors are used for the tiles: <span class="in">`"#e7f0fa","#c9e2f6","#95cbee","#0099dc","#4ab04a", "#ffd73e","#eec73a","#e29421","#f05336","#ce472e"`</span>. Since the color scale is a fill color on a continuous value and we want to supply n new colors, we use <span class="in">`scale_fill_gradientn`</span>. Tiles with missing value is set to the color <span class="in">`"grey90"`</span>.</span>
<span id="cb102-1006"><a href="#cb102-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1009"><a href="#cb102-1009" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1010"><a href="#cb102-1010" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb102-1011"><a href="#cb102-1011" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 9</span></span>
<span id="cb102-1012"><a href="#cb102-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1013"><a href="#cb102-1013" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#e7f0fa"</span>,<span class="st">"#c9e2f6"</span>,<span class="st">"#95cbee"</span>,<span class="st">"#0099dc"</span>,<span class="st">"#4ab04a"</span>, <span class="st">"#ffd73e"</span>,<span class="st">"#eec73a"</span>,<span class="st">"#e29421"</span>,<span class="st">"#f05336"</span>,<span class="st">"#ce472e"</span>)</span>
<span id="cb102-1014"><a href="#cb102-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1015"><a href="#cb102-1015" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb102-1016"><a href="#cb102-1016" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">1930</span>,<span class="dv">2010</span>,<span class="at">by=</span><span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb102-1017"><a href="#cb102-1017" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gradientn</span>(<span class="at">colors=</span>cols,<span class="at">na.value=</span><span class="st">"grey95"</span>)</span>
<span id="cb102-1018"><a href="#cb102-1018" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1019"><a href="#cb102-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1020"><a href="#cb102-1020" aria-hidden="true" tabindex="-1"></a>The fill scale can be further refined to resemble that of the original plot.</span>
<span id="cb102-1021"><a href="#cb102-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1024"><a href="#cb102-1024" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1025"><a href="#cb102-1025" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb102-1026"><a href="#cb102-1026" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 9</span></span>
<span id="cb102-1027"><a href="#cb102-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1028"><a href="#cb102-1028" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#e7f0fa"</span>,<span class="st">"#c9e2f6"</span>,<span class="st">"#95cbee"</span>,<span class="st">"#0099dc"</span>,<span class="st">"#4ab04a"</span>, <span class="st">"#ffd73e"</span>,<span class="st">"#eec73a"</span>,<span class="st">"#e29421"</span>,<span class="st">"#f05336"</span>,<span class="st">"#ce472e"</span>)</span>
<span id="cb102-1029"><a href="#cb102-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1030"><a href="#cb102-1030" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span> <span class="fu">scale_y_discrete</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb102-1031"><a href="#cb102-1031" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_x_continuous</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">1930</span>,<span class="dv">2010</span>,<span class="at">by=</span><span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb102-1032"><a href="#cb102-1032" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_gradientn</span>(<span class="at">colors=</span>cols,<span class="at">na.value=</span><span class="st">"grey95"</span>,</span>
<span id="cb102-1033"><a href="#cb102-1033" aria-hidden="true" tabindex="-1"></a>                             <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">4000</span>),</span>
<span id="cb102-1034"><a href="#cb102-1034" aria-hidden="true" tabindex="-1"></a>                             <span class="at">values=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.01</span>,<span class="fl">0.02</span>,<span class="fl">0.03</span>,<span class="fl">0.09</span>,<span class="fl">0.1</span>,<span class="fl">0.15</span>,<span class="fl">0.25</span>,<span class="fl">0.4</span>,<span class="fl">0.5</span>,<span class="dv">1</span>),</span>
<span id="cb102-1035"><a href="#cb102-1035" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"0k"</span>,<span class="st">"1k"</span>,<span class="st">"2k"</span>,<span class="st">"3k"</span>,<span class="st">"4k"</span>),</span>
<span id="cb102-1036"><a href="#cb102-1036" aria-hidden="true" tabindex="-1"></a>                             <span class="at">guide=</span><span class="fu">guide_colourbar</span>(<span class="at">ticks=</span>T,<span class="at">nbin=</span><span class="dv">50</span>,</span>
<span id="cb102-1037"><a href="#cb102-1037" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">barheight=</span>.<span class="dv">5</span>,<span class="at">label=</span>T, </span>
<span id="cb102-1038"><a href="#cb102-1038" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">barwidth=</span><span class="dv">10</span>))</span>
<span id="cb102-1039"><a href="#cb102-1039" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb102-1040"><a href="#cb102-1040" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1041"><a href="#cb102-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1042"><a href="#cb102-1042" aria-hidden="true" tabindex="-1"></a><span class="fu">### Title</span></span>
<span id="cb102-1043"><a href="#cb102-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1044"><a href="#cb102-1044" aria-hidden="true" tabindex="-1"></a>We can remove the x and y axes titles and add a plot title.</span>
<span id="cb102-1045"><a href="#cb102-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1048"><a href="#cb102-1048" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1049"><a href="#cb102-1049" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb102-1050"><a href="#cb102-1050" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 9</span></span>
<span id="cb102-1051"><a href="#cb102-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1052"><a href="#cb102-1052" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span><span class="fu">labs</span>(<span class="at">x=</span><span class="st">""</span>,<span class="at">y=</span><span class="st">""</span>,<span class="at">fill=</span><span class="st">""</span>,<span class="at">title=</span><span class="st">"Measles"</span>)</span>
<span id="cb102-1053"><a href="#cb102-1053" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb102-1054"><a href="#cb102-1054" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1055"><a href="#cb102-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1056"><a href="#cb102-1056" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fixed Coords</span></span>
<span id="cb102-1057"><a href="#cb102-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1058"><a href="#cb102-1058" aria-hidden="true" tabindex="-1"></a>We can use <span class="in">`coord_fixed()`</span> to fix the coordinates for equal values in x and y direction. This should render perfectly square tiles.</span>
<span id="cb102-1059"><a href="#cb102-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1062"><a href="#cb102-1062" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1063"><a href="#cb102-1063" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb102-1064"><a href="#cb102-1064" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 9</span></span>
<span id="cb102-1065"><a href="#cb102-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1066"><a href="#cb102-1066" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span><span class="fu">coord_fixed</span>()</span>
<span id="cb102-1067"><a href="#cb102-1067" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb102-1068"><a href="#cb102-1068" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1069"><a href="#cb102-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1070"><a href="#cb102-1070" aria-hidden="true" tabindex="-1"></a><span class="fu">### Annotation</span></span>
<span id="cb102-1071"><a href="#cb102-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1072"><a href="#cb102-1072" aria-hidden="true" tabindex="-1"></a>Add the annotation line and text to denote the introduction of the vaccine. The line is at the position 1963. Custom font 'Gidole' is used here. This can be skipped.</span>
<span id="cb102-1073"><a href="#cb102-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1076"><a href="#cb102-1076" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1077"><a href="#cb102-1077" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb102-1078"><a href="#cb102-1078" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 9</span></span>
<span id="cb102-1079"><a href="#cb102-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1080"><a href="#cb102-1080" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p<span class="sc">+</span><span class="fu">geom_segment</span>(<span class="at">x=</span><span class="dv">1963</span>,<span class="at">xend=</span><span class="dv">1963</span>,<span class="at">y=</span><span class="dv">0</span>,<span class="at">yend=</span><span class="fl">51.5</span>,<span class="at">size=</span>.<span class="dv">6</span>,<span class="at">alpha=</span><span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb102-1081"><a href="#cb102-1081" aria-hidden="true" tabindex="-1"></a>        <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">label=</span><span class="st">"Vaccine introduced"</span>,<span class="at">x=</span><span class="dv">1963</span>,<span class="at">y=</span><span class="dv">53</span>, </span>
<span id="cb102-1082"><a href="#cb102-1082" aria-hidden="true" tabindex="-1"></a>                   <span class="at">vjust=</span><span class="dv">1</span>,<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">size=</span><span class="fu">I</span>(<span class="dv">3</span>),<span class="at">family=</span><span class="st">"Gidole"</span>)</span>
<span id="cb102-1083"><a href="#cb102-1083" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb102-1084"><a href="#cb102-1084" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1085"><a href="#cb102-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1086"><a href="#cb102-1086" aria-hidden="true" tabindex="-1"></a><span class="fu">### Theme</span></span>
<span id="cb102-1087"><a href="#cb102-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1088"><a href="#cb102-1088" aria-hidden="true" tabindex="-1"></a>Here we change the following aspects of the plot using <span class="in">`theme`</span>:</span>
<span id="cb102-1089"><a href="#cb102-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1090"><a href="#cb102-1090" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Change theme to <span class="in">`theme_minimal`</span> to remove unnecessary plot elements.</span>
<span id="cb102-1091"><a href="#cb102-1091" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Optional custom font. See 'Custom font' section under 'Economist Scatterplot'. </span>
<span id="cb102-1092"><a href="#cb102-1092" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Position the legend to bottom center.</span>
<span id="cb102-1093"><a href="#cb102-1093" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Set legend font to color grey20.</span>
<span id="cb102-1094"><a href="#cb102-1094" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Adjust size and justification of x and y axes text</span>
<span id="cb102-1095"><a href="#cb102-1095" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Adjust title justification</span>
<span id="cb102-1096"><a href="#cb102-1096" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Remove all gridlines</span>
<span id="cb102-1097"><a href="#cb102-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1098"><a href="#cb102-1098" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=FALSE}</span></span>
<span id="cb102-1099"><a href="#cb102-1099" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-height: 6</span></span>
<span id="cb102-1100"><a href="#cb102-1100" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-width: 9</span></span>
<span id="cb102-1101"><a href="#cb102-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1102"><a href="#cb102-1102" aria-hidden="true" tabindex="-1"></a><span class="in">p+theme_minimal(base_family="Gidole")+</span></span>
<span id="cb102-1103"><a href="#cb102-1103" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position="bottom",</span></span>
<span id="cb102-1104"><a href="#cb102-1104" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.justification="center",</span></span>
<span id="cb102-1105"><a href="#cb102-1105" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.direction="horizontal",</span></span>
<span id="cb102-1106"><a href="#cb102-1106" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.text=element_text(color="grey20"),</span></span>
<span id="cb102-1107"><a href="#cb102-1107" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.y=element_text(size=6,hjust=1,vjust=0.5),</span></span>
<span id="cb102-1108"><a href="#cb102-1108" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.x=element_text(size=8),</span></span>
<span id="cb102-1109"><a href="#cb102-1109" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.ticks.y=element_blank(),</span></span>
<span id="cb102-1110"><a href="#cb102-1110" aria-hidden="true" tabindex="-1"></a><span class="in">        title=element_text(hjust=-.07,vjust=1),</span></span>
<span id="cb102-1111"><a href="#cb102-1111" aria-hidden="true" tabindex="-1"></a><span class="in">        panel.grid=element_blank())</span></span>
<span id="cb102-1112"><a href="#cb102-1112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1113"><a href="#cb102-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1114"><a href="#cb102-1114" aria-hidden="true" tabindex="-1"></a>Our plot is ready and we can compare it to the original version.</span>
<span id="cb102-1115"><a href="#cb102-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1116"><a href="#cb102-1116" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/wsj-heatmap.png)</span></span>
<span id="cb102-1117"><a href="#cb102-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1118"><a href="#cb102-1118" aria-hidden="true" tabindex="-1"></a>The full code for this challenge is here:</span>
<span id="cb102-1119"><a href="#cb102-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1122"><a href="#cb102-1122" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb102-1123"><a href="#cb102-1123" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb102-1124"><a href="#cb102-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1125"><a href="#cb102-1125" aria-hidden="true" tabindex="-1"></a><span class="co"># custom summing function</span></span>
<span id="cb102-1126"><a href="#cb102-1126" aria-hidden="true" tabindex="-1"></a>fun1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">ifelse</span>(<span class="fu">all</span>(<span class="fu">is.na</span>(x)),<span class="cn">NA</span>,<span class="fu">sum</span>(x,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb102-1127"><a href="#cb102-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1128"><a href="#cb102-1128" aria-hidden="true" tabindex="-1"></a><span class="co"># read data</span></span>
<span id="cb102-1129"><a href="#cb102-1129" aria-hidden="true" tabindex="-1"></a>me3 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"assets/data_wsj.csv"</span>,<span class="at">header=</span>T,</span>
<span id="cb102-1130"><a href="#cb102-1130" aria-hidden="true" tabindex="-1"></a>               <span class="at">stringsAsFactors=</span>F,<span class="at">skip=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-1131"><a href="#cb102-1131" aria-hidden="true" tabindex="-1"></a>        <span class="fu">gather</span>(<span class="at">key=</span>state,<span class="at">value=</span>value,<span class="sc">-</span>YEAR,<span class="sc">-</span>WEEK) <span class="sc">%&gt;%</span></span>
<span id="cb102-1132"><a href="#cb102-1132" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">value=</span><span class="fu">str_replace</span>(value,<span class="st">"^-$"</span>,<span class="cn">NA_character_</span>),</span>
<span id="cb102-1133"><a href="#cb102-1133" aria-hidden="true" tabindex="-1"></a>                            <span class="at">value=</span><span class="fu">as.numeric</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb102-1134"><a href="#cb102-1134" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(YEAR,state) <span class="sc">%&gt;%</span> </span>
<span id="cb102-1135"><a href="#cb102-1135" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">summarise</span>(<span class="at">total=</span><span class="fu">fun1</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb102-1136"><a href="#cb102-1136" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">mutate</span>(<span class="at">state=</span><span class="fu">str_replace_all</span>(state,<span class="st">"[.]"</span>,<span class="st">" "</span>),</span>
<span id="cb102-1137"><a href="#cb102-1137" aria-hidden="true" tabindex="-1"></a>                             <span class="at">state=</span><span class="fu">str_to_title</span>(state))</span>
<span id="cb102-1138"><a href="#cb102-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1139"><a href="#cb102-1139" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(me3) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">colnames</span>(me3))</span>
<span id="cb102-1140"><a href="#cb102-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1141"><a href="#cb102-1141" aria-hidden="true" tabindex="-1"></a><span class="co"># custom colors</span></span>
<span id="cb102-1142"><a href="#cb102-1142" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#e7f0fa"</span>,<span class="st">"#c9e2f6"</span>,<span class="st">"#95cbee"</span>,<span class="st">"#0099dc"</span>,<span class="st">"#4ab04a"</span>, <span class="st">"#ffd73e"</span>,<span class="st">"#eec73a"</span>,<span class="st">"#e29421"</span>,<span class="st">"#f05336"</span>,<span class="st">"#ce472e"</span>)</span>
<span id="cb102-1143"><a href="#cb102-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1144"><a href="#cb102-1144" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting</span></span>
<span id="cb102-1145"><a href="#cb102-1145" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(me3,<span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span><span class="fu">reorder</span>(state,<span class="fu">desc</span>(state)),<span class="at">fill=</span>total))<span class="sc">+</span></span>
<span id="cb102-1146"><a href="#cb102-1146" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>(<span class="at">color=</span><span class="st">"white"</span>,<span class="at">size=</span><span class="fl">0.25</span>)<span class="sc">+</span></span>
<span id="cb102-1147"><a href="#cb102-1147" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_discrete</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb102-1148"><a href="#cb102-1148" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">1930</span>,<span class="dv">2010</span>,<span class="at">by=</span><span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb102-1149"><a href="#cb102-1149" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_gradientn</span>(<span class="at">colors=</span>cols,<span class="at">na.value=</span><span class="st">"grey95"</span>,</span>
<span id="cb102-1150"><a href="#cb102-1150" aria-hidden="true" tabindex="-1"></a>                           <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">4000</span>),</span>
<span id="cb102-1151"><a href="#cb102-1151" aria-hidden="true" tabindex="-1"></a>                           <span class="at">values=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.01</span>,<span class="fl">0.02</span>,<span class="fl">0.03</span>,<span class="fl">0.09</span>,<span class="fl">0.1</span>,<span class="fl">0.15</span>,<span class="fl">0.25</span>,<span class="fl">0.4</span>,<span class="fl">0.5</span>,<span class="dv">1</span>),</span>
<span id="cb102-1152"><a href="#cb102-1152" aria-hidden="true" tabindex="-1"></a>                           <span class="at">labels=</span><span class="fu">c</span>(<span class="st">"0k"</span>,<span class="st">"1k"</span>,<span class="st">"2k"</span>,<span class="st">"3k"</span>,<span class="st">"4k"</span>),</span>
<span id="cb102-1153"><a href="#cb102-1153" aria-hidden="true" tabindex="-1"></a>                           <span class="at">guide=</span><span class="fu">guide_colourbar</span>(<span class="at">ticks=</span>T,<span class="at">nbin=</span><span class="dv">50</span>,</span>
<span id="cb102-1154"><a href="#cb102-1154" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">barheight=</span>.<span class="dv">5</span>,<span class="at">label=</span>T, </span>
<span id="cb102-1155"><a href="#cb102-1155" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">barwidth=</span><span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb102-1156"><a href="#cb102-1156" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x=</span><span class="st">""</span>,<span class="at">y=</span><span class="st">""</span>,<span class="at">fill=</span><span class="st">""</span>,<span class="at">title=</span><span class="st">"Measles"</span>)<span class="sc">+</span></span>
<span id="cb102-1157"><a href="#cb102-1157" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_fixed</span>()<span class="sc">+</span></span>
<span id="cb102-1158"><a href="#cb102-1158" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_segment</span>(<span class="at">x=</span><span class="dv">1963</span>,<span class="at">xend=</span><span class="dv">1963</span>,<span class="at">y=</span><span class="dv">0</span>,<span class="at">yend=</span><span class="fl">51.5</span>,<span class="at">size=</span>.<span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb102-1159"><a href="#cb102-1159" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">label=</span><span class="st">"Vaccine introduced"</span>,<span class="at">x=</span><span class="dv">1963</span>,<span class="at">y=</span><span class="dv">53</span>, </span>
<span id="cb102-1160"><a href="#cb102-1160" aria-hidden="true" tabindex="-1"></a>               <span class="at">vjust=</span><span class="dv">1</span>,<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">size=</span><span class="fu">I</span>(<span class="dv">3</span>),<span class="at">family=</span><span class="st">"Gidole"</span>)<span class="sc">+</span></span>
<span id="cb102-1161"><a href="#cb102-1161" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>(<span class="at">base_family=</span><span class="st">"Gidole"</span>)<span class="sc">+</span></span>
<span id="cb102-1162"><a href="#cb102-1162" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(.<span class="dv">5</span>,<span class="sc">-</span>.<span class="dv">13</span>),</span>
<span id="cb102-1163"><a href="#cb102-1163" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.direction=</span><span class="st">"horizontal"</span>,</span>
<span id="cb102-1164"><a href="#cb102-1164" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"grey20"</span>),</span>
<span id="cb102-1165"><a href="#cb102-1165" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin=</span>grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fu">c</span>(.<span class="dv">5</span>,<span class="dv">0</span>,<span class="fl">1.5</span>,<span class="dv">0</span>),<span class="st">"cm"</span>),</span>
<span id="cb102-1166"><a href="#cb102-1166" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">6</span>,<span class="at">hjust=</span><span class="dv">1</span>,<span class="at">vjust=</span><span class="fl">0.5</span>),</span>
<span id="cb102-1167"><a href="#cb102-1167" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>),</span>
<span id="cb102-1168"><a href="#cb102-1168" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb102-1169"><a href="#cb102-1169" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid=</span><span class="fu">element_blank</span>(),</span>
<span id="cb102-1170"><a href="#cb102-1170" aria-hidden="true" tabindex="-1"></a>        <span class="at">title=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="sc">-</span>.<span class="dv">07</span>,<span class="at">vjust=</span><span class="dv">1</span>),</span>
<span id="cb102-1171"><a href="#cb102-1171" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid=</span><span class="fu">element_blank</span>())</span>
<span id="cb102-1172"><a href="#cb102-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1173"><a href="#cb102-1173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb102-1174"><a href="#cb102-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1175"><a href="#cb102-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1176"><a href="#cb102-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1177"><a href="#cb102-1177" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Acknowledgements:</span></span>
<span id="cb102-1178"><a href="#cb102-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-1179"><a href="#cb102-1179" aria-hidden="true" tabindex="-1"></a>• This document was adapted from <span class="co">[</span><span class="ot">RaukR-2023</span><span class="co">](https://nbisweden.github.io/raukr-2023/labs/ggplot/)</span>,</span>
<span id="cb102-1180"><a href="#cb102-1180" aria-hidden="true" tabindex="-1"></a>• shared under <span class="co">[</span><span class="ot">GPL-3 License</span><span class="co">](https://choosealicense.com/licenses/gpl-3.0/)</span> </span>
<span id="cb102-1181"><a href="#cb102-1181" aria-hidden="true" tabindex="-1"></a>• <span class="co">[</span><span class="ot">SLUBI</span><span class="co">](https://www.slubi.se/)</span> </span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Frame Manipulation with dplyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href=".././scripts/00_precourse.html"> 
<span class="menu-text">Pre-course</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lectures" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lectures</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lectures">    
        <li>
    <a class="dropdown-item" href=".././slides/slides_tidyr.pdf">
 <span class="dropdown-text">tidyr lecture</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href=".././slides/slides_dplyr.pdf">
 <span class="dropdown-text">dplyr lecture</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href=".././slides/ggplot_gsvms_2026.html">
 <span class="dropdown-text">ggplot2 lecture</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lab-exercises" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lab exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lab-exercises">    
        <li>
    <a class="dropdown-item" href=".././scripts/tidyr_abs_2026.html">
 <span class="dropdown-text">tidyr practical</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href=".././scripts/dplyr_abs_2026.html">
 <span class="dropdown-text">dplyr practical</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href=".././practicals/ggplot2_lab_part1.html">
 <span class="dropdown-text">ggplot2 lab</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://swcarpentry.github.io/shell-novice/"> <i class="bi bi-softwerecarpentry" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:abu.siddique@slu.se"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Data Frame Manipulation with dplyr</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul>
  <li><a href="#the-dplyr-package" id="toc-the-dplyr-package" class="nav-link" data-scroll-target="#the-dplyr-package">The <code>dplyr</code> package</a></li>
  <li><a href="#using-select" id="toc-using-select" class="nav-link" data-scroll-target="#using-select">Using select()</a></li>
  <li><a href="#using-filter" id="toc-using-filter" class="nav-link" data-scroll-target="#using-filter">Using filter()</a></li>
  <li><a href="#challenge-1" id="toc-challenge-1" class="nav-link" data-scroll-target="#challenge-1">Challenge 1</a></li>
  <li><a href="#using-group_by" id="toc-using-group_by" class="nav-link" data-scroll-target="#using-group_by">Using group_by()</a></li>
  <li><a href="#using-summarize" id="toc-using-summarize" class="nav-link" data-scroll-target="#using-summarize">Using summarize()</a></li>
  <li><a href="#challenge-2" id="toc-challenge-2" class="nav-link" data-scroll-target="#challenge-2">Challenge 2</a></li>
  <li><a href="#count-and-n" id="toc-count-and-n" class="nav-link" data-scroll-target="#count-and-n">count() and n()</a></li>
  <li><a href="#using-mutate" id="toc-using-mutate" class="nav-link" data-scroll-target="#using-mutate">Using mutate()</a></li>
  <li><a href="#connect-mutate-with-logical-filtering-ifelse" id="toc-connect-mutate-with-logical-filtering-ifelse" class="nav-link" data-scroll-target="#connect-mutate-with-logical-filtering-ifelse">Connect mutate with logical filtering: ifelse</a></li>
  <li><a href="#combining-dplyr-and-ggplot2" id="toc-combining-dplyr-and-ggplot2" class="nav-link" data-scroll-target="#combining-dplyr-and-ggplot2">Combining <code>dplyr</code> and <code>ggplot2</code></a></li>
  <li><a href="#advanced-challenge" id="toc-advanced-challenge" class="nav-link" data-scroll-target="#advanced-challenge">Advanced Challenge</a>
  <ul class="collapse">
  <li><a href="#extras" id="toc-extras" class="nav-link" data-scroll-target="#extras">extras</a></li>
  </ul></li>
  <li><a href="#other-great-resources" id="toc-other-great-resources" class="nav-link" data-scroll-target="#other-great-resources">Other great resources</a></li>
  <li><a href="#keypoints" id="toc-keypoints" class="nav-link" data-scroll-target="#keypoints">keypoints</a>
  <ul class="collapse">
  <li><a href="#r-session-info" id="toc-r-session-info" class="nav-link" data-scroll-target="#r-session-info">R Session info</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Exercise time: 55 minutes</p>
<section id="overview" class="level1">
<h1>Overview</h1>
<p><strong>Questions</strong></p>
<ul>
<li>How can I manipulate data frames without repeating myself?</li>
</ul>
<p><strong>Objectives</strong></p>
<ul>
<li>To be able to use the six main data frame manipulation ‘verbs’ with pipes in <code>dplyr</code>.</li>
<li>To understand how <code>group_by()</code> and <code>summarize()</code> can be combined to summarize datasets.</li>
<li>Be able to analyze a subset of data using logical filtering.</li>
</ul>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gapminder)   <span class="co"># see the data structure</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [1,704 × 6] (S3: tbl_df/tbl/data.frame)
 $ country  : Factor w/ 142 levels "Afghanistan",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ continent: Factor w/ 5 levels "Africa","Americas",..: 3 3 3 3 3 3 3 3 3 3 ...
 $ year     : int [1:1704] 1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ lifeExp  : num [1:1704] 28.8 30.3 32 34 36.1 ...
 $ pop      : int [1:1704] 8425333 9240934 10267083 11537966 13079460 14880372 12881816 13867957 16317921 22227415 ...
 $ gdpPercap: num [1:1704] 779 821 853 836 740 ...</code></pre>
</div>
</div>
<p>Manipulation of data frames means many things to many researchers: we often select certain observations (rows) or variables (columns), we often group the data by a certain variable(s), or we even calculate summary statistics. We can do these operations using the normal base R operations:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Africa"</span>])   <span class="co">#  calculate average for African continent</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2193.755</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Americas"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7136.11</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Asia"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7902.15</code></pre>
</div>
</div>
<p>But this isn’t very <em>nice</em> because there is a fair bit of repetition. Repeating yourself will cost you time, both now and later, and potentially introduce some nasty bugs.</p>
<section id="the-dplyr-package" class="level2">
<h2 class="anchored" data-anchor-id="the-dplyr-package">The <code>dplyr</code> package</h2>
<p>Luckily, the <a href="https://cran.r-project.org/package=dplyr"><code>dplyr</code></a> package provides a number of very useful functions for manipulating data frames in a way that will reduce the above repetition, reduce the probability of making errors, and probably even save you some typing. As an added bonus, you might even find the <code>dplyr</code> grammar easier to read.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip: Tidyverse
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>dplyr</code> package belongs to a broader family of opinionated R packages designed for data science called the “Tidyverse”. These packages are specifically designed to work harmoniously together. Some of these packages will be covered along this course, but you can find more complete information here: <a href="https://www.tidyverse.org/">https://www.tidyverse.org/</a>.</p>
</div>
</div>
<p>Here we’re going to cover 5 of the most commonly used functions as well as using pipes (<code>%&gt;%</code>) to combine them.</p>
<ol type="1">
<li><code>select()</code></li>
<li><code>filter()</code></li>
<li><code>group_by()</code></li>
<li><code>summarize()</code></li>
<li><code>mutate()</code></li>
</ol>
<p>If you have have not installed this package earlier, please do so:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages('dplyr')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now let’s load the package:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="using-select" class="level2">
<h2 class="anchored" data-anchor-id="using-select">Using select()</h2>
<p>If, for example, we wanted to move forward with only a few of the variables in our data frame we could use the <code>select()</code> function. This will keep only the variables you select.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>year_country_gdp <span class="ot">&lt;-</span> <span class="fu">select</span>(gapminder, year, country, gdpPercap) <span class="co"># keep onöy certain columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="fig/13-dplyr-fig1.png" class="img-fluid" alt="Diagram illustrating use of select function to select two columns of a data frame"></p>
<p>If we want to remove one column only from the <code>gapminder</code> data, for example, removing the <code>continent</code> column.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>smaller_gapminder_data <span class="ot">&lt;-</span> <span class="fu">select</span>(gapminder, <span class="sc">-</span>continent) <span class="co"># remove continent variable</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>If we open up <code>year_country_gdp</code> we’ll see that it only contains the year, country and gdpPercap. Above we used ‘normal’ grammar, but the strengths of <code>dplyr</code> lie in combining several functions using pipes. Since the pipes grammar is unlike anything we’ve seen in R before, let’s repeat what we’ve done above using pipes.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>year_country_gdp <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span>  <span class="co"># use pipe</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, country, gdpPercap) <span class="co"># select few columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To help you understand why we wrote that in that way, let’s walk through it step by step. First we summon the gapminder data frame and pass it on, using the pipe symbol <code>%&gt;%</code>, to the next step, which is the <code>select()</code> function. In this case we don’t specify which data object we use in the <code>select()</code> function since in gets that from the previous pipe. <strong>Fun Fact</strong>: There is a good chance you have encountered pipes before in the shell. In R, a pipe symbol is <code>%&gt;%</code> while in the shell it is <code>|</code> but the concept is the same!</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip: Renaming data frame columns in dplyr
</div>
</div>
<div class="callout-body-container callout-body">
<p>In Chapter 4 we covered how you can rename columns with base R by assigning a value to the output of the <code>names()</code> function. Just like select, this is a bit cumbersome, but thankfully dplyr has a <code>rename()</code> function.</p>
<p>Within a pipeline, the syntax is <code>rename(new_name = old_name)</code>. For example, we may want to rename the gdpPercap column name from our <code>select()</code> statement above.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tidy_gdp <span class="ot">&lt;-</span> year_country_gdp <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gdp_per_capita =</span> gdpPercap)  <span class="co"># rename a variable name or column name</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tidy_gdp)  <span class="co"># see first few lines</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: left;">country</th>
<th style="text-align: right;">gdp_per_capita</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1952</td>
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">779.4453</td>
</tr>
<tr class="even">
<td style="text-align: right;">1957</td>
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">820.8530</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1962</td>
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">853.1007</td>
</tr>
<tr class="even">
<td style="text-align: right;">1967</td>
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">836.1971</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1972</td>
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">739.9811</td>
</tr>
<tr class="even">
<td style="text-align: right;">1977</td>
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">786.1134</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="using-filter" class="level2">
<h2 class="anchored" data-anchor-id="using-filter">Using filter()</h2>
<p>If we now want to move forward with the above, but only with European countries, we can combine <code>select</code> and <code>filter</code></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>year_country_gdp_euro <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">"Europe"</span>) <span class="sc">%&gt;%</span>  <span class="co"># keep observation (rows) that have Europe</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(year, country, gdpPercap)   <span class="co"># keep variables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>If we now want to show life expectancy of European countries but only for a specific year (e.g., 2007), we can do as below.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>europe_lifeExp_2007 <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">"Europe"</span>, year <span class="sc">==</span> <span class="dv">2007</span>) <span class="sc">%&gt;%</span> <span class="co"># now take observation that have Europe &amp; 2007</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, lifeExp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="challenge-1" class="level2">
<h2 class="anchored" data-anchor-id="challenge-1">Challenge 1</h2>
<p>Write a single command (which can span multiple lines and includes pipes) that will produce a data frame that has the African values for <code>lifeExp</code>, <code>country</code> and <code>year</code>, but not for other Continents. How many rows does your data frame have and why?</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution to challenge 1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>year_country_lifeExp_Africa <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">"Africa"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">select</span>(year, country, lifeExp)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(year_country_lifeExp_Africa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: left;">country</th>
<th style="text-align: right;">lifeExp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1952</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: right;">43.077</td>
</tr>
<tr class="even">
<td style="text-align: right;">1957</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: right;">45.685</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1962</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: right;">48.303</td>
</tr>
<tr class="even">
<td style="text-align: right;">1967</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: right;">51.407</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1972</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: right;">54.518</td>
</tr>
<tr class="even">
<td style="text-align: right;">1977</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: right;">58.014</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p>As with last time, first we pass the gapminder data frame to the <code>filter()</code> function, then we pass the filtered version of the gapminder data frame to the <code>select()</code> function. <strong>Note:</strong> The order of operations is very important in this case. If we used ‘select’ first, filter would not be able to find the variable continent since we would have removed it in the previous step.</p>
</section>
<section id="using-group_by" class="level2">
<h2 class="anchored" data-anchor-id="using-group_by">Using group_by()</h2>
<p>Now, we were supposed to be reducing the error prone repetitiveness of what can be done with base R, but up to now we haven’t done that since we would have to repeat the above for each continent. Instead of <code>filter()</code>, which will only pass observations that meet your criteria (in the above: <code>continent=="Europe"</code>), we can use <code>group_by()</code>, which will essentially use every unique criteria that you could have used in filter.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gapminder)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [1,704 × 6] (S3: tbl_df/tbl/data.frame)
 $ country  : Factor w/ 142 levels "Afghanistan",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ continent: Factor w/ 5 levels "Africa","Americas",..: 3 3 3 3 3 3 3 3 3 3 ...
 $ year     : int [1:1704] 1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ lifeExp  : num [1:1704] 28.8 30.3 32 34 36.1 ...
 $ pop      : int [1:1704] 8425333 9240934 10267083 11537966 13079460 14880372 12881816 13867957 16317921 22227415 ...
 $ gdpPercap: num [1:1704] 779 821 853 836 740 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gapminder <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(continent))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>gropd_df [1,704 × 6] (S3: grouped_df/tbl_df/tbl/data.frame)
 $ country  : Factor w/ 142 levels "Afghanistan",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ continent: Factor w/ 5 levels "Africa","Americas",..: 3 3 3 3 3 3 3 3 3 3 ...
 $ year     : int [1:1704] 1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ lifeExp  : num [1:1704] 28.8 30.3 32 34 36.1 ...
 $ pop      : int [1:1704] 8425333 9240934 10267083 11537966 13079460 14880372 12881816 13867957 16317921 22227415 ...
 $ gdpPercap: num [1:1704] 779 821 853 836 740 ...
 - attr(*, "groups")= tibble [5 × 2] (S3: tbl_df/tbl/data.frame)
  ..$ continent: Factor w/ 5 levels "Africa","Americas",..: 1 2 3 4 5
  ..$ .rows    : list&lt;int&gt; [1:5] 
  .. ..$ : int [1:624] 25 26 27 28 29 30 31 32 33 34 ...
  .. ..$ : int [1:300] 49 50 51 52 53 54 55 56 57 58 ...
  .. ..$ : int [1:396] 1 2 3 4 5 6 7 8 9 10 ...
  .. ..$ : int [1:360] 13 14 15 16 17 18 19 20 21 22 ...
  .. ..$ : int [1:24] 61 62 63 64 65 66 67 68 69 70 ...
  .. ..@ ptype: int(0) 
  ..- attr(*, ".drop")= logi TRUE</code></pre>
</div>
</div>
<p>You will notice that the structure of the data frame where we used <code>group_by()</code> (<code>grouped_df</code>) is not the same as the original <code>gapminder</code> (<code>data.frame</code>). A <code>grouped_df</code> can be thought of as a <code>list</code> where each item in the <code>list</code>is a <code>data.frame</code> which contains only the rows that correspond to the a particular value <code>continent</code> (at least in the example above).</p>
<p><img src="fig/13-dplyr-fig2.png" class="img-fluid" alt="Diagram illustrating how the group by function oraganizes a data frame into groups"></p>
</section>
<section id="using-summarize" class="level2">
<h2 class="anchored" data-anchor-id="using-summarize">Using summarize()</h2>
<p>The above was a bit on the uneventful side but <code>group_by()</code> is much more exciting in conjunction with <code>summarize()</code>. This will allow us to create new variable(s) by using functions that repeat for each of the continent-specific data frames. That is to say, using the <code>group_by()</code> function, we split our original data frame into multiple pieces, then we can run functions (e.g.&nbsp;<code>mean()</code> or <code>sd()</code>) within <code>summarize()</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>gdp_bycontinents <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="fig/13-dplyr-fig3.png" class="img-fluid" alt="Diagram illustrating the use of group by and summarize together to create a new variable"></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>continent mean_gdpPercap</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>     <span class="sc">&lt;</span>fctr<span class="sc">&gt;</span>          <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    Africa       <span class="fl">2193.755</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  Americas       <span class="fl">7136.110</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>      Asia       <span class="fl">7902.150</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    Europe      <span class="fl">14469.476</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   Oceania      <span class="fl">18621.609</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>That allowed us to calculate the mean gdpPercap for each continent, but it gets even better.</p>
</section>
<section id="challenge-2" class="level2">
<h2 class="anchored" data-anchor-id="challenge-2">Challenge 2</h2>
<p>Calculate the average life expectancy per country. Which has the longest average life expectancy and which has the shortest average life expectancy?</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution to challenge 2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>lifeExp_bycountry <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span>                                       <span class="co"># group countrywise contrywise</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="at">mean_lifeExp =</span> <span class="fu">mean</span>(lifeExp))                     <span class="co"># calculate average</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>lifeExp_bycountry <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(mean_lifeExp <span class="sc">==</span> <span class="fu">min</span>(mean_lifeExp) <span class="sc">|</span> mean_lifeExp <span class="sc">==</span> <span class="fu">max</span>(mean_lifeExp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">country</th>
<th style="text-align: right;">mean_lifeExp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Iceland</td>
<td style="text-align: right;">76.51142</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sierra Leone</td>
<td style="text-align: right;">36.76917</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Another way to do this is to use the <code>dplyr</code> function <code>arrange()</code>, which arranges the rows in a data frame according to the order of one or more variables from the data frame. It has similar syntax to other functions from the <code>dplyr</code> package. You can use <code>desc()</code> inside <code>arrange()</code> to sort in descending order.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>lifeExp_bycountry <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(mean_lifeExp) <span class="sc">%&gt;%</span>        <span class="co"># sort</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">head</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">country</th>
<th style="text-align: right;">mean_lifeExp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sierra Leone</td>
<td style="text-align: right;">36.76917</td>
</tr>
</tbody>
</table>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>lifeExp_bycountry <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_lifeExp)) <span class="sc">%&gt;%</span>  <span class="co"># arrange in decentralizing jon</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">head</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">country</th>
<th style="text-align: right;">mean_lifeExp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Iceland</td>
<td style="text-align: right;">76.51142</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Alphabetical order works too</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>lifeExp_bycountry <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(<span class="fu">desc</span>(country)) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">head</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">country</th>
<th style="text-align: right;">mean_lifeExp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Zimbabwe</td>
<td style="text-align: right;">52.66317</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p>The function <code>group_by()</code> allows us to group by multiple variables. Let’s group by <code>year</code> and <code>continent</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>gdp_bycontinents_byyear <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent, year) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>
<p>That is already quite powerful, but it gets even better! You’re not limited to defining 1 new variable in <code>summarize()</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>gdp_pop_bycontinents_byyear <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent, year) <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_gdpPercap =</span> <span class="fu">sd</span>(gdpPercap),     <span class="co"># calculate standard deviation</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_pop =</span> <span class="fu">mean</span>(pop),             <span class="co"># calculate average</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_pop =</span> <span class="fu">sd</span>(pop))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>
</section>
<section id="count-and-n" class="level2">
<h2 class="anchored" data-anchor-id="count-and-n">count() and n()</h2>
<p>A very common operation is to count the number of observations for each group. The <code>dplyr</code> package comes with two related functions that help with this.</p>
<p>For instance, if we wanted to check the number of countries included in the dataset for the year 2002, we can use the <code>count()</code> function. It takes the name of one or more columns that contain the groups we are interested in, and we can optionally sort the results in descending order by adding <code>sort=TRUE</code>:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2002</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(continent, <span class="at">sort =</span> <span class="cn">TRUE</span>)    <span class="co"># do counting</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">continent</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Africa</td>
<td style="text-align: right;">52</td>
</tr>
<tr class="even">
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Europe</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="even">
<td style="text-align: left;">Americas</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Oceania</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>If we need to use the number of observations in calculations, the <code>n()</code> function is useful. It will return the total number of observations in the current group rather than counting the number of observations in each group within a specific column. For instance, if we wanted to get the standard error of the life expectency per continent:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">se_le =</span> <span class="fu">sd</span>(lifeExp)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">n</span>()))   <span class="co"># calculaate standard error</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">continent</th>
<th style="text-align: right;">se_le</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Africa</td>
<td style="text-align: right;">0.3663016</td>
</tr>
<tr class="even">
<td style="text-align: left;">Americas</td>
<td style="text-align: right;">0.5395389</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">0.5962151</td>
</tr>
<tr class="even">
<td style="text-align: left;">Europe</td>
<td style="text-align: right;">0.2863536</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Oceania</td>
<td style="text-align: right;">0.7747759</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>You can also chain together several summary operations; in this case calculating the <code>minimum</code>, <code>maximum</code>, <code>mean</code> and <code>se</code> of each continent’s per-country life-expectancy:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_le =</span> <span class="fu">mean</span>(lifeExp),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_le =</span> <span class="fu">min</span>(lifeExp),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_le =</span> <span class="fu">max</span>(lifeExp),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">se_le =</span> <span class="fu">sd</span>(lifeExp)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">n</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">continent</th>
<th style="text-align: right;">mean_le</th>
<th style="text-align: right;">min_le</th>
<th style="text-align: right;">max_le</th>
<th style="text-align: right;">se_le</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Africa</td>
<td style="text-align: right;">48.86533</td>
<td style="text-align: right;">23.599</td>
<td style="text-align: right;">76.442</td>
<td style="text-align: right;">0.3663016</td>
</tr>
<tr class="even">
<td style="text-align: left;">Americas</td>
<td style="text-align: right;">64.65874</td>
<td style="text-align: right;">37.579</td>
<td style="text-align: right;">80.653</td>
<td style="text-align: right;">0.5395389</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">60.06490</td>
<td style="text-align: right;">28.801</td>
<td style="text-align: right;">82.603</td>
<td style="text-align: right;">0.5962151</td>
</tr>
<tr class="even">
<td style="text-align: left;">Europe</td>
<td style="text-align: right;">71.90369</td>
<td style="text-align: right;">43.585</td>
<td style="text-align: right;">81.757</td>
<td style="text-align: right;">0.2863536</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Oceania</td>
<td style="text-align: right;">74.32621</td>
<td style="text-align: right;">69.120</td>
<td style="text-align: right;">81.235</td>
<td style="text-align: right;">0.7747759</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="using-mutate" class="level2">
<h2 class="anchored" data-anchor-id="using-mutate">Using mutate()</h2>
<p>We can also create new variables prior to (or even after) summarizing information using <code>mutate()</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>gdp_pop_bycontinents_byyear <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">gdp_billion =</span> gdpPercap<span class="sc">*</span>pop<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent,year) <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_gdpPercap =</span> <span class="fu">sd</span>(gdpPercap),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_pop =</span> <span class="fu">mean</span>(pop),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_pop =</span> <span class="fu">sd</span>(pop),</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_gdp_billion =</span> <span class="fu">mean</span>(gdp_billion),</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_gdp_billion =</span> <span class="fu">sd</span>(gdp_billion))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>
</section>
<section id="connect-mutate-with-logical-filtering-ifelse" class="level2">
<h2 class="anchored" data-anchor-id="connect-mutate-with-logical-filtering-ifelse">Connect mutate with logical filtering: ifelse</h2>
<p>When creating new variables, we can hook this with a logical condition. A simple combination of <code>mutate()</code> and <code>ifelse()</code> facilitates filtering right where it is needed: in the moment of creating something new. This easy-to-read statement is a fast and powerful way of discarding certain data (even though the overall dimension of the data frame will not change) or for updating values depending on this given condition.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="do">## keeping all data but "filtering" after a certain condition</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate GDP only for people with a life expectation above 25</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>gdp_pop_bycontinents_byyear_above25 <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">gdp_billion =</span> <span class="fu">ifelse</span>(lifeExp <span class="sc">&gt;</span> <span class="dv">25</span>,                    <span class="co"># life expectation above 25</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                                gdpPercap <span class="sc">*</span> pop <span class="sc">/</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">9</span>, <span class="cn">NA</span>)) <span class="sc">%&gt;%</span> <span class="co">#  GDP (in billions)</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent, year) <span class="sc">%&gt;%</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap),</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_gdpPercap =</span> <span class="fu">sd</span>(gdpPercap),</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_pop =</span> <span class="fu">mean</span>(pop),</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_pop =</span> <span class="fu">sd</span>(pop),</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_gdp_billion =</span> <span class="fu">mean</span>(gdp_billion),</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_gdp_billion =</span> <span class="fu">sd</span>(gdp_billion))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="do">## updating only if certain condition is fullfilled</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for life expectations above 40 years, the gpd to be expected in the future is scaled</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>gdp_future_bycontinents_byyear_high_lifeExp <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">gdp_futureExpectation =</span> <span class="fu">ifelse</span>(lifeExp <span class="sc">&gt;</span> <span class="dv">40</span>, </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                                          gdpPercap <span class="sc">*</span> <span class="fl">1.5</span>, </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                                          gdpPercap)) <span class="sc">%&gt;%</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent, year) <span class="sc">%&gt;%</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap),</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_gdpPercap_expected =</span> <span class="fu">mean</span>(gdp_futureExpectation))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'continent'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>
</section>
<section id="combining-dplyr-and-ggplot2" class="level2">
<h2 class="anchored" data-anchor-id="combining-dplyr-and-ggplot2">Combining <code>dplyr</code> and <code>ggplot2</code></h2>
<p>First install and load ggplot2:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'ggplot2'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.4.3</code></pre>
</div>
</div>
<p>Let’s plot the variables from the last data you generated</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>gdp_future_bycontinents_byyear_high_lifeExp <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> mean_gdpPercap, <span class="at">group =</span> continent, <span class="at">colour =</span> continent)) <span class="sc">+</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="dplyr_abs_2026_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In the plotting lesson we looked at how to make a multi-panel figure by adding a layer of facet panels using <code>ggplot2</code>. Here is the code we used (with some extra comments):</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter countries located in the Americas</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>americas <span class="ot">&lt;-</span> gapminder[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Americas"</span>, ]</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the plot</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> americas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> lifeExp)) <span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> country) <span class="sc">+</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="dplyr_abs_2026_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This code makes the right plot but it also creates an intermediate variable (<code>americas</code>) that we might not have any other uses for. Just as we used <code>%&gt;%</code> to pipe data along a chain of <code>dplyr</code> functions we can use it to pass data to <code>ggplot()</code>. Because <code>%&gt;%</code> replaces the first argument in a function we don’t need to specify the <code>data =</code> argument in the <code>ggplot()</code> function. By combining <code>dplyr</code> and <code>ggplot2</code> functions we can make the same figure without creating any new variables or modifying the data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter countries located in the Americas</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">"Americas"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make the plot</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> lifeExp)) <span class="sc">+</span> <span class="co"># set x and y</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span>                                  <span class="co"># line plot</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> country) <span class="sc">+</span>                       <span class="co"># split the plot by country</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))  <span class="co"># x axis labels at 45 degree angle</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="dplyr_abs_2026_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>More examples of using the function <code>mutate()</code> and the <code>ggplot2</code> package.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract first letter of country name into new column</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">startsWith =</span> <span class="fu">substr</span>(country, <span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># only keep countries starting with A or Z</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(startsWith <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"Z"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot lifeExp into facets</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> lifeExp, <span class="at">colour =</span> continent)) <span class="sc">+</span>  <span class="co"># x and y and set color</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span>                                             <span class="co"># line plot</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(country)) <span class="sc">+</span>                               <span class="co"># faceting variables </span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()                                           <span class="co"># set theme</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="dplyr_abs_2026_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="advanced-challenge" class="level2">
<h2 class="anchored" data-anchor-id="advanced-challenge">Advanced Challenge</h2>
<p>Calculate the average life expectancy in 2002 of 2 randomly selected countries for each continent. Then arrange the continent names in reverse order. <strong>Hint:</strong> Use the <code>dplyr</code> functions <code>arrange()</code> and <code>sample_n()</code>, they have similar syntax to other dplyr functions.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution to Advanced Challenge
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>lifeExp_2countries_bycontinents <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span>  <span class="co"># take the data </span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(year<span class="sc">==</span><span class="dv">2002</span>) <span class="sc">%&gt;%</span>                         <span class="co"># keep rows that has year 2002</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span>                        <span class="co"># regroup by continent</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sample_n</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span>                                <span class="co"># take 2 random continent</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="at">mean_lifeExp=</span><span class="fu">mean</span>(lifeExp)) <span class="sc">%&gt;%</span>      <span class="co"># calculate mean life expectancy</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_lifeExp))                    <span class="co"># sort in reverse order</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<section id="extras" class="level3">
<h3 class="anchored" data-anchor-id="extras">extras</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>lifeExp_2countries_bycontinents <span class="sc">%&gt;%</span>        <span class="co"># data</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(continent,mean_lifeExp)) <span class="sc">+</span>    <span class="co"># x and y axis</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()                             <span class="co"># scattered plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="dplyr_abs_2026_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="other-great-resources" class="level2">
<h2 class="anchored" data-anchor-id="other-great-resources">Other great resources</h2>
<ul>
<li><a href="https://r4ds.hadley.nz/">R for Data Science</a> (online book)</li>
<li><a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">Data Wrangling Cheat sheet</a> (pdf file)</li>
<li><a href="https://dplyr.tidyverse.org/">Introduction to dplyr</a> (online documentation)</li>
<li><a href="https://www.rstudio.com/resources/webinars/data-wrangling-with-r-and-rstudio/">Data wrangling with R and RStudio</a> (online video)</li>
<li><a href="https://jhudatascience.org/tidyversecourse/">Tidyverse Skills for Data Science</a> (online book)</li>
</ul>
</section>
<section id="keypoints" class="level2">
<h2 class="anchored" data-anchor-id="keypoints">keypoints</h2>
<ul>
<li>Use the <code>dplyr</code> package to manipulate data frames.</li>
<li>Use <code>select()</code> to choose variables from a data frame.</li>
<li>Use <code>filter()</code> to choose data based on values.</li>
<li>Use <code>group_by()</code> and <code>summarize()</code> to work with subsets of data.</li>
<li>Use <code>mutate()</code> to create new variables.</li>
</ul>
<section id="r-session-info" class="level4">
<h4 class="anchored" data-anchor-id="r-session-info">R Session info</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.4.1 (2024-06-14 ucrt)
Platform: x86_64-w64-mingw32/x64
Running under: Windows 11 x64 (build 26100)

Matrix products: default


locale:
[1] LC_COLLATE=English_Sweden.utf8  LC_CTYPE=English_Sweden.utf8   
[3] LC_MONETARY=English_Sweden.utf8 LC_NUMERIC=C                   
[5] LC_TIME=English_Sweden.utf8    

time zone: Europe/Stockholm
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] ggplot2_4.0.0   dplyr_1.1.4     gapminder_1.0.1

loaded via a namespace (and not attached):
 [1] vctrs_0.6.5        cli_3.6.3          knitr_1.50         rlang_1.1.4       
 [5] xfun_0.53          generics_0.1.4     S7_0.2.0           jsonlite_1.8.9    
 [9] labeling_0.4.3     glue_1.8.0         htmltools_0.5.8.1  scales_1.4.0      
[13] rmarkdown_2.29     grid_4.4.1         evaluate_1.0.5     tibble_3.2.1      
[17] fastmap_1.2.0      yaml_2.3.10        lifecycle_1.0.4    compiler_4.4.1    
[21] RColorBrewer_1.1-3 htmlwidgets_1.6.4  pkgconfig_2.0.3    rstudioapi_0.17.1 
[25] farver_2.1.2       digest_0.6.37      R6_2.6.1           dichromat_2.0-0.1 
[29] tidyselect_1.2.1   pillar_1.11.1      magrittr_2.0.3     gtable_0.3.6      
[33] tools_4.4.1        withr_3.0.2       </code></pre>
</div>
</div>
<section id="end" class="level14">
<p class="heading">END</p>


<!-- -->

</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/yourdomain\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb52" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Data Frame Manipulation with dplyr"</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> source</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co">    title-block-banner: true</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co">    smooth-scroll: true</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 4</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: right</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co">    number-types: true</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co">    number-depth: 4</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: kable</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="co">    standalone: false</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-align: left</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: pulse</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight: kate</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>Exercise time: 55 minutes</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: asis</span></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"# "</span>,<span class="st">"Overview"</span>)</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>**Questions**</span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>How can I manipulate data frames without repeating myself?</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>**Objectives**</span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To be able to use the six main data frame manipulation 'verbs' with pipes in  <span class="in">`dplyr`</span>.</span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To understand how <span class="in">`group_by()`</span> and <span class="in">`summarize()`</span> can be combined to summarize datasets.</span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Be able to analyze a subset of data using logical filtering.</span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>---------------------------------------------------------------</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a><span class="in"># install.packages("gapminder")  # install the package </span></span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a><span class="in">library(gapminder)               # load the data</span></span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a><span class="in"># or import from your laptop</span></span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a><span class="in"># gapminder &lt;- read.csv("data/gapminder_data.csv", header = TRUE)</span></span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gapminder)   <span class="co"># see the data structure</span></span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true" tabindex="-1"></a>Manipulation of data frames means many things to many researchers: we often</span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true" tabindex="-1"></a>select certain observations (rows) or variables (columns), we often group the</span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true" tabindex="-1"></a>data by a certain variable(s), or we even calculate summary statistics. We can</span>
<span id="cb52-66"><a href="#cb52-66" aria-hidden="true" tabindex="-1"></a>do these operations using the normal base R operations:</span>
<span id="cb52-67"><a href="#cb52-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-70"><a href="#cb52-70" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-71"><a href="#cb52-71" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Africa"</span>])   <span class="co">#  calculate average for African continent</span></span>
<span id="cb52-72"><a href="#cb52-72" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Americas"</span>])</span>
<span id="cb52-73"><a href="#cb52-73" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(gapminder<span class="sc">$</span>gdpPercap[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Asia"</span>])</span>
<span id="cb52-74"><a href="#cb52-74" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-75"><a href="#cb52-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-76"><a href="#cb52-76" aria-hidden="true" tabindex="-1"></a>But this isn't very *nice* because there is a fair bit of repetition. Repeating</span>
<span id="cb52-77"><a href="#cb52-77" aria-hidden="true" tabindex="-1"></a>yourself will cost you time, both now and later, and potentially introduce some</span>
<span id="cb52-78"><a href="#cb52-78" aria-hidden="true" tabindex="-1"></a>nasty bugs.</span>
<span id="cb52-79"><a href="#cb52-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-80"><a href="#cb52-80" aria-hidden="true" tabindex="-1"></a><span class="fu">## The `dplyr` package</span></span>
<span id="cb52-81"><a href="#cb52-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-82"><a href="#cb52-82" aria-hidden="true" tabindex="-1"></a>Luckily, the <span class="co">[</span><span class="ot">`dplyr`</span><span class="co">](https://cran.r-project.org/package=dplyr)</span></span>
<span id="cb52-83"><a href="#cb52-83" aria-hidden="true" tabindex="-1"></a>package provides a number of very useful functions for manipulating data frames</span>
<span id="cb52-84"><a href="#cb52-84" aria-hidden="true" tabindex="-1"></a>in a way that will reduce the above repetition, reduce the probability of making</span>
<span id="cb52-85"><a href="#cb52-85" aria-hidden="true" tabindex="-1"></a>errors, and probably even save you some typing. As an added bonus, you might</span>
<span id="cb52-86"><a href="#cb52-86" aria-hidden="true" tabindex="-1"></a>even find the <span class="in">`dplyr`</span> grammar easier to read.</span>
<span id="cb52-87"><a href="#cb52-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-88"><a href="#cb52-88" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb52-89"><a href="#cb52-89" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Tip: Tidyverse</span></span>
<span id="cb52-90"><a href="#cb52-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-91"><a href="#cb52-91" aria-hidden="true" tabindex="-1"></a><span class="in">`dplyr`</span> package belongs to a broader family of opinionated R packages</span>
<span id="cb52-92"><a href="#cb52-92" aria-hidden="true" tabindex="-1"></a>designed for data science called the "Tidyverse". These</span>
<span id="cb52-93"><a href="#cb52-93" aria-hidden="true" tabindex="-1"></a>packages are specifically designed to work harmoniously together.</span>
<span id="cb52-94"><a href="#cb52-94" aria-hidden="true" tabindex="-1"></a>Some of these packages will be covered along this course, but you can find more</span>
<span id="cb52-95"><a href="#cb52-95" aria-hidden="true" tabindex="-1"></a>complete information here: <span class="co">[</span><span class="ot">https://www.tidyverse.org/</span><span class="co">](https://www.tidyverse.org/)</span>.</span>
<span id="cb52-96"><a href="#cb52-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-97"><a href="#cb52-97" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb52-98"><a href="#cb52-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-99"><a href="#cb52-99" aria-hidden="true" tabindex="-1"></a>Here we're going to cover 5 of the most commonly used functions as well as using</span>
<span id="cb52-100"><a href="#cb52-100" aria-hidden="true" tabindex="-1"></a>pipes (<span class="in">`%&gt;%`</span>) to combine them.</span>
<span id="cb52-101"><a href="#cb52-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-102"><a href="#cb52-102" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span><span class="in">`select()`</span></span>
<span id="cb52-103"><a href="#cb52-103" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span><span class="in">`filter()`</span></span>
<span id="cb52-104"><a href="#cb52-104" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span><span class="in">`group_by()`</span></span>
<span id="cb52-105"><a href="#cb52-105" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span><span class="in">`summarize()`</span></span>
<span id="cb52-106"><a href="#cb52-106" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span><span class="in">`mutate()`</span></span>
<span id="cb52-107"><a href="#cb52-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-108"><a href="#cb52-108" aria-hidden="true" tabindex="-1"></a>If you have have not installed this package earlier, please do so:</span>
<span id="cb52-109"><a href="#cb52-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-110"><a href="#cb52-110" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb52-111"><a href="#cb52-111" aria-hidden="true" tabindex="-1"></a><span class="in"># install.packages('dplyr')</span></span>
<span id="cb52-112"><a href="#cb52-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-113"><a href="#cb52-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-114"><a href="#cb52-114" aria-hidden="true" tabindex="-1"></a>Now let's load the package:</span>
<span id="cb52-115"><a href="#cb52-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-116"><a href="#cb52-116" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb52-117"><a href="#cb52-117" aria-hidden="true" tabindex="-1"></a><span class="in">library("dplyr")</span></span>
<span id="cb52-118"><a href="#cb52-118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-119"><a href="#cb52-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-120"><a href="#cb52-120" aria-hidden="true" tabindex="-1"></a><span class="fu">## Using select()</span></span>
<span id="cb52-121"><a href="#cb52-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-122"><a href="#cb52-122" aria-hidden="true" tabindex="-1"></a>If, for example, we wanted to move forward with only a few of the variables in</span>
<span id="cb52-123"><a href="#cb52-123" aria-hidden="true" tabindex="-1"></a>our data frame we could use the <span class="in">`select()`</span> function. This will keep only the</span>
<span id="cb52-124"><a href="#cb52-124" aria-hidden="true" tabindex="-1"></a>variables you select.</span>
<span id="cb52-125"><a href="#cb52-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-128"><a href="#cb52-128" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-129"><a href="#cb52-129" aria-hidden="true" tabindex="-1"></a>year_country_gdp <span class="ot">&lt;-</span> <span class="fu">select</span>(gapminder, year, country, gdpPercap) <span class="co"># keep onöy certain columns</span></span>
<span id="cb52-130"><a href="#cb52-130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-131"><a href="#cb52-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-132"><a href="#cb52-132" aria-hidden="true" tabindex="-1"></a><span class="al">![](fig/13-dplyr-fig1.png)</span>{alt='Diagram illustrating use of select function to select two columns of a data frame'}</span>
<span id="cb52-133"><a href="#cb52-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-134"><a href="#cb52-134" aria-hidden="true" tabindex="-1"></a>If we want to remove one column only from the <span class="in">`gapminder`</span> data, for example,</span>
<span id="cb52-135"><a href="#cb52-135" aria-hidden="true" tabindex="-1"></a>removing the <span class="in">`continent`</span> column.</span>
<span id="cb52-136"><a href="#cb52-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-139"><a href="#cb52-139" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-140"><a href="#cb52-140" aria-hidden="true" tabindex="-1"></a>smaller_gapminder_data <span class="ot">&lt;-</span> <span class="fu">select</span>(gapminder, <span class="sc">-</span>continent) <span class="co"># remove continent variable</span></span>
<span id="cb52-141"><a href="#cb52-141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-142"><a href="#cb52-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-143"><a href="#cb52-143" aria-hidden="true" tabindex="-1"></a>If we open up <span class="in">`year_country_gdp`</span> we'll see that it only contains the year,</span>
<span id="cb52-144"><a href="#cb52-144" aria-hidden="true" tabindex="-1"></a>country and gdpPercap. Above we used 'normal' grammar, but the strengths of</span>
<span id="cb52-145"><a href="#cb52-145" aria-hidden="true" tabindex="-1"></a><span class="in">`dplyr`</span> lie in combining several functions using pipes. Since the pipes grammar</span>
<span id="cb52-146"><a href="#cb52-146" aria-hidden="true" tabindex="-1"></a>is unlike anything we've seen in R before, let's repeat what we've done above</span>
<span id="cb52-147"><a href="#cb52-147" aria-hidden="true" tabindex="-1"></a>using pipes.</span>
<span id="cb52-148"><a href="#cb52-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-151"><a href="#cb52-151" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-152"><a href="#cb52-152" aria-hidden="true" tabindex="-1"></a>year_country_gdp <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span>  <span class="co"># use pipe</span></span>
<span id="cb52-153"><a href="#cb52-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, country, gdpPercap) <span class="co"># select few columns</span></span>
<span id="cb52-154"><a href="#cb52-154" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-155"><a href="#cb52-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-156"><a href="#cb52-156" aria-hidden="true" tabindex="-1"></a>To help you understand why we wrote that in that way, let's walk through it step</span>
<span id="cb52-157"><a href="#cb52-157" aria-hidden="true" tabindex="-1"></a>by step. First we summon the gapminder data frame and pass it on, using the pipe</span>
<span id="cb52-158"><a href="#cb52-158" aria-hidden="true" tabindex="-1"></a>symbol <span class="in">`%&gt;%`</span>, to the next step, which is the <span class="in">`select()`</span> function. In this case</span>
<span id="cb52-159"><a href="#cb52-159" aria-hidden="true" tabindex="-1"></a>we don't specify which data object we use in the <span class="in">`select()`</span> function since in</span>
<span id="cb52-160"><a href="#cb52-160" aria-hidden="true" tabindex="-1"></a>gets that from the previous pipe. </span>
<span id="cb52-161"><a href="#cb52-161" aria-hidden="true" tabindex="-1"></a>**Fun Fact**: There is a good chance you have</span>
<span id="cb52-162"><a href="#cb52-162" aria-hidden="true" tabindex="-1"></a>encountered pipes before in the shell. In R, a pipe symbol is <span class="in">`%&gt;%`</span> while in the</span>
<span id="cb52-163"><a href="#cb52-163" aria-hidden="true" tabindex="-1"></a>shell it is <span class="in">`|`</span> but the concept is the same!</span>
<span id="cb52-164"><a href="#cb52-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-165"><a href="#cb52-165" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb52-166"><a href="#cb52-166" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Tip: Renaming data frame columns in dplyr</span></span>
<span id="cb52-167"><a href="#cb52-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-168"><a href="#cb52-168" aria-hidden="true" tabindex="-1"></a>In Chapter 4 we covered how you can rename columns with base R by assigning a value to the output of the <span class="in">`names()`</span> function.</span>
<span id="cb52-169"><a href="#cb52-169" aria-hidden="true" tabindex="-1"></a>Just like select, this is a bit cumbersome, but thankfully dplyr has a <span class="in">`rename()`</span> function.</span>
<span id="cb52-170"><a href="#cb52-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-171"><a href="#cb52-171" aria-hidden="true" tabindex="-1"></a>Within a pipeline, the syntax is <span class="in">`rename(new_name = old_name)`</span>.</span>
<span id="cb52-172"><a href="#cb52-172" aria-hidden="true" tabindex="-1"></a>For example, we may want to rename the gdpPercap column name from our <span class="in">`select()`</span> statement above.</span>
<span id="cb52-173"><a href="#cb52-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-176"><a href="#cb52-176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-177"><a href="#cb52-177" aria-hidden="true" tabindex="-1"></a>tidy_gdp <span class="ot">&lt;-</span> year_country_gdp <span class="sc">%&gt;%</span> </span>
<span id="cb52-178"><a href="#cb52-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gdp_per_capita =</span> gdpPercap)  <span class="co"># rename a variable name or column name</span></span>
<span id="cb52-179"><a href="#cb52-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-180"><a href="#cb52-180" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tidy_gdp)  <span class="co"># see first few lines</span></span>
<span id="cb52-181"><a href="#cb52-181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-182"><a href="#cb52-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-183"><a href="#cb52-183" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb52-184"><a href="#cb52-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-185"><a href="#cb52-185" aria-hidden="true" tabindex="-1"></a><span class="fu">## Using filter()</span></span>
<span id="cb52-186"><a href="#cb52-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-187"><a href="#cb52-187" aria-hidden="true" tabindex="-1"></a>If we now want to move forward with the above, but only with European</span>
<span id="cb52-188"><a href="#cb52-188" aria-hidden="true" tabindex="-1"></a>countries, we can combine <span class="in">`select`</span> and <span class="in">`filter`</span></span>
<span id="cb52-189"><a href="#cb52-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-192"><a href="#cb52-192" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-193"><a href="#cb52-193" aria-hidden="true" tabindex="-1"></a>year_country_gdp_euro <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb52-194"><a href="#cb52-194" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">"Europe"</span>) <span class="sc">%&gt;%</span>  <span class="co"># keep observation (rows) that have Europe</span></span>
<span id="cb52-195"><a href="#cb52-195" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(year, country, gdpPercap)   <span class="co"># keep variables</span></span>
<span id="cb52-196"><a href="#cb52-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-197"><a href="#cb52-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-198"><a href="#cb52-198" aria-hidden="true" tabindex="-1"></a>If we now want to show life expectancy of European countries but only</span>
<span id="cb52-199"><a href="#cb52-199" aria-hidden="true" tabindex="-1"></a>for a specific year (e.g., 2007), we can do as below.</span>
<span id="cb52-200"><a href="#cb52-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-203"><a href="#cb52-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-204"><a href="#cb52-204" aria-hidden="true" tabindex="-1"></a>europe_lifeExp_2007 <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb52-205"><a href="#cb52-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">"Europe"</span>, year <span class="sc">==</span> <span class="dv">2007</span>) <span class="sc">%&gt;%</span> <span class="co"># now take observation that have Europe &amp; 2007</span></span>
<span id="cb52-206"><a href="#cb52-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, lifeExp)</span>
<span id="cb52-207"><a href="#cb52-207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-208"><a href="#cb52-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-209"><a href="#cb52-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-210"><a href="#cb52-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-211"><a href="#cb52-211" aria-hidden="true" tabindex="-1"></a><span class="fu">## Challenge 1</span></span>
<span id="cb52-212"><a href="#cb52-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-213"><a href="#cb52-213" aria-hidden="true" tabindex="-1"></a>Write a single command (which can span multiple lines and includes pipes) that</span>
<span id="cb52-214"><a href="#cb52-214" aria-hidden="true" tabindex="-1"></a>will produce a data frame that has the African values for <span class="in">`lifeExp`</span>, <span class="in">`country`</span></span>
<span id="cb52-215"><a href="#cb52-215" aria-hidden="true" tabindex="-1"></a>and <span class="in">`year`</span>, but not for other Continents.  How many rows does your data frame</span>
<span id="cb52-216"><a href="#cb52-216" aria-hidden="true" tabindex="-1"></a>have and why?</span>
<span id="cb52-217"><a href="#cb52-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-218"><a href="#cb52-218" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb52-219"><a href="#cb52-219" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Solution to challenge 1</span></span>
<span id="cb52-220"><a href="#cb52-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-223"><a href="#cb52-223" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-224"><a href="#cb52-224" aria-hidden="true" tabindex="-1"></a>year_country_lifeExp_Africa <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb52-225"><a href="#cb52-225" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">"Africa"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-226"><a href="#cb52-226" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">select</span>(year, country, lifeExp)</span>
<span id="cb52-227"><a href="#cb52-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-228"><a href="#cb52-228" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(year_country_lifeExp_Africa)</span>
<span id="cb52-229"><a href="#cb52-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-230"><a href="#cb52-230" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb52-231"><a href="#cb52-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-232"><a href="#cb52-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-233"><a href="#cb52-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-234"><a href="#cb52-234" aria-hidden="true" tabindex="-1"></a>As with last time, first we pass the gapminder data frame to the <span class="in">`filter()`</span></span>
<span id="cb52-235"><a href="#cb52-235" aria-hidden="true" tabindex="-1"></a>function, then we pass the filtered version of the gapminder data frame to the</span>
<span id="cb52-236"><a href="#cb52-236" aria-hidden="true" tabindex="-1"></a><span class="in">`select()`</span> function. **Note:** The order of operations is very important in this</span>
<span id="cb52-237"><a href="#cb52-237" aria-hidden="true" tabindex="-1"></a>case. If we used 'select' first, filter would not be able to find the variable</span>
<span id="cb52-238"><a href="#cb52-238" aria-hidden="true" tabindex="-1"></a>continent since we would have removed it in the previous step.</span>
<span id="cb52-239"><a href="#cb52-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-240"><a href="#cb52-240" aria-hidden="true" tabindex="-1"></a><span class="fu">## Using group_by()</span></span>
<span id="cb52-241"><a href="#cb52-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-242"><a href="#cb52-242" aria-hidden="true" tabindex="-1"></a>Now, we were supposed to be reducing the error prone repetitiveness of what can</span>
<span id="cb52-243"><a href="#cb52-243" aria-hidden="true" tabindex="-1"></a>be done with base R, but up to now we haven't done that since we would have to</span>
<span id="cb52-244"><a href="#cb52-244" aria-hidden="true" tabindex="-1"></a>repeat the above for each continent. Instead of <span class="in">`filter()`</span>, which will only pass</span>
<span id="cb52-245"><a href="#cb52-245" aria-hidden="true" tabindex="-1"></a>observations that meet your criteria (in the above: <span class="in">`continent=="Europe"`</span>), we</span>
<span id="cb52-246"><a href="#cb52-246" aria-hidden="true" tabindex="-1"></a>can use <span class="in">`group_by()`</span>, which will essentially use every unique criteria that you</span>
<span id="cb52-247"><a href="#cb52-247" aria-hidden="true" tabindex="-1"></a>could have used in filter.</span>
<span id="cb52-248"><a href="#cb52-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-251"><a href="#cb52-251" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-252"><a href="#cb52-252" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gapminder)</span>
<span id="cb52-253"><a href="#cb52-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-254"><a href="#cb52-254" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gapminder <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(continent))</span>
<span id="cb52-255"><a href="#cb52-255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-256"><a href="#cb52-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-257"><a href="#cb52-257" aria-hidden="true" tabindex="-1"></a>You will notice that the structure of the data frame where we used <span class="in">`group_by()`</span></span>
<span id="cb52-258"><a href="#cb52-258" aria-hidden="true" tabindex="-1"></a>(<span class="in">`grouped_df`</span>) is not the same as the original <span class="in">`gapminder`</span> (<span class="in">`data.frame`</span>). A</span>
<span id="cb52-259"><a href="#cb52-259" aria-hidden="true" tabindex="-1"></a><span class="in">`grouped_df`</span> can be thought of as a <span class="in">`list`</span> where each item in the <span class="in">`list`</span>is a</span>
<span id="cb52-260"><a href="#cb52-260" aria-hidden="true" tabindex="-1"></a><span class="in">`data.frame`</span> which contains only the rows that correspond to the a particular</span>
<span id="cb52-261"><a href="#cb52-261" aria-hidden="true" tabindex="-1"></a>value <span class="in">`continent`</span> (at least in the example above).</span>
<span id="cb52-262"><a href="#cb52-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-263"><a href="#cb52-263" aria-hidden="true" tabindex="-1"></a><span class="al">![](fig/13-dplyr-fig2.png)</span>{alt='Diagram illustrating how the group by function oraganizes a data frame into groups'}</span>
<span id="cb52-264"><a href="#cb52-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-265"><a href="#cb52-265" aria-hidden="true" tabindex="-1"></a><span class="fu">## Using summarize()</span></span>
<span id="cb52-266"><a href="#cb52-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-267"><a href="#cb52-267" aria-hidden="true" tabindex="-1"></a>The above was a bit on the uneventful side but <span class="in">`group_by()`</span> is much more</span>
<span id="cb52-268"><a href="#cb52-268" aria-hidden="true" tabindex="-1"></a>exciting in conjunction with <span class="in">`summarize()`</span>. This will allow us to create new</span>
<span id="cb52-269"><a href="#cb52-269" aria-hidden="true" tabindex="-1"></a>variable(s) by using functions that repeat for each of the continent-specific</span>
<span id="cb52-270"><a href="#cb52-270" aria-hidden="true" tabindex="-1"></a>data frames. That is to say, using the <span class="in">`group_by()`</span> function, we split our</span>
<span id="cb52-271"><a href="#cb52-271" aria-hidden="true" tabindex="-1"></a>original data frame into multiple pieces, then we can run functions</span>
<span id="cb52-272"><a href="#cb52-272" aria-hidden="true" tabindex="-1"></a>(e.g. <span class="in">`mean()`</span> or <span class="in">`sd()`</span>) within <span class="in">`summarize()`</span>.</span>
<span id="cb52-273"><a href="#cb52-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-276"><a href="#cb52-276" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-277"><a href="#cb52-277" aria-hidden="true" tabindex="-1"></a>gdp_bycontinents <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb52-278"><a href="#cb52-278" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span></span>
<span id="cb52-279"><a href="#cb52-279" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap))</span>
<span id="cb52-280"><a href="#cb52-280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-281"><a href="#cb52-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-282"><a href="#cb52-282" aria-hidden="true" tabindex="-1"></a><span class="al">![](fig/13-dplyr-fig3.png)</span>{alt='Diagram illustrating the use of group by and summarize together to create a new variable'}</span>
<span id="cb52-283"><a href="#cb52-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-284"><a href="#cb52-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb52-285"><a href="#cb52-285" aria-hidden="true" tabindex="-1"></a><span class="in">continent mean_gdpPercap</span></span>
<span id="cb52-286"><a href="#cb52-286" aria-hidden="true" tabindex="-1"></a><span class="in">     &lt;fctr&gt;          &lt;dbl&gt;</span></span>
<span id="cb52-287"><a href="#cb52-287" aria-hidden="true" tabindex="-1"></a><span class="in">1    Africa       2193.755</span></span>
<span id="cb52-288"><a href="#cb52-288" aria-hidden="true" tabindex="-1"></a><span class="in">2  Americas       7136.110</span></span>
<span id="cb52-289"><a href="#cb52-289" aria-hidden="true" tabindex="-1"></a><span class="in">3      Asia       7902.150</span></span>
<span id="cb52-290"><a href="#cb52-290" aria-hidden="true" tabindex="-1"></a><span class="in">4    Europe      14469.476</span></span>
<span id="cb52-291"><a href="#cb52-291" aria-hidden="true" tabindex="-1"></a><span class="in">5   Oceania      18621.609</span></span>
<span id="cb52-292"><a href="#cb52-292" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-293"><a href="#cb52-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-294"><a href="#cb52-294" aria-hidden="true" tabindex="-1"></a>That allowed us to calculate the mean gdpPercap for each continent, but it gets</span>
<span id="cb52-295"><a href="#cb52-295" aria-hidden="true" tabindex="-1"></a>even better.</span>
<span id="cb52-296"><a href="#cb52-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-297"><a href="#cb52-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-298"><a href="#cb52-298" aria-hidden="true" tabindex="-1"></a><span class="fu">## Challenge 2</span></span>
<span id="cb52-299"><a href="#cb52-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-300"><a href="#cb52-300" aria-hidden="true" tabindex="-1"></a>Calculate the average life expectancy per country. Which has the longest average life</span>
<span id="cb52-301"><a href="#cb52-301" aria-hidden="true" tabindex="-1"></a>expectancy and which has the shortest average life expectancy?</span>
<span id="cb52-302"><a href="#cb52-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-303"><a href="#cb52-303" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb52-304"><a href="#cb52-304" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Solution to challenge 2</span></span>
<span id="cb52-305"><a href="#cb52-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-308"><a href="#cb52-308" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-309"><a href="#cb52-309" aria-hidden="true" tabindex="-1"></a>lifeExp_bycountry <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb52-310"><a href="#cb52-310" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span>                                       <span class="co"># group countrywise contrywise</span></span>
<span id="cb52-311"><a href="#cb52-311" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="at">mean_lifeExp =</span> <span class="fu">mean</span>(lifeExp))                     <span class="co"># calculate average</span></span>
<span id="cb52-312"><a href="#cb52-312" aria-hidden="true" tabindex="-1"></a>lifeExp_bycountry <span class="sc">%&gt;%</span></span>
<span id="cb52-313"><a href="#cb52-313" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(mean_lifeExp <span class="sc">==</span> <span class="fu">min</span>(mean_lifeExp) <span class="sc">|</span> mean_lifeExp <span class="sc">==</span> <span class="fu">max</span>(mean_lifeExp))</span>
<span id="cb52-314"><a href="#cb52-314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-315"><a href="#cb52-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-316"><a href="#cb52-316" aria-hidden="true" tabindex="-1"></a>Another way to do this is to use the <span class="in">`dplyr`</span> function <span class="in">`arrange()`</span>, which</span>
<span id="cb52-317"><a href="#cb52-317" aria-hidden="true" tabindex="-1"></a>arranges the rows in a data frame according to the order of one or more</span>
<span id="cb52-318"><a href="#cb52-318" aria-hidden="true" tabindex="-1"></a>variables from the data frame.  It has similar syntax to other functions from</span>
<span id="cb52-319"><a href="#cb52-319" aria-hidden="true" tabindex="-1"></a>the <span class="in">`dplyr`</span> package. You can use <span class="in">`desc()`</span> inside <span class="in">`arrange()`</span> to sort in</span>
<span id="cb52-320"><a href="#cb52-320" aria-hidden="true" tabindex="-1"></a>descending order.</span>
<span id="cb52-321"><a href="#cb52-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-324"><a href="#cb52-324" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-325"><a href="#cb52-325" aria-hidden="true" tabindex="-1"></a>lifeExp_bycountry <span class="sc">%&gt;%</span></span>
<span id="cb52-326"><a href="#cb52-326" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(mean_lifeExp) <span class="sc">%&gt;%</span>        <span class="co"># sort</span></span>
<span id="cb52-327"><a href="#cb52-327" aria-hidden="true" tabindex="-1"></a>   <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb52-328"><a href="#cb52-328" aria-hidden="true" tabindex="-1"></a>lifeExp_bycountry <span class="sc">%&gt;%</span></span>
<span id="cb52-329"><a href="#cb52-329" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_lifeExp)) <span class="sc">%&gt;%</span>  <span class="co"># arrange in decentralizing jon</span></span>
<span id="cb52-330"><a href="#cb52-330" aria-hidden="true" tabindex="-1"></a>   <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb52-331"><a href="#cb52-331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-332"><a href="#cb52-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-333"><a href="#cb52-333" aria-hidden="true" tabindex="-1"></a>Alphabetical order works too</span>
<span id="cb52-334"><a href="#cb52-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-337"><a href="#cb52-337" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-338"><a href="#cb52-338" aria-hidden="true" tabindex="-1"></a>lifeExp_bycountry <span class="sc">%&gt;%</span></span>
<span id="cb52-339"><a href="#cb52-339" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(<span class="fu">desc</span>(country)) <span class="sc">%&gt;%</span></span>
<span id="cb52-340"><a href="#cb52-340" aria-hidden="true" tabindex="-1"></a>   <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb52-341"><a href="#cb52-341" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-342"><a href="#cb52-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-343"><a href="#cb52-343" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb52-344"><a href="#cb52-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-345"><a href="#cb52-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-346"><a href="#cb52-346" aria-hidden="true" tabindex="-1"></a>The function <span class="in">`group_by()`</span> allows us to group by multiple variables. Let's group by <span class="in">`year`</span> and <span class="in">`continent`</span>.</span>
<span id="cb52-347"><a href="#cb52-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-350"><a href="#cb52-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-351"><a href="#cb52-351" aria-hidden="true" tabindex="-1"></a>gdp_bycontinents_byyear <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb52-352"><a href="#cb52-352" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent, year) <span class="sc">%&gt;%</span></span>
<span id="cb52-353"><a href="#cb52-353" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap))</span>
<span id="cb52-354"><a href="#cb52-354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-355"><a href="#cb52-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-356"><a href="#cb52-356" aria-hidden="true" tabindex="-1"></a>That is already quite powerful, but it gets even better! You're not limited to defining 1 new variable in <span class="in">`summarize()`</span>.</span>
<span id="cb52-357"><a href="#cb52-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-360"><a href="#cb52-360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-361"><a href="#cb52-361" aria-hidden="true" tabindex="-1"></a>gdp_pop_bycontinents_byyear <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb52-362"><a href="#cb52-362" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent, year) <span class="sc">%&gt;%</span></span>
<span id="cb52-363"><a href="#cb52-363" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap),</span>
<span id="cb52-364"><a href="#cb52-364" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_gdpPercap =</span> <span class="fu">sd</span>(gdpPercap),     <span class="co"># calculate standard deviation</span></span>
<span id="cb52-365"><a href="#cb52-365" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_pop =</span> <span class="fu">mean</span>(pop),             <span class="co"># calculate average</span></span>
<span id="cb52-366"><a href="#cb52-366" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_pop =</span> <span class="fu">sd</span>(pop))</span>
<span id="cb52-367"><a href="#cb52-367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-368"><a href="#cb52-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-369"><a href="#cb52-369" aria-hidden="true" tabindex="-1"></a><span class="fu">## count() and n()</span></span>
<span id="cb52-370"><a href="#cb52-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-371"><a href="#cb52-371" aria-hidden="true" tabindex="-1"></a>A very common operation is to count the number of observations for each</span>
<span id="cb52-372"><a href="#cb52-372" aria-hidden="true" tabindex="-1"></a>group. The <span class="in">`dplyr`</span> package comes with two related functions that help with this.</span>
<span id="cb52-373"><a href="#cb52-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-374"><a href="#cb52-374" aria-hidden="true" tabindex="-1"></a>For instance, if we wanted to check the number of countries included in the</span>
<span id="cb52-375"><a href="#cb52-375" aria-hidden="true" tabindex="-1"></a>dataset for the year 2002, we can use the <span class="in">`count()`</span> function. It takes the name</span>
<span id="cb52-376"><a href="#cb52-376" aria-hidden="true" tabindex="-1"></a>of one or more columns that contain the groups we are interested in, and we can</span>
<span id="cb52-377"><a href="#cb52-377" aria-hidden="true" tabindex="-1"></a>optionally sort the results in descending order by adding <span class="in">`sort=TRUE`</span>:</span>
<span id="cb52-378"><a href="#cb52-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-381"><a href="#cb52-381" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-382"><a href="#cb52-382" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb52-383"><a href="#cb52-383" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2002</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-384"><a href="#cb52-384" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(continent, <span class="at">sort =</span> <span class="cn">TRUE</span>)    <span class="co"># do counting</span></span>
<span id="cb52-385"><a href="#cb52-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-386"><a href="#cb52-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-387"><a href="#cb52-387" aria-hidden="true" tabindex="-1"></a>If we need to use the number of observations in calculations, the <span class="in">`n()`</span> function</span>
<span id="cb52-388"><a href="#cb52-388" aria-hidden="true" tabindex="-1"></a>is useful. It will return the total number of observations in the current group rather than counting the number of observations in each group within a specific column. For instance, if we wanted to get the standard error of the life expectency per continent:</span>
<span id="cb52-389"><a href="#cb52-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-392"><a href="#cb52-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-393"><a href="#cb52-393" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb52-394"><a href="#cb52-394" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span></span>
<span id="cb52-395"><a href="#cb52-395" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">se_le =</span> <span class="fu">sd</span>(lifeExp)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">n</span>()))   <span class="co"># calculaate standard error</span></span>
<span id="cb52-396"><a href="#cb52-396" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-397"><a href="#cb52-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-398"><a href="#cb52-398" aria-hidden="true" tabindex="-1"></a>You can also chain together several summary operations; in this case calculating the <span class="in">`minimum`</span>, <span class="in">`maximum`</span>, <span class="in">`mean`</span> and <span class="in">`se`</span> of each continent's per-country life-expectancy:</span>
<span id="cb52-399"><a href="#cb52-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-402"><a href="#cb52-402" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-403"><a href="#cb52-403" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb52-404"><a href="#cb52-404" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span></span>
<span id="cb52-405"><a href="#cb52-405" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb52-406"><a href="#cb52-406" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_le =</span> <span class="fu">mean</span>(lifeExp),</span>
<span id="cb52-407"><a href="#cb52-407" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_le =</span> <span class="fu">min</span>(lifeExp),</span>
<span id="cb52-408"><a href="#cb52-408" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_le =</span> <span class="fu">max</span>(lifeExp),</span>
<span id="cb52-409"><a href="#cb52-409" aria-hidden="true" tabindex="-1"></a>      <span class="at">se_le =</span> <span class="fu">sd</span>(lifeExp)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">n</span>()))</span>
<span id="cb52-410"><a href="#cb52-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-411"><a href="#cb52-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-412"><a href="#cb52-412" aria-hidden="true" tabindex="-1"></a><span class="fu">## Using mutate()</span></span>
<span id="cb52-413"><a href="#cb52-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-414"><a href="#cb52-414" aria-hidden="true" tabindex="-1"></a>We can also create new variables prior to (or even after) summarizing information using <span class="in">`mutate()`</span>.</span>
<span id="cb52-415"><a href="#cb52-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-418"><a href="#cb52-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-419"><a href="#cb52-419" aria-hidden="true" tabindex="-1"></a>gdp_pop_bycontinents_byyear <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb52-420"><a href="#cb52-420" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">gdp_billion =</span> gdpPercap<span class="sc">*</span>pop<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-421"><a href="#cb52-421" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent,year) <span class="sc">%&gt;%</span></span>
<span id="cb52-422"><a href="#cb52-422" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap),</span>
<span id="cb52-423"><a href="#cb52-423" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_gdpPercap =</span> <span class="fu">sd</span>(gdpPercap),</span>
<span id="cb52-424"><a href="#cb52-424" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_pop =</span> <span class="fu">mean</span>(pop),</span>
<span id="cb52-425"><a href="#cb52-425" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_pop =</span> <span class="fu">sd</span>(pop),</span>
<span id="cb52-426"><a href="#cb52-426" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_gdp_billion =</span> <span class="fu">mean</span>(gdp_billion),</span>
<span id="cb52-427"><a href="#cb52-427" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_gdp_billion =</span> <span class="fu">sd</span>(gdp_billion))</span>
<span id="cb52-428"><a href="#cb52-428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-429"><a href="#cb52-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-430"><a href="#cb52-430" aria-hidden="true" tabindex="-1"></a><span class="fu">## Connect mutate with logical filtering: ifelse</span></span>
<span id="cb52-431"><a href="#cb52-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-432"><a href="#cb52-432" aria-hidden="true" tabindex="-1"></a>When creating new variables, we can hook this with a logical condition. A simple combination of</span>
<span id="cb52-433"><a href="#cb52-433" aria-hidden="true" tabindex="-1"></a><span class="in">`mutate()`</span> and <span class="in">`ifelse()`</span> facilitates filtering right where it is needed: in the moment of creating something new.</span>
<span id="cb52-434"><a href="#cb52-434" aria-hidden="true" tabindex="-1"></a>This easy-to-read statement is a fast and powerful way of discarding certain data (even though the overall dimension</span>
<span id="cb52-435"><a href="#cb52-435" aria-hidden="true" tabindex="-1"></a>of the data frame will not change) or for updating values depending on this given condition.</span>
<span id="cb52-436"><a href="#cb52-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-439"><a href="#cb52-439" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-440"><a href="#cb52-440" aria-hidden="true" tabindex="-1"></a><span class="do">## keeping all data but "filtering" after a certain condition</span></span>
<span id="cb52-441"><a href="#cb52-441" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate GDP only for people with a life expectation above 25</span></span>
<span id="cb52-442"><a href="#cb52-442" aria-hidden="true" tabindex="-1"></a>gdp_pop_bycontinents_byyear_above25 <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb52-443"><a href="#cb52-443" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">gdp_billion =</span> <span class="fu">ifelse</span>(lifeExp <span class="sc">&gt;</span> <span class="dv">25</span>,                    <span class="co"># life expectation above 25</span></span>
<span id="cb52-444"><a href="#cb52-444" aria-hidden="true" tabindex="-1"></a>                                gdpPercap <span class="sc">*</span> pop <span class="sc">/</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">9</span>, <span class="cn">NA</span>)) <span class="sc">%&gt;%</span> <span class="co">#  GDP (in billions)</span></span>
<span id="cb52-445"><a href="#cb52-445" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent, year) <span class="sc">%&gt;%</span></span>
<span id="cb52-446"><a href="#cb52-446" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap),</span>
<span id="cb52-447"><a href="#cb52-447" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_gdpPercap =</span> <span class="fu">sd</span>(gdpPercap),</span>
<span id="cb52-448"><a href="#cb52-448" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_pop =</span> <span class="fu">mean</span>(pop),</span>
<span id="cb52-449"><a href="#cb52-449" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_pop =</span> <span class="fu">sd</span>(pop),</span>
<span id="cb52-450"><a href="#cb52-450" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_gdp_billion =</span> <span class="fu">mean</span>(gdp_billion),</span>
<span id="cb52-451"><a href="#cb52-451" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_gdp_billion =</span> <span class="fu">sd</span>(gdp_billion))</span>
<span id="cb52-452"><a href="#cb52-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-453"><a href="#cb52-453" aria-hidden="true" tabindex="-1"></a><span class="do">## updating only if certain condition is fullfilled</span></span>
<span id="cb52-454"><a href="#cb52-454" aria-hidden="true" tabindex="-1"></a><span class="co"># for life expectations above 40 years, the gpd to be expected in the future is scaled</span></span>
<span id="cb52-455"><a href="#cb52-455" aria-hidden="true" tabindex="-1"></a>gdp_future_bycontinents_byyear_high_lifeExp <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb52-456"><a href="#cb52-456" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">gdp_futureExpectation =</span> <span class="fu">ifelse</span>(lifeExp <span class="sc">&gt;</span> <span class="dv">40</span>, </span>
<span id="cb52-457"><a href="#cb52-457" aria-hidden="true" tabindex="-1"></a>                                          gdpPercap <span class="sc">*</span> <span class="fl">1.5</span>, </span>
<span id="cb52-458"><a href="#cb52-458" aria-hidden="true" tabindex="-1"></a>                                          gdpPercap)) <span class="sc">%&gt;%</span></span>
<span id="cb52-459"><a href="#cb52-459" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(continent, year) <span class="sc">%&gt;%</span></span>
<span id="cb52-460"><a href="#cb52-460" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean_gdpPercap =</span> <span class="fu">mean</span>(gdpPercap),</span>
<span id="cb52-461"><a href="#cb52-461" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_gdpPercap_expected =</span> <span class="fu">mean</span>(gdp_futureExpectation))</span>
<span id="cb52-462"><a href="#cb52-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-463"><a href="#cb52-463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-464"><a href="#cb52-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-465"><a href="#cb52-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-466"><a href="#cb52-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-467"><a href="#cb52-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-468"><a href="#cb52-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-469"><a href="#cb52-469" aria-hidden="true" tabindex="-1"></a><span class="fu">## Combining `dplyr` and `ggplot2`</span></span>
<span id="cb52-470"><a href="#cb52-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-471"><a href="#cb52-471" aria-hidden="true" tabindex="-1"></a>First install and load ggplot2:</span>
<span id="cb52-472"><a href="#cb52-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-473"><a href="#cb52-473" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb52-474"><a href="#cb52-474" aria-hidden="true" tabindex="-1"></a><span class="in">install.packages('ggplot2')</span></span>
<span id="cb52-475"><a href="#cb52-475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-476"><a href="#cb52-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-477"><a href="#cb52-477" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb52-478"><a href="#cb52-478" aria-hidden="true" tabindex="-1"></a><span class="in">library("ggplot2")</span></span>
<span id="cb52-479"><a href="#cb52-479" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-480"><a href="#cb52-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-481"><a href="#cb52-481" aria-hidden="true" tabindex="-1"></a>Let's plot the variables from the last data you generated</span>
<span id="cb52-484"><a href="#cb52-484" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-485"><a href="#cb52-485" aria-hidden="true" tabindex="-1"></a>gdp_future_bycontinents_byyear_high_lifeExp <span class="sc">%&gt;%</span> </span>
<span id="cb52-486"><a href="#cb52-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> mean_gdpPercap, <span class="at">group =</span> continent, <span class="at">colour =</span> continent)) <span class="sc">+</span> </span>
<span id="cb52-487"><a href="#cb52-487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() </span>
<span id="cb52-488"><a href="#cb52-488" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-489"><a href="#cb52-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-490"><a href="#cb52-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-491"><a href="#cb52-491" aria-hidden="true" tabindex="-1"></a>In the plotting lesson we looked at how to make a multi-panel figure by adding</span>
<span id="cb52-492"><a href="#cb52-492" aria-hidden="true" tabindex="-1"></a>a layer of facet panels using <span class="in">`ggplot2`</span>. Here is the code we used (with some</span>
<span id="cb52-493"><a href="#cb52-493" aria-hidden="true" tabindex="-1"></a>extra comments):</span>
<span id="cb52-494"><a href="#cb52-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-497"><a href="#cb52-497" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-498"><a href="#cb52-498" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter countries located in the Americas</span></span>
<span id="cb52-499"><a href="#cb52-499" aria-hidden="true" tabindex="-1"></a>americas <span class="ot">&lt;-</span> gapminder[gapminder<span class="sc">$</span>continent <span class="sc">==</span> <span class="st">"Americas"</span>, ]</span>
<span id="cb52-500"><a href="#cb52-500" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the plot</span></span>
<span id="cb52-501"><a href="#cb52-501" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> americas, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> lifeExp)) <span class="sc">+</span></span>
<span id="cb52-502"><a href="#cb52-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb52-503"><a href="#cb52-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> country) <span class="sc">+</span></span>
<span id="cb52-504"><a href="#cb52-504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span>
<span id="cb52-505"><a href="#cb52-505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-506"><a href="#cb52-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-507"><a href="#cb52-507" aria-hidden="true" tabindex="-1"></a>This code makes the right plot but it also creates an intermediate variable</span>
<span id="cb52-508"><a href="#cb52-508" aria-hidden="true" tabindex="-1"></a>(<span class="in">`americas`</span>) that we might not have any other uses for. Just as we used</span>
<span id="cb52-509"><a href="#cb52-509" aria-hidden="true" tabindex="-1"></a><span class="in">`%&gt;%`</span> to pipe data along a chain of <span class="in">`dplyr`</span> functions we can use it to pass data</span>
<span id="cb52-510"><a href="#cb52-510" aria-hidden="true" tabindex="-1"></a>to <span class="in">`ggplot()`</span>. Because <span class="in">`%&gt;%`</span> replaces the first argument in a function we don't</span>
<span id="cb52-511"><a href="#cb52-511" aria-hidden="true" tabindex="-1"></a>need to specify the <span class="in">`data =`</span> argument in the <span class="in">`ggplot()`</span> function. By combining</span>
<span id="cb52-512"><a href="#cb52-512" aria-hidden="true" tabindex="-1"></a><span class="in">`dplyr`</span> and <span class="in">`ggplot2`</span> functions we can make the same figure without creating any</span>
<span id="cb52-513"><a href="#cb52-513" aria-hidden="true" tabindex="-1"></a>new variables or modifying the data.</span>
<span id="cb52-514"><a href="#cb52-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-517"><a href="#cb52-517" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-518"><a href="#cb52-518" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb52-519"><a href="#cb52-519" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter countries located in the Americas</span></span>
<span id="cb52-520"><a href="#cb52-520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">"Americas"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-521"><a href="#cb52-521" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make the plot</span></span>
<span id="cb52-522"><a href="#cb52-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> lifeExp)) <span class="sc">+</span> <span class="co"># set x and y</span></span>
<span id="cb52-523"><a href="#cb52-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span>                                  <span class="co"># line plot</span></span>
<span id="cb52-524"><a href="#cb52-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> country) <span class="sc">+</span>                       <span class="co"># split the plot by country</span></span>
<span id="cb52-525"><a href="#cb52-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))  <span class="co"># x axis labels at 45 degree angle</span></span>
<span id="cb52-526"><a href="#cb52-526" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-527"><a href="#cb52-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-528"><a href="#cb52-528" aria-hidden="true" tabindex="-1"></a>More examples of using the function <span class="in">`mutate()`</span> and the <span class="in">`ggplot2`</span> package.</span>
<span id="cb52-529"><a href="#cb52-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-532"><a href="#cb52-532" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-533"><a href="#cb52-533" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb52-534"><a href="#cb52-534" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract first letter of country name into new column</span></span>
<span id="cb52-535"><a href="#cb52-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">startsWith =</span> <span class="fu">substr</span>(country, <span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb52-536"><a href="#cb52-536" aria-hidden="true" tabindex="-1"></a>  <span class="co"># only keep countries starting with A or Z</span></span>
<span id="cb52-537"><a href="#cb52-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(startsWith <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"Z"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb52-538"><a href="#cb52-538" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot lifeExp into facets</span></span>
<span id="cb52-539"><a href="#cb52-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> lifeExp, <span class="at">colour =</span> continent)) <span class="sc">+</span>  <span class="co"># x and y and set color</span></span>
<span id="cb52-540"><a href="#cb52-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span>                                             <span class="co"># line plot</span></span>
<span id="cb52-541"><a href="#cb52-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(country)) <span class="sc">+</span>                               <span class="co"># faceting variables </span></span>
<span id="cb52-542"><a href="#cb52-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()                                           <span class="co"># set theme</span></span>
<span id="cb52-543"><a href="#cb52-543" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-544"><a href="#cb52-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-545"><a href="#cb52-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-546"><a href="#cb52-546" aria-hidden="true" tabindex="-1"></a><span class="fu">## Advanced Challenge</span></span>
<span id="cb52-547"><a href="#cb52-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-548"><a href="#cb52-548" aria-hidden="true" tabindex="-1"></a>Calculate the average life expectancy in 2002 of 2 randomly selected countries</span>
<span id="cb52-549"><a href="#cb52-549" aria-hidden="true" tabindex="-1"></a>for each continent. Then arrange the continent names in reverse order.</span>
<span id="cb52-550"><a href="#cb52-550" aria-hidden="true" tabindex="-1"></a>**Hint:** Use the <span class="in">`dplyr`</span> functions <span class="in">`arrange()`</span> and <span class="in">`sample_n()`</span>, they have</span>
<span id="cb52-551"><a href="#cb52-551" aria-hidden="true" tabindex="-1"></a>similar syntax to other dplyr functions.</span>
<span id="cb52-552"><a href="#cb52-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-553"><a href="#cb52-553" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb52-554"><a href="#cb52-554" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Solution to Advanced Challenge</span></span>
<span id="cb52-555"><a href="#cb52-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-558"><a href="#cb52-558" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-559"><a href="#cb52-559" aria-hidden="true" tabindex="-1"></a>lifeExp_2countries_bycontinents <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span>  <span class="co"># take the data </span></span>
<span id="cb52-560"><a href="#cb52-560" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(year<span class="sc">==</span><span class="dv">2002</span>) <span class="sc">%&gt;%</span>                         <span class="co"># keep rows that has year 2002</span></span>
<span id="cb52-561"><a href="#cb52-561" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(continent) <span class="sc">%&gt;%</span>                        <span class="co"># regroup by continent</span></span>
<span id="cb52-562"><a href="#cb52-562" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sample_n</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span>                                <span class="co"># take 2 random continent</span></span>
<span id="cb52-563"><a href="#cb52-563" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="at">mean_lifeExp=</span><span class="fu">mean</span>(lifeExp)) <span class="sc">%&gt;%</span>      <span class="co"># calculate mean life expectancy</span></span>
<span id="cb52-564"><a href="#cb52-564" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_lifeExp))                    <span class="co"># sort in reverse order</span></span>
<span id="cb52-565"><a href="#cb52-565" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-566"><a href="#cb52-566" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb52-567"><a href="#cb52-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-568"><a href="#cb52-568" aria-hidden="true" tabindex="-1"></a><span class="fu">### extras</span></span>
<span id="cb52-571"><a href="#cb52-571" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-572"><a href="#cb52-572" aria-hidden="true" tabindex="-1"></a>lifeExp_2countries_bycontinents <span class="sc">%&gt;%</span>        <span class="co"># data</span></span>
<span id="cb52-573"><a href="#cb52-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(continent,mean_lifeExp)) <span class="sc">+</span>    <span class="co"># x and y axis</span></span>
<span id="cb52-574"><a href="#cb52-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()                             <span class="co"># scattered plot</span></span>
<span id="cb52-575"><a href="#cb52-575" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-576"><a href="#cb52-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-577"><a href="#cb52-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-578"><a href="#cb52-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-579"><a href="#cb52-579" aria-hidden="true" tabindex="-1"></a><span class="fu">## Other great resources</span></span>
<span id="cb52-580"><a href="#cb52-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-581"><a href="#cb52-581" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">R for Data Science</span><span class="co">](https://r4ds.hadley.nz/)</span> (online book)</span>
<span id="cb52-582"><a href="#cb52-582" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Data Wrangling Cheat sheet</span><span class="co">](https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf)</span> (pdf file)</span>
<span id="cb52-583"><a href="#cb52-583" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Introduction to dplyr</span><span class="co">](https://dplyr.tidyverse.org/)</span> (online documentation)</span>
<span id="cb52-584"><a href="#cb52-584" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Data wrangling with R and RStudio</span><span class="co">](https://www.rstudio.com/resources/webinars/data-wrangling-with-r-and-rstudio/)</span> (online video)</span>
<span id="cb52-585"><a href="#cb52-585" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Tidyverse Skills for Data Science</span><span class="co">](https://jhudatascience.org/tidyversecourse/)</span> (online book)</span>
<span id="cb52-586"><a href="#cb52-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-587"><a href="#cb52-587" aria-hidden="true" tabindex="-1"></a><span class="fu">## keypoints</span></span>
<span id="cb52-588"><a href="#cb52-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-589"><a href="#cb52-589" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use the <span class="in">`dplyr`</span> package to manipulate data frames.</span>
<span id="cb52-590"><a href="#cb52-590" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`select()`</span> to choose variables from a data frame.</span>
<span id="cb52-591"><a href="#cb52-591" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`filter()`</span> to choose data based on values.</span>
<span id="cb52-592"><a href="#cb52-592" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`group_by()`</span> and <span class="in">`summarize()`</span> to work with subsets of data.</span>
<span id="cb52-593"><a href="#cb52-593" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`mutate()`</span> to create new variables.</span>
<span id="cb52-594"><a href="#cb52-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-595"><a href="#cb52-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-596"><a href="#cb52-596" aria-hidden="true" tabindex="-1"></a><span class="fu">#### R Session info</span></span>
<span id="cb52-599"><a href="#cb52-599" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb52-600"><a href="#cb52-600" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb52-601"><a href="#cb52-601" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb52-602"><a href="#cb52-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-603"><a href="#cb52-603" aria-hidden="true" tabindex="-1"></a>############## END</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>
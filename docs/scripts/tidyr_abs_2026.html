<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Frame Manipulation with tidyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href=".././scripts/00_precourse.html"> 
<span class="menu-text">Pre-course</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lectures" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lectures</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lectures">    
        <li>
    <a class="dropdown-item" href=".././slides/slides_tidyr.pdf">
 <span class="dropdown-text">tidyr lecture</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href=".././slides/slides_dplyr.pdf">
 <span class="dropdown-text">dplyr lecture</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href=".././slides/ggplot_gsvms_2026.html">
 <span class="dropdown-text">ggplot2 lecture</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lab-exercises" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lab exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lab-exercises">    
        <li>
    <a class="dropdown-item" href=".././scripts/tidyr_abs_2026.html">
 <span class="dropdown-text">tidyr practical</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href=".././scripts/dplyr_abs_2026.html">
 <span class="dropdown-text">dplyr practical</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href=".././practicals/ggplot2_lab_part1.html">
 <span class="dropdown-text">ggplot2 lab</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://swcarpentry.github.io/shell-novice/"> <i class="bi bi-softwerecarpentry" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:abu.siddique@slu.se"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Data Frame Manipulation with tidyr</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started">Getting started</a></li>
  <li><a href="#the-tidyr-package" id="toc-the-tidyr-package" class="nav-link" data-scroll-target="#the-tidyr-package">The <code>tidyr</code> package</a></li>
  <li><a href="#challenge-1" id="toc-challenge-1" class="nav-link" data-scroll-target="#challenge-1">Challenge 1</a></li>
  <li><a href="#from-wide-to-long-format-with-pivot_longer" id="toc-from-wide-to-long-format-with-pivot_longer" class="nav-link" data-scroll-target="#from-wide-to-long-format-with-pivot_longer">From wide to long format with <code>pivot_longer()</code></a></li>
  <li><a href="#split-the-variable-into-many-with-seperate" id="toc-split-the-variable-into-many-with-seperate" class="nav-link" data-scroll-target="#split-the-variable-into-many-with-seperate">Split the variable into many with <code>seperate()</code></a></li>
  <li><a href="#from-long-to-intermediate-format-with-pivot_wider" id="toc-from-long-to-intermediate-format-with-pivot_wider" class="nav-link" data-scroll-target="#from-long-to-intermediate-format-with-pivot_wider">From long to intermediate format with <code>pivot_wider()</code></a></li>
  <li><a href="#join-the-variables-into-one-with-unite" id="toc-join-the-variables-into-one-with-unite" class="nav-link" data-scroll-target="#join-the-variables-into-one-with-unite">Join the variables into one with <code>unite()</code></a></li>
  <li><a href="#challenge-2" id="toc-challenge-2" class="nav-link" data-scroll-target="#challenge-2">Challenge 2</a></li>
  <li><a href="#other-great-resources" id="toc-other-great-resources" class="nav-link" data-scroll-target="#other-great-resources">Other great resources</a></li>
  <li><a href="#keypoints" id="toc-keypoints" class="nav-link" data-scroll-target="#keypoints">Keypoints</a>
  <ul class="collapse">
  <li><a href="#r-session-info" id="toc-r-session-info" class="nav-link" data-scroll-target="#r-session-info">R Session info</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Exercise time: 45 minutes</p>
<section id="overview" class="level1">
<h1>Overview</h1>
<p><strong>Questions</strong></p>
<ul>
<li>How can I change the layout of a data frame?</li>
</ul>
<p><strong>Objectives</strong></p>
<ul>
<li>To understand the concepts of <em>longer</em> and <em>wider</em> data frame formats and be able to convert between them with <code>tidyr</code>.</li>
</ul>
<hr>
<p>Researchers often want to <strong>reshape their data frames</strong> from ‘wide’ to ‘longer’ layouts, or vice-versa. The ‘long’ layout or format is where:</p>
<ul>
<li>each column is a variable</li>
<li>each row is an observation</li>
</ul>
<p>In the purely ‘long’ (or ‘longest’) format, you usually have 1 column for the observed variable and the other columns are ID variables.</p>
<p>For the ‘wide’ format each row is often a site/subject/patient and you have multiple observation variables containing the same type of data. These can be either repeated observations over time, or observation of multiple variables (or a mix of both). You may find data input may be simpler or some other applications may prefer the ‘wide’ format.</p>
<blockquote class="blockquote">
<p>However, many of <code>R</code>‘s functions have been designed assuming you have ’longer’ formatted data.</p>
</blockquote>
<p>This tutorial will help you efficiently transform your data shape regardless of original format.</p>
<p><img src="fig/14-tidyr-fig1.png" class="img-fluid" alt="Diagram illustrating the difference between a wide versus long layout of a data frame"></p>
<p>Long and wide data frame layouts mainly affect readability. <strong>For humans, the wide format</strong> is often more intuitive since we can often see more of the data on the screen due to its shape. However, the <strong>long format is more machine readable</strong> and is closer to the formatting of databases. The ID variables in our data frames are similar to the fields in a database and observed variables are like the database values.</p>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting started</h2>
</section>
<section id="the-tidyr-package" class="level2">
<h2 class="anchored" data-anchor-id="the-tidyr-package">The <code>tidyr</code> package</h2>
<p>Luckily, the <a href="https://cran.r-project.org/package=tidyr"><code>tidyr</code></a> package provides a number of very useful functions for reshaping data frames.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip: Tidyverse
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>tidyr</code> package belongs to a broader family of opinionated R packages designed for data science called the “Tidyverse”. These packages are specifically designed to work harmoniously together. Some of these packages will be covered along this course, but you can find more complete information here: <a href="https://www.tidyverse.org/">https://www.tidyverse.org/</a>.</p>
</div>
</div>
<p>Or install the packages individually if you haven’t already done so (you may check with <code>library("tidyr")</code> &amp; <code>library("dplyr")</code> )</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("tidyr")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("dplyr")   # in case you use pipe '%&gt;%' </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Load the packages</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyr"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here we’re going to cover 5 of the most commonly used functions as well as using pipes (<code>%&gt;%</code>) to combine them.</p>
<ol type="1">
<li><code>pivot_loger()</code></li>
<li><code>pivot_wider()</code></li>
<li><code>seperate()</code></li>
<li><code>unite()</code></li>
<li><code>NA removal</code></li>
</ol>
<p>Load the <a href="https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/main/episodes/data/gapminder_data.csv">gapminder</a> data from the s link</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/main/episodes/data/gapminder_data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>First, lets look at the structure of our original <strong>gapminder</strong> data frame:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gapminder)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">country</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">pop</th>
<th style="text-align: left;">continent</th>
<th style="text-align: right;">lifeExp</th>
<th style="text-align: right;">gdpPercap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1952</td>
<td style="text-align: right;">8425333</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">28.801</td>
<td style="text-align: right;">779.4453</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1957</td>
<td style="text-align: right;">9240934</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">30.332</td>
<td style="text-align: right;">820.8530</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1962</td>
<td style="text-align: right;">10267083</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">31.997</td>
<td style="text-align: right;">853.1007</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1967</td>
<td style="text-align: right;">11537966</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">34.020</td>
<td style="text-align: right;">836.1971</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1972</td>
<td style="text-align: right;">13079460</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">36.088</td>
<td style="text-align: right;">739.9811</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1977</td>
<td style="text-align: right;">14880372</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">38.438</td>
<td style="text-align: right;">786.1134</td>
</tr>
</tbody>
</table>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or str(gapminder)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or View(gapminder)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="challenge-1" class="level2">
<h2 class="anchored" data-anchor-id="challenge-1">Challenge 1</h2>
<div class="callout callout-style-default callout-important callout-titled" title="Is gapminder a purely long, purely wide, or some intermediate format?">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Is gapminder a purely long, purely wide, or some intermediate format?
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution to challenge 1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<pre><code>The original gapminder data.frame is in an intermediate format. It is not
purely long since it had multiple observation variables
(`pop`,`lifeExp`,`gdpPercap`).</code></pre>
</div>
</div>
</div>
<p>Sometimes, as with the gapminder dataset, we have multiple types of observed data. It is somewhere in between the purely ‘long’ and ‘wide’ data formats. We have 3 “ID variables” (<code>continent</code>, <code>country</code>, <code>year</code>) and 3 “Observation variables” (<code>pop</code>,<code>lifeExp</code>,<code>gdpPercap</code>). This intermediate format can be preferred despite not having ALL observations in 1 column given that all 3 observation variables have different units. There are few operations that would need us to make this data frame any longer (i.e.&nbsp;4 ID variables and 1 Observation variable).</p>
<p>While using many of the functions in R, which are often vector based, you usually do not want to do mathematical operations on values with different units. For example, using the purely long format, a single mean for all of the values of population, life expectancy, and GDP would not be meaningful since it would return the mean of values with 3 incompatible units. The solution is that we first manipulate the data either by grouping (see the tomorrows lesson on <code>dplyr</code>), or we change the structure of the data frame.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note:
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some plotting functions in R actually work better in the wide format data.</p>
</div>
</div>
</section>
<section id="from-wide-to-long-format-with-pivot_longer" class="level2">
<h2 class="anchored" data-anchor-id="from-wide-to-long-format-with-pivot_longer">From wide to long format with <code>pivot_longer()</code></h2>
<p>Until now, we’ve been using the nicely formatted original gapminder dataset, but ‘real’ data (i.e.&nbsp;our own research data) will never be so well organized. Here let’s start with the wide formatted version of the gapminder dataset.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Download the <strong>wide version</strong> of the gapminder data from <a href="data/gapminder_wide.csv">this link to a csv file</a> and save it in your data folder.</p>
</div>
</div>
<p>We’ll load the data file and look at it. Note: we don’t want our continent and country columns to be factors, so we use the stringsAsFactors argument for <code>read.csv()</code> to disable that.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>gap_wide <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/gh-pages/data/gapminder_wide.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">continent</th>
<th style="text-align: left;">country</th>
<th style="text-align: right;">gdpPercap_1952</th>
<th style="text-align: right;">gdpPercap_1957</th>
<th style="text-align: right;">gdpPercap_1962</th>
<th style="text-align: right;">gdpPercap_1967</th>
<th style="text-align: right;">gdpPercap_1972</th>
<th style="text-align: right;">gdpPercap_1977</th>
<th style="text-align: right;">gdpPercap_1982</th>
<th style="text-align: right;">gdpPercap_1987</th>
<th style="text-align: right;">gdpPercap_1992</th>
<th style="text-align: right;">gdpPercap_1997</th>
<th style="text-align: right;">gdpPercap_2002</th>
<th style="text-align: right;">gdpPercap_2007</th>
<th style="text-align: right;">lifeExp_1952</th>
<th style="text-align: right;">lifeExp_1957</th>
<th style="text-align: right;">lifeExp_1962</th>
<th style="text-align: right;">lifeExp_1967</th>
<th style="text-align: right;">lifeExp_1972</th>
<th style="text-align: right;">lifeExp_1977</th>
<th style="text-align: right;">lifeExp_1982</th>
<th style="text-align: right;">lifeExp_1987</th>
<th style="text-align: right;">lifeExp_1992</th>
<th style="text-align: right;">lifeExp_1997</th>
<th style="text-align: right;">lifeExp_2002</th>
<th style="text-align: right;">lifeExp_2007</th>
<th style="text-align: right;">pop_1952</th>
<th style="text-align: right;">pop_1957</th>
<th style="text-align: right;">pop_1962</th>
<th style="text-align: right;">pop_1967</th>
<th style="text-align: right;">pop_1972</th>
<th style="text-align: right;">pop_1977</th>
<th style="text-align: right;">pop_1982</th>
<th style="text-align: right;">pop_1987</th>
<th style="text-align: right;">pop_1992</th>
<th style="text-align: right;">pop_1997</th>
<th style="text-align: right;">pop_2002</th>
<th style="text-align: right;">pop_2007</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: right;">2449.0082</td>
<td style="text-align: right;">3013.9760</td>
<td style="text-align: right;">2550.8169</td>
<td style="text-align: right;">3246.9918</td>
<td style="text-align: right;">4182.6638</td>
<td style="text-align: right;">4910.4168</td>
<td style="text-align: right;">5745.1602</td>
<td style="text-align: right;">5681.3585</td>
<td style="text-align: right;">5023.2166</td>
<td style="text-align: right;">4797.2951</td>
<td style="text-align: right;">5288.0404</td>
<td style="text-align: right;">6223.3675</td>
<td style="text-align: right;">43.077</td>
<td style="text-align: right;">45.685</td>
<td style="text-align: right;">48.303</td>
<td style="text-align: right;">51.407</td>
<td style="text-align: right;">54.518</td>
<td style="text-align: right;">58.014</td>
<td style="text-align: right;">61.368</td>
<td style="text-align: right;">65.799</td>
<td style="text-align: right;">67.744</td>
<td style="text-align: right;">69.152</td>
<td style="text-align: right;">70.994</td>
<td style="text-align: right;">72.301</td>
<td style="text-align: right;">9279525</td>
<td style="text-align: right;">10270856</td>
<td style="text-align: right;">11000948</td>
<td style="text-align: right;">12760499</td>
<td style="text-align: right;">14760787</td>
<td style="text-align: right;">17152804</td>
<td style="text-align: right;">20033753</td>
<td style="text-align: right;">23254956</td>
<td style="text-align: right;">26298373</td>
<td style="text-align: right;">29072015</td>
<td style="text-align: right;">31287142</td>
<td style="text-align: right;">33333216</td>
</tr>
<tr class="even">
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Angola</td>
<td style="text-align: right;">3520.6103</td>
<td style="text-align: right;">3827.9405</td>
<td style="text-align: right;">4269.2767</td>
<td style="text-align: right;">5522.7764</td>
<td style="text-align: right;">5473.2880</td>
<td style="text-align: right;">3008.6474</td>
<td style="text-align: right;">2756.9537</td>
<td style="text-align: right;">2430.2083</td>
<td style="text-align: right;">2627.8457</td>
<td style="text-align: right;">2277.1409</td>
<td style="text-align: right;">2773.2873</td>
<td style="text-align: right;">4797.2313</td>
<td style="text-align: right;">30.015</td>
<td style="text-align: right;">31.999</td>
<td style="text-align: right;">34.000</td>
<td style="text-align: right;">35.985</td>
<td style="text-align: right;">37.928</td>
<td style="text-align: right;">39.483</td>
<td style="text-align: right;">39.942</td>
<td style="text-align: right;">39.906</td>
<td style="text-align: right;">40.647</td>
<td style="text-align: right;">40.963</td>
<td style="text-align: right;">41.003</td>
<td style="text-align: right;">42.731</td>
<td style="text-align: right;">4232095</td>
<td style="text-align: right;">4561361</td>
<td style="text-align: right;">4826015</td>
<td style="text-align: right;">5247469</td>
<td style="text-align: right;">5894858</td>
<td style="text-align: right;">6162675</td>
<td style="text-align: right;">7016384</td>
<td style="text-align: right;">7874230</td>
<td style="text-align: right;">8735988</td>
<td style="text-align: right;">9875024</td>
<td style="text-align: right;">10866106</td>
<td style="text-align: right;">12420476</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Benin</td>
<td style="text-align: right;">1062.7522</td>
<td style="text-align: right;">959.6011</td>
<td style="text-align: right;">949.4991</td>
<td style="text-align: right;">1035.8314</td>
<td style="text-align: right;">1085.7969</td>
<td style="text-align: right;">1029.1613</td>
<td style="text-align: right;">1277.8976</td>
<td style="text-align: right;">1225.8560</td>
<td style="text-align: right;">1191.2077</td>
<td style="text-align: right;">1232.9753</td>
<td style="text-align: right;">1372.8779</td>
<td style="text-align: right;">1441.2849</td>
<td style="text-align: right;">38.223</td>
<td style="text-align: right;">40.358</td>
<td style="text-align: right;">42.618</td>
<td style="text-align: right;">44.885</td>
<td style="text-align: right;">47.014</td>
<td style="text-align: right;">49.190</td>
<td style="text-align: right;">50.904</td>
<td style="text-align: right;">52.337</td>
<td style="text-align: right;">53.919</td>
<td style="text-align: right;">54.777</td>
<td style="text-align: right;">54.406</td>
<td style="text-align: right;">56.728</td>
<td style="text-align: right;">1738315</td>
<td style="text-align: right;">1925173</td>
<td style="text-align: right;">2151895</td>
<td style="text-align: right;">2427334</td>
<td style="text-align: right;">2761407</td>
<td style="text-align: right;">3168267</td>
<td style="text-align: right;">3641603</td>
<td style="text-align: right;">4243788</td>
<td style="text-align: right;">4981671</td>
<td style="text-align: right;">6066080</td>
<td style="text-align: right;">7026113</td>
<td style="text-align: right;">8078314</td>
</tr>
<tr class="even">
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Botswana</td>
<td style="text-align: right;">851.2411</td>
<td style="text-align: right;">918.2325</td>
<td style="text-align: right;">983.6540</td>
<td style="text-align: right;">1214.7093</td>
<td style="text-align: right;">2263.6111</td>
<td style="text-align: right;">3214.8578</td>
<td style="text-align: right;">4551.1421</td>
<td style="text-align: right;">6205.8839</td>
<td style="text-align: right;">7954.1116</td>
<td style="text-align: right;">8647.1423</td>
<td style="text-align: right;">11003.6051</td>
<td style="text-align: right;">12569.8518</td>
<td style="text-align: right;">47.622</td>
<td style="text-align: right;">49.618</td>
<td style="text-align: right;">51.520</td>
<td style="text-align: right;">53.298</td>
<td style="text-align: right;">56.024</td>
<td style="text-align: right;">59.319</td>
<td style="text-align: right;">61.484</td>
<td style="text-align: right;">63.622</td>
<td style="text-align: right;">62.745</td>
<td style="text-align: right;">52.556</td>
<td style="text-align: right;">46.634</td>
<td style="text-align: right;">50.728</td>
<td style="text-align: right;">442308</td>
<td style="text-align: right;">474639</td>
<td style="text-align: right;">512764</td>
<td style="text-align: right;">553541</td>
<td style="text-align: right;">619351</td>
<td style="text-align: right;">781472</td>
<td style="text-align: right;">970347</td>
<td style="text-align: right;">1151184</td>
<td style="text-align: right;">1342614</td>
<td style="text-align: right;">1536536</td>
<td style="text-align: right;">1630347</td>
<td style="text-align: right;">1639131</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Burkina Faso</td>
<td style="text-align: right;">543.2552</td>
<td style="text-align: right;">617.1835</td>
<td style="text-align: right;">722.5120</td>
<td style="text-align: right;">794.8266</td>
<td style="text-align: right;">854.7360</td>
<td style="text-align: right;">743.3870</td>
<td style="text-align: right;">807.1986</td>
<td style="text-align: right;">912.0631</td>
<td style="text-align: right;">931.7528</td>
<td style="text-align: right;">946.2950</td>
<td style="text-align: right;">1037.6452</td>
<td style="text-align: right;">1217.0330</td>
<td style="text-align: right;">31.975</td>
<td style="text-align: right;">34.906</td>
<td style="text-align: right;">37.814</td>
<td style="text-align: right;">40.697</td>
<td style="text-align: right;">43.591</td>
<td style="text-align: right;">46.137</td>
<td style="text-align: right;">48.122</td>
<td style="text-align: right;">49.557</td>
<td style="text-align: right;">50.260</td>
<td style="text-align: right;">50.324</td>
<td style="text-align: right;">50.650</td>
<td style="text-align: right;">52.295</td>
<td style="text-align: right;">4469979</td>
<td style="text-align: right;">4713416</td>
<td style="text-align: right;">4919632</td>
<td style="text-align: right;">5127935</td>
<td style="text-align: right;">5433886</td>
<td style="text-align: right;">5889574</td>
<td style="text-align: right;">6634596</td>
<td style="text-align: right;">7586551</td>
<td style="text-align: right;">8878303</td>
<td style="text-align: right;">10352843</td>
<td style="text-align: right;">12251209</td>
<td style="text-align: right;">14326203</td>
</tr>
<tr class="even">
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Burundi</td>
<td style="text-align: right;">339.2965</td>
<td style="text-align: right;">379.5646</td>
<td style="text-align: right;">355.2032</td>
<td style="text-align: right;">412.9775</td>
<td style="text-align: right;">464.0995</td>
<td style="text-align: right;">556.1033</td>
<td style="text-align: right;">559.6032</td>
<td style="text-align: right;">621.8188</td>
<td style="text-align: right;">631.6999</td>
<td style="text-align: right;">463.1151</td>
<td style="text-align: right;">446.4035</td>
<td style="text-align: right;">430.0707</td>
<td style="text-align: right;">39.031</td>
<td style="text-align: right;">40.533</td>
<td style="text-align: right;">42.045</td>
<td style="text-align: right;">43.548</td>
<td style="text-align: right;">44.057</td>
<td style="text-align: right;">45.910</td>
<td style="text-align: right;">47.471</td>
<td style="text-align: right;">48.211</td>
<td style="text-align: right;">44.736</td>
<td style="text-align: right;">45.326</td>
<td style="text-align: right;">47.360</td>
<td style="text-align: right;">49.580</td>
<td style="text-align: right;">2445618</td>
<td style="text-align: right;">2667518</td>
<td style="text-align: right;">2961915</td>
<td style="text-align: right;">3330989</td>
<td style="text-align: right;">3529983</td>
<td style="text-align: right;">3834415</td>
<td style="text-align: right;">4580410</td>
<td style="text-align: right;">5126023</td>
<td style="text-align: right;">5809236</td>
<td style="text-align: right;">6121610</td>
<td style="text-align: right;">7021078</td>
<td style="text-align: right;">8390505</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Or try <code>str(gap_wide)</code></p>
<p><img src="fig/14-tidyr-fig2.png" class="img-fluid" alt="Diagram illustrating the wide format of the gapminder data frame"></p>
<p>To change this very wide data frame layout back to our nice, intermediate (or longer) layout, we will use one of the two available <code>pivot</code> functions from the <code>tidyr</code> package. To convert from wide to a longer format, we will use the <code>pivot_longer()</code> function. <code>pivot_longer()</code> makes datasets longer by increasing the number of rows and decreasing the number of columns, or ‘lengthening’ your observation variables into a single variable.</p>
<p><img src="fig/14-tidyr-fig3.png" class="img-fluid" alt="Diagram illustrating how pivot longer reorganizes a data frame from a wide to long format"></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>gap_long <span class="ot">&lt;-</span> gap_wide <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'pop'</span>), <span class="fu">starts_with</span>(<span class="st">'lifeExp'</span>), <span class="fu">starts_with</span>(<span class="st">'gdpPercap'</span>)),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"obstype_year"</span>, <span class="at">values_to =</span> <span class="st">"obs_values"</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">continent</th>
<th style="text-align: left;">country</th>
<th style="text-align: left;">obstype_year</th>
<th style="text-align: right;">obs_values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">pop_1952</td>
<td style="text-align: right;">9279525</td>
</tr>
<tr class="even">
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">pop_1957</td>
<td style="text-align: right;">10270856</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">pop_1962</td>
<td style="text-align: right;">11000948</td>
</tr>
<tr class="even">
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">pop_1967</td>
<td style="text-align: right;">12760499</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">pop_1972</td>
<td style="text-align: right;">14760787</td>
</tr>
<tr class="even">
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">pop_1977</td>
<td style="text-align: right;">17152804</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Here we have used <strong>piping (%&gt;%)</strong> syntax which is part of dplyr Package, we will see more tomorow at dplyr lesson too.</p>
<p>We first provide to <code>pivot_longer()</code> a vector of column names that will be pivoted into longer format. We could type out all the observation variables, but as in the <code>select()</code> function (see <code>dplyr</code> lesson if needed), we can use the <code>starts_with()</code> argument to select all variables that start with the desired character string. <code>pivot_longer()</code> also allows the alternative syntax of using the <code>-</code> symbol to identify which variables are not to be pivoted (i.e.&nbsp;ID variables).</p>
<p>The next arguments to <code>pivot_longer()</code> are <code>names_to</code> for naming the column that will contain the new ID variable (<code>obstype_year</code>) and <code>values_to</code> for naming the new amalgamated observation variable (<code>obs_value</code>). We supply these new column names as strings.</p>
<p><img src="fig/14-tidyr-fig4.png" class="img-fluid" alt="Diagram illustrating the long format of the gapminder data"> Apply the <code>pivot_longer()</code> and print the first few lines with <code>head()</code></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>gap_long <span class="ot">&lt;-</span> gap_wide <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="sc">-</span>continent, <span class="sc">-</span>country),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"obstype_year"</span>, <span class="at">values_to =</span> <span class="st">"obs_values"</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">continent</th>
<th style="text-align: left;">country</th>
<th style="text-align: left;">obstype_year</th>
<th style="text-align: right;">obs_values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">gdpPercap_1952</td>
<td style="text-align: right;">2449.008</td>
</tr>
<tr class="even">
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">gdpPercap_1957</td>
<td style="text-align: right;">3013.976</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">gdpPercap_1962</td>
<td style="text-align: right;">2550.817</td>
</tr>
<tr class="even">
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">gdpPercap_1967</td>
<td style="text-align: right;">3246.992</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">gdpPercap_1972</td>
<td style="text-align: right;">4182.664</td>
</tr>
<tr class="even">
<td style="text-align: left;">Africa</td>
<td style="text-align: left;">Algeria</td>
<td style="text-align: left;">gdpPercap_1977</td>
<td style="text-align: right;">4910.417</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Check the last couple of lines with <code>tail()</code></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(gap_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">continent</th>
<th style="text-align: left;">country</th>
<th style="text-align: left;">obstype_year</th>
<th style="text-align: right;">obs_values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Oceania</td>
<td style="text-align: left;">New Zealand</td>
<td style="text-align: left;">pop_1982</td>
<td style="text-align: right;">3210650</td>
</tr>
<tr class="even">
<td style="text-align: left;">Oceania</td>
<td style="text-align: left;">New Zealand</td>
<td style="text-align: left;">pop_1987</td>
<td style="text-align: right;">3317166</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Oceania</td>
<td style="text-align: left;">New Zealand</td>
<td style="text-align: left;">pop_1992</td>
<td style="text-align: right;">3437674</td>
</tr>
<tr class="even">
<td style="text-align: left;">Oceania</td>
<td style="text-align: left;">New Zealand</td>
<td style="text-align: left;">pop_1997</td>
<td style="text-align: right;">3676187</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Oceania</td>
<td style="text-align: left;">New Zealand</td>
<td style="text-align: left;">pop_2002</td>
<td style="text-align: right;">3908037</td>
</tr>
<tr class="even">
<td style="text-align: left;">Oceania</td>
<td style="text-align: left;">New Zealand</td>
<td style="text-align: left;">pop_2007</td>
<td style="text-align: right;">4115771</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>That may seem trivial with this particular data frame, but sometimes you have 1 ID variable and 40 observation variables with irregular variable names. The flexibility is a huge time saver!</p>
</section>
<section id="split-the-variable-into-many-with-seperate" class="level2">
<h2 class="anchored" data-anchor-id="split-the-variable-into-many-with-seperate">Split the variable into many with <code>seperate()</code></h2>
<p>Now <code>obstype_year</code> actually contains 2 pieces of information, the observation type (<code>pop</code>,<code>lifeExp</code>, or <code>gdpPercap</code>) and the <code>year</code>. We can use the <code>separate()</code> function to split the character strings into multiple variables</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>gap_long <span class="ot">&lt;-</span> gap_long <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(obstype_year, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">'obs_type'</span>, <span class="st">'year'</span>), <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>gap_long<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(gap_long<span class="sc">$</span>year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="from-long-to-intermediate-format-with-pivot_wider" class="level2">
<h2 class="anchored" data-anchor-id="from-long-to-intermediate-format-with-pivot_wider">From long to intermediate format with <code>pivot_wider()</code></h2>
<p>It is always good to check work. So, let’s use the second <code>pivot</code> function, <code>pivot_wider()</code>, to ‘widen’ our observation variables back out. <code>pivot_wider()</code> is the opposite of <code>pivot_longer()</code>, making a dataset wider by increasing the number of columns and decreasing the number of rows. We can use <code>pivot_wider()</code> to pivot or reshape our <code>gap_long</code> to the original intermediate format or the widest format. Let’s start with the intermediate format.</p>
<p>The <code>pivot_wider()</code> function takes <code>names_from</code> and <code>values_from</code> arguments.</p>
<p>To <code>names_from</code> we supply the column name whose contents will be pivoted into new output columns in the widened data frame. The corresponding values will be added from the column named in the <code>values_from</code> argument.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>gap_normal <span class="ot">&lt;-</span> gap_long <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> obs_type, <span class="at">values_from =</span> obs_values)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(gap_normal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1704    6</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(gapminder)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1704    6</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(gap_normal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "continent" "country"   "year"      "gdpPercap" "lifeExp"   "pop"      </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(gapminder)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "country"   "year"      "pop"       "continent" "lifeExp"   "gdpPercap"</code></pre>
</div>
</div>
<p>Now we’ve got an intermediate data frame <code>gap_normal</code> with the same dimensions as the original <code>gapminder</code>, but the order of the variables is different. Let’s fix that before checking if they are <code>all.equal()</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>gap_normal <span class="ot">&lt;-</span> gap_normal[, <span class="fu">names</span>(gapminder)]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(gap_normal, gapminder)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Attributes: &lt; Component \"class\": Lengths (3, 1) differ (string compare on first 1) &gt;"
[2] "Attributes: &lt; Component \"class\": 1 string mismatch &gt;"                                
[3] "Component \"country\": 1704 string mismatches"                                         
[4] "Component \"pop\": Mean relative difference: 1.634504"                                 
[5] "Component \"continent\": 1212 string mismatches"                                       
[6] "Component \"lifeExp\": Mean relative difference: 0.203822"                             
[7] "Component \"gdpPercap\": Mean relative difference: 1.162302"                           </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_normal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">country</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">pop</th>
<th style="text-align: left;">continent</th>
<th style="text-align: right;">lifeExp</th>
<th style="text-align: right;">gdpPercap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: right;">1952</td>
<td style="text-align: right;">9279525</td>
<td style="text-align: left;">Africa</td>
<td style="text-align: right;">43.077</td>
<td style="text-align: right;">2449.008</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: right;">1957</td>
<td style="text-align: right;">10270856</td>
<td style="text-align: left;">Africa</td>
<td style="text-align: right;">45.685</td>
<td style="text-align: right;">3013.976</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: right;">1962</td>
<td style="text-align: right;">11000948</td>
<td style="text-align: left;">Africa</td>
<td style="text-align: right;">48.303</td>
<td style="text-align: right;">2550.817</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: right;">1967</td>
<td style="text-align: right;">12760499</td>
<td style="text-align: left;">Africa</td>
<td style="text-align: right;">51.407</td>
<td style="text-align: right;">3246.992</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Algeria</td>
<td style="text-align: right;">1972</td>
<td style="text-align: right;">14760787</td>
<td style="text-align: left;">Africa</td>
<td style="text-align: right;">54.518</td>
<td style="text-align: right;">4182.664</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algeria</td>
<td style="text-align: right;">1977</td>
<td style="text-align: right;">17152804</td>
<td style="text-align: left;">Africa</td>
<td style="text-align: right;">58.014</td>
<td style="text-align: right;">4910.417</td>
</tr>
</tbody>
</table>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gapminder)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">country</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">pop</th>
<th style="text-align: left;">continent</th>
<th style="text-align: right;">lifeExp</th>
<th style="text-align: right;">gdpPercap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1952</td>
<td style="text-align: right;">8425333</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">28.801</td>
<td style="text-align: right;">779.4453</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1957</td>
<td style="text-align: right;">9240934</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">30.332</td>
<td style="text-align: right;">820.8530</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1962</td>
<td style="text-align: right;">10267083</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">31.997</td>
<td style="text-align: right;">853.1007</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1967</td>
<td style="text-align: right;">11537966</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">34.020</td>
<td style="text-align: right;">836.1971</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1972</td>
<td style="text-align: right;">13079460</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">36.088</td>
<td style="text-align: right;">739.9811</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afghanistan</td>
<td style="text-align: right;">1977</td>
<td style="text-align: right;">14880372</td>
<td style="text-align: left;">Asia</td>
<td style="text-align: right;">38.438</td>
<td style="text-align: right;">786.1134</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We’re almost there, the original was sorted by <code>country</code>, then <code>year</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(gap_normal, gapminder)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Attributes: &lt; Component \"class\": Lengths (3, 1) differ (string compare on first 1) &gt;"
[2] "Attributes: &lt; Component \"class\": 1 string mismatch &gt;"                                
[3] "Component \"country\": 1704 string mismatches"                                         
[4] "Component \"pop\": Mean relative difference: 1.634504"                                 
[5] "Component \"continent\": 1212 string mismatches"                                       
[6] "Component \"lifeExp\": Mean relative difference: 0.203822"                             
[7] "Component \"gdpPercap\": Mean relative difference: 1.162302"                           </code></pre>
</div>
</div>
<p>That’s great! We’ve gone from the longest format back to the intermediate and we didn’t introduce any errors in our code.</p>
</section>
<section id="join-the-variables-into-one-with-unite" class="level2">
<h2 class="anchored" data-anchor-id="join-the-variables-into-one-with-unite">Join the variables into one with <code>unite()</code></h2>
<p>Now let’s convert the long all the way back to the wide. In the wide format, we will keep country and continent as ID variables and pivot the observations across the 3 metrics (<code>pop</code>,<code>lifeExp</code>,<code>gdpPercap</code>) and time (<code>year</code>). First we need to create appropriate labels for all our new variables (time*metric combinations) and we also need to unify our ID variables to simplify the process of defining <code>gap_wide</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>gap_temp <span class="ot">&lt;-</span> gap_long <span class="sc">%&gt;%</span> <span class="fu">unite</span>(var_ID, continent, country, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gap_temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [5,112 × 4] (S3: tbl_df/tbl/data.frame)
 $ var_ID    : chr [1:5112] "Africa_Algeria" "Africa_Algeria" "Africa_Algeria" "Africa_Algeria" ...
 $ obs_type  : chr [1:5112] "gdpPercap" "gdpPercap" "gdpPercap" "gdpPercap" ...
 $ year      : int [1:5112] 1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
 $ obs_values: num [1:5112] 2449 3014 2551 3247 4183 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>gap_temp <span class="ot">&lt;-</span> gap_long <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unite</span>(ID_var, continent, country, <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unite</span>(var_names, obs_type, year, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gap_temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [5,112 × 3] (S3: tbl_df/tbl/data.frame)
 $ ID_var    : chr [1:5112] "Africa_Algeria" "Africa_Algeria" "Africa_Algeria" "Africa_Algeria" ...
 $ var_names : chr [1:5112] "gdpPercap_1952" "gdpPercap_1957" "gdpPercap_1962" "gdpPercap_1967" ...
 $ obs_values: num [1:5112] 2449 3014 2551 3247 4183 ...</code></pre>
</div>
</div>
<p>Using <code>unite()</code> we now have a single ID variable which is a combination of <code>continent</code>,<code>country</code>,and we have defined variable names. We’re now ready to pipe in <code>pivot_wider()</code></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>gap_wide_new <span class="ot">&lt;-</span> gap_long <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(ID_var, continent, country, <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(var_names, obs_type, year, <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> var_names, <span class="at">values_from =</span> obs_values)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_wide_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">ID_var</th>
<th style="text-align: right;">gdpPercap_1952</th>
<th style="text-align: right;">gdpPercap_1957</th>
<th style="text-align: right;">gdpPercap_1962</th>
<th style="text-align: right;">gdpPercap_1967</th>
<th style="text-align: right;">gdpPercap_1972</th>
<th style="text-align: right;">gdpPercap_1977</th>
<th style="text-align: right;">gdpPercap_1982</th>
<th style="text-align: right;">gdpPercap_1987</th>
<th style="text-align: right;">gdpPercap_1992</th>
<th style="text-align: right;">gdpPercap_1997</th>
<th style="text-align: right;">gdpPercap_2002</th>
<th style="text-align: right;">gdpPercap_2007</th>
<th style="text-align: right;">lifeExp_1952</th>
<th style="text-align: right;">lifeExp_1957</th>
<th style="text-align: right;">lifeExp_1962</th>
<th style="text-align: right;">lifeExp_1967</th>
<th style="text-align: right;">lifeExp_1972</th>
<th style="text-align: right;">lifeExp_1977</th>
<th style="text-align: right;">lifeExp_1982</th>
<th style="text-align: right;">lifeExp_1987</th>
<th style="text-align: right;">lifeExp_1992</th>
<th style="text-align: right;">lifeExp_1997</th>
<th style="text-align: right;">lifeExp_2002</th>
<th style="text-align: right;">lifeExp_2007</th>
<th style="text-align: right;">pop_1952</th>
<th style="text-align: right;">pop_1957</th>
<th style="text-align: right;">pop_1962</th>
<th style="text-align: right;">pop_1967</th>
<th style="text-align: right;">pop_1972</th>
<th style="text-align: right;">pop_1977</th>
<th style="text-align: right;">pop_1982</th>
<th style="text-align: right;">pop_1987</th>
<th style="text-align: right;">pop_1992</th>
<th style="text-align: right;">pop_1997</th>
<th style="text-align: right;">pop_2002</th>
<th style="text-align: right;">pop_2007</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Africa_Algeria</td>
<td style="text-align: right;">2449.0082</td>
<td style="text-align: right;">3013.9760</td>
<td style="text-align: right;">2550.8169</td>
<td style="text-align: right;">3246.9918</td>
<td style="text-align: right;">4182.6638</td>
<td style="text-align: right;">4910.4168</td>
<td style="text-align: right;">5745.1602</td>
<td style="text-align: right;">5681.3585</td>
<td style="text-align: right;">5023.2166</td>
<td style="text-align: right;">4797.2951</td>
<td style="text-align: right;">5288.0404</td>
<td style="text-align: right;">6223.3675</td>
<td style="text-align: right;">43.077</td>
<td style="text-align: right;">45.685</td>
<td style="text-align: right;">48.303</td>
<td style="text-align: right;">51.407</td>
<td style="text-align: right;">54.518</td>
<td style="text-align: right;">58.014</td>
<td style="text-align: right;">61.368</td>
<td style="text-align: right;">65.799</td>
<td style="text-align: right;">67.744</td>
<td style="text-align: right;">69.152</td>
<td style="text-align: right;">70.994</td>
<td style="text-align: right;">72.301</td>
<td style="text-align: right;">9279525</td>
<td style="text-align: right;">10270856</td>
<td style="text-align: right;">11000948</td>
<td style="text-align: right;">12760499</td>
<td style="text-align: right;">14760787</td>
<td style="text-align: right;">17152804</td>
<td style="text-align: right;">20033753</td>
<td style="text-align: right;">23254956</td>
<td style="text-align: right;">26298373</td>
<td style="text-align: right;">29072015</td>
<td style="text-align: right;">31287142</td>
<td style="text-align: right;">33333216</td>
</tr>
<tr class="even">
<td style="text-align: left;">Africa_Angola</td>
<td style="text-align: right;">3520.6103</td>
<td style="text-align: right;">3827.9405</td>
<td style="text-align: right;">4269.2767</td>
<td style="text-align: right;">5522.7764</td>
<td style="text-align: right;">5473.2880</td>
<td style="text-align: right;">3008.6474</td>
<td style="text-align: right;">2756.9537</td>
<td style="text-align: right;">2430.2083</td>
<td style="text-align: right;">2627.8457</td>
<td style="text-align: right;">2277.1409</td>
<td style="text-align: right;">2773.2873</td>
<td style="text-align: right;">4797.2313</td>
<td style="text-align: right;">30.015</td>
<td style="text-align: right;">31.999</td>
<td style="text-align: right;">34.000</td>
<td style="text-align: right;">35.985</td>
<td style="text-align: right;">37.928</td>
<td style="text-align: right;">39.483</td>
<td style="text-align: right;">39.942</td>
<td style="text-align: right;">39.906</td>
<td style="text-align: right;">40.647</td>
<td style="text-align: right;">40.963</td>
<td style="text-align: right;">41.003</td>
<td style="text-align: right;">42.731</td>
<td style="text-align: right;">4232095</td>
<td style="text-align: right;">4561361</td>
<td style="text-align: right;">4826015</td>
<td style="text-align: right;">5247469</td>
<td style="text-align: right;">5894858</td>
<td style="text-align: right;">6162675</td>
<td style="text-align: right;">7016384</td>
<td style="text-align: right;">7874230</td>
<td style="text-align: right;">8735988</td>
<td style="text-align: right;">9875024</td>
<td style="text-align: right;">10866106</td>
<td style="text-align: right;">12420476</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Africa_Benin</td>
<td style="text-align: right;">1062.7522</td>
<td style="text-align: right;">959.6011</td>
<td style="text-align: right;">949.4991</td>
<td style="text-align: right;">1035.8314</td>
<td style="text-align: right;">1085.7969</td>
<td style="text-align: right;">1029.1613</td>
<td style="text-align: right;">1277.8976</td>
<td style="text-align: right;">1225.8560</td>
<td style="text-align: right;">1191.2077</td>
<td style="text-align: right;">1232.9753</td>
<td style="text-align: right;">1372.8779</td>
<td style="text-align: right;">1441.2849</td>
<td style="text-align: right;">38.223</td>
<td style="text-align: right;">40.358</td>
<td style="text-align: right;">42.618</td>
<td style="text-align: right;">44.885</td>
<td style="text-align: right;">47.014</td>
<td style="text-align: right;">49.190</td>
<td style="text-align: right;">50.904</td>
<td style="text-align: right;">52.337</td>
<td style="text-align: right;">53.919</td>
<td style="text-align: right;">54.777</td>
<td style="text-align: right;">54.406</td>
<td style="text-align: right;">56.728</td>
<td style="text-align: right;">1738315</td>
<td style="text-align: right;">1925173</td>
<td style="text-align: right;">2151895</td>
<td style="text-align: right;">2427334</td>
<td style="text-align: right;">2761407</td>
<td style="text-align: right;">3168267</td>
<td style="text-align: right;">3641603</td>
<td style="text-align: right;">4243788</td>
<td style="text-align: right;">4981671</td>
<td style="text-align: right;">6066080</td>
<td style="text-align: right;">7026113</td>
<td style="text-align: right;">8078314</td>
</tr>
<tr class="even">
<td style="text-align: left;">Africa_Botswana</td>
<td style="text-align: right;">851.2411</td>
<td style="text-align: right;">918.2325</td>
<td style="text-align: right;">983.6540</td>
<td style="text-align: right;">1214.7093</td>
<td style="text-align: right;">2263.6111</td>
<td style="text-align: right;">3214.8578</td>
<td style="text-align: right;">4551.1421</td>
<td style="text-align: right;">6205.8839</td>
<td style="text-align: right;">7954.1116</td>
<td style="text-align: right;">8647.1423</td>
<td style="text-align: right;">11003.6051</td>
<td style="text-align: right;">12569.8518</td>
<td style="text-align: right;">47.622</td>
<td style="text-align: right;">49.618</td>
<td style="text-align: right;">51.520</td>
<td style="text-align: right;">53.298</td>
<td style="text-align: right;">56.024</td>
<td style="text-align: right;">59.319</td>
<td style="text-align: right;">61.484</td>
<td style="text-align: right;">63.622</td>
<td style="text-align: right;">62.745</td>
<td style="text-align: right;">52.556</td>
<td style="text-align: right;">46.634</td>
<td style="text-align: right;">50.728</td>
<td style="text-align: right;">442308</td>
<td style="text-align: right;">474639</td>
<td style="text-align: right;">512764</td>
<td style="text-align: right;">553541</td>
<td style="text-align: right;">619351</td>
<td style="text-align: right;">781472</td>
<td style="text-align: right;">970347</td>
<td style="text-align: right;">1151184</td>
<td style="text-align: right;">1342614</td>
<td style="text-align: right;">1536536</td>
<td style="text-align: right;">1630347</td>
<td style="text-align: right;">1639131</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Africa_Burkina Faso</td>
<td style="text-align: right;">543.2552</td>
<td style="text-align: right;">617.1835</td>
<td style="text-align: right;">722.5120</td>
<td style="text-align: right;">794.8266</td>
<td style="text-align: right;">854.7360</td>
<td style="text-align: right;">743.3870</td>
<td style="text-align: right;">807.1986</td>
<td style="text-align: right;">912.0631</td>
<td style="text-align: right;">931.7528</td>
<td style="text-align: right;">946.2950</td>
<td style="text-align: right;">1037.6452</td>
<td style="text-align: right;">1217.0330</td>
<td style="text-align: right;">31.975</td>
<td style="text-align: right;">34.906</td>
<td style="text-align: right;">37.814</td>
<td style="text-align: right;">40.697</td>
<td style="text-align: right;">43.591</td>
<td style="text-align: right;">46.137</td>
<td style="text-align: right;">48.122</td>
<td style="text-align: right;">49.557</td>
<td style="text-align: right;">50.260</td>
<td style="text-align: right;">50.324</td>
<td style="text-align: right;">50.650</td>
<td style="text-align: right;">52.295</td>
<td style="text-align: right;">4469979</td>
<td style="text-align: right;">4713416</td>
<td style="text-align: right;">4919632</td>
<td style="text-align: right;">5127935</td>
<td style="text-align: right;">5433886</td>
<td style="text-align: right;">5889574</td>
<td style="text-align: right;">6634596</td>
<td style="text-align: right;">7586551</td>
<td style="text-align: right;">8878303</td>
<td style="text-align: right;">10352843</td>
<td style="text-align: right;">12251209</td>
<td style="text-align: right;">14326203</td>
</tr>
<tr class="even">
<td style="text-align: left;">Africa_Burundi</td>
<td style="text-align: right;">339.2965</td>
<td style="text-align: right;">379.5646</td>
<td style="text-align: right;">355.2032</td>
<td style="text-align: right;">412.9775</td>
<td style="text-align: right;">464.0995</td>
<td style="text-align: right;">556.1033</td>
<td style="text-align: right;">559.6032</td>
<td style="text-align: right;">621.8188</td>
<td style="text-align: right;">631.6999</td>
<td style="text-align: right;">463.1151</td>
<td style="text-align: right;">446.4035</td>
<td style="text-align: right;">430.0707</td>
<td style="text-align: right;">39.031</td>
<td style="text-align: right;">40.533</td>
<td style="text-align: right;">42.045</td>
<td style="text-align: right;">43.548</td>
<td style="text-align: right;">44.057</td>
<td style="text-align: right;">45.910</td>
<td style="text-align: right;">47.471</td>
<td style="text-align: right;">48.211</td>
<td style="text-align: right;">44.736</td>
<td style="text-align: right;">45.326</td>
<td style="text-align: right;">47.360</td>
<td style="text-align: right;">49.580</td>
<td style="text-align: right;">2445618</td>
<td style="text-align: right;">2667518</td>
<td style="text-align: right;">2961915</td>
<td style="text-align: right;">3330989</td>
<td style="text-align: right;">3529983</td>
<td style="text-align: right;">3834415</td>
<td style="text-align: right;">4580410</td>
<td style="text-align: right;">5126023</td>
<td style="text-align: right;">5809236</td>
<td style="text-align: right;">6121610</td>
<td style="text-align: right;">7021078</td>
<td style="text-align: right;">8390505</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="challenge-2" class="level2">
<h2 class="anchored" data-anchor-id="challenge-2">Challenge 2</h2>
<div class="callout callout-style-default callout-important callout-titled" title="Take this 1 step further and create a `gap_ludicrously_wide` format data by pivoting over countries, year and the 3 metrics?">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Take this 1 step further and create a <code>gap_ludicrously_wide</code> format data by pivoting over countries, year and the 3 metrics?
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hint
</div>
</div>
<div class="callout-body-container callout-body">
<p>This new data frame should only have 5 rows.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution to challenge 2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>gap_ludicrously_wide <span class="ot">&lt;-</span> gap_long <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">unite</span>(var_names, obs_type, year, country, <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> var_names, <span class="at">values_from =</span> obs_values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<p>Now we have a great ‘wide’ format data frame, but the <code>ID_var</code> could be more usable, let’s separate it into 2 variables with <code>separate()</code></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>gap_wide_betterID <span class="ot">&lt;-</span> <span class="fu">separate</span>(gap_wide_new, ID_var, <span class="fu">c</span>(<span class="st">"continent"</span>, <span class="st">"country"</span>), <span class="at">sep=</span><span class="st">"_"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>gap_wide_betterID <span class="ot">&lt;-</span> gap_long <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unite</span>(ID_var, continent, country, <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unite</span>(var_names, obs_type, year, <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> var_names, <span class="at">values_from =</span> obs_values) <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(ID_var, <span class="fu">c</span>(<span class="st">"continent"</span>,<span class="st">"country"</span>), <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gap_wide_betterID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [142 × 38] (S3: tbl_df/tbl/data.frame)
 $ continent     : chr [1:142] "Africa" "Africa" "Africa" "Africa" ...
 $ country       : chr [1:142] "Algeria" "Angola" "Benin" "Botswana" ...
 $ gdpPercap_1952: num [1:142] 2449 3521 1063 851 543 ...
 $ gdpPercap_1957: num [1:142] 3014 3828 960 918 617 ...
 $ gdpPercap_1962: num [1:142] 2551 4269 949 984 723 ...
 $ gdpPercap_1967: num [1:142] 3247 5523 1036 1215 795 ...
 $ gdpPercap_1972: num [1:142] 4183 5473 1086 2264 855 ...
 $ gdpPercap_1977: num [1:142] 4910 3009 1029 3215 743 ...
 $ gdpPercap_1982: num [1:142] 5745 2757 1278 4551 807 ...
 $ gdpPercap_1987: num [1:142] 5681 2430 1226 6206 912 ...
 $ gdpPercap_1992: num [1:142] 5023 2628 1191 7954 932 ...
 $ gdpPercap_1997: num [1:142] 4797 2277 1233 8647 946 ...
 $ gdpPercap_2002: num [1:142] 5288 2773 1373 11004 1038 ...
 $ gdpPercap_2007: num [1:142] 6223 4797 1441 12570 1217 ...
 $ lifeExp_1952  : num [1:142] 43.1 30 38.2 47.6 32 ...
 $ lifeExp_1957  : num [1:142] 45.7 32 40.4 49.6 34.9 ...
 $ lifeExp_1962  : num [1:142] 48.3 34 42.6 51.5 37.8 ...
 $ lifeExp_1967  : num [1:142] 51.4 36 44.9 53.3 40.7 ...
 $ lifeExp_1972  : num [1:142] 54.5 37.9 47 56 43.6 ...
 $ lifeExp_1977  : num [1:142] 58 39.5 49.2 59.3 46.1 ...
 $ lifeExp_1982  : num [1:142] 61.4 39.9 50.9 61.5 48.1 ...
 $ lifeExp_1987  : num [1:142] 65.8 39.9 52.3 63.6 49.6 ...
 $ lifeExp_1992  : num [1:142] 67.7 40.6 53.9 62.7 50.3 ...
 $ lifeExp_1997  : num [1:142] 69.2 41 54.8 52.6 50.3 ...
 $ lifeExp_2002  : num [1:142] 71 41 54.4 46.6 50.6 ...
 $ lifeExp_2007  : num [1:142] 72.3 42.7 56.7 50.7 52.3 ...
 $ pop_1952      : num [1:142] 9279525 4232095 1738315 442308 4469979 ...
 $ pop_1957      : num [1:142] 10270856 4561361 1925173 474639 4713416 ...
 $ pop_1962      : num [1:142] 11000948 4826015 2151895 512764 4919632 ...
 $ pop_1967      : num [1:142] 12760499 5247469 2427334 553541 5127935 ...
 $ pop_1972      : num [1:142] 14760787 5894858 2761407 619351 5433886 ...
 $ pop_1977      : num [1:142] 17152804 6162675 3168267 781472 5889574 ...
 $ pop_1982      : num [1:142] 20033753 7016384 3641603 970347 6634596 ...
 $ pop_1987      : num [1:142] 23254956 7874230 4243788 1151184 7586551 ...
 $ pop_1992      : num [1:142] 26298373 8735988 4981671 1342614 8878303 ...
 $ pop_1997      : num [1:142] 29072015 9875024 6066080 1536536 10352843 ...
 $ pop_2002      : num [1:142] 31287142 10866106 7026113 1630347 12251209 ...
 $ pop_2007      : num [1:142] 33333216 12420476 8078314 1639131 14326203 ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(gap_wide, gap_wide_betterID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Attributes: &lt; Component \"class\": Lengths (1, 3) differ (string compare on first 1) &gt;"
[2] "Attributes: &lt; Component \"class\": 1 string mismatch &gt;"                                </code></pre>
</div>
</div>
<p>There and back again!</p>
</section>
<section id="other-great-resources" class="level2">
<h2 class="anchored" data-anchor-id="other-great-resources">Other great resources</h2>
<ul>
<li><a href="https://r4ds.hadley.nz/">R for Data Science</a> (online book)</li>
<li><a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">Data Wrangling Cheat sheet</a> (pdf file)</li>
<li><a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html">Introduction to tidyr</a> (online documentation)</li>
<li><a href="https://www.rstudio.com/resources/webinars/data-wrangling-with-r-and-rstudio/">Data wrangling with R and RStudio</a> (online video)</li>
</ul>
</section>
<section id="keypoints" class="level2">
<h2 class="anchored" data-anchor-id="keypoints">Keypoints</h2>
<ul>
<li>Use the <code>tidyr</code> package to change the layout of data frames.</li>
<li>Use <code>pivot_longer()</code> to go from wide to longer layout.</li>
<li>Use <code>pivot_wider()</code> to go from long to wider layout.</li>
</ul>
<section id="r-session-info" class="level4">
<h4 class="anchored" data-anchor-id="r-session-info">R Session info</h4>
<pre><code>sessionInfo()</code></pre>
<section id="end" class="level14">
<p class="heading">END</p>


<!-- -->

</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/yourdomain\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb37" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Data Frame Manipulation with tidyr"</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> source</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co">    title-block-banner: true</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co">    smooth-scroll: true</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 4</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: right</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co">    number-types: true</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co">    number-depth: 4</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: kable</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co">    standalone: false</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-align: left</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: pulse</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight: kate</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>Exercise time: 45 minutes</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: asis</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"# "</span>,<span class="st">"Overview"</span>)</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>**Questions**</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>How can I change the layout of a data frame?</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>**Objectives**</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>To understand the concepts of *longer* and *wider* data frame formats and be able to convert between them with <span class="in">`tidyr`</span>.</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>---------------------------------------------------------------</span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a><span class="in">gapminder &lt;- read.csv("data/gapminder_data.csv", header = TRUE, stringsAsFactors = FALSE)</span></span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a><span class="in">gap_wide &lt;- read.csv("data/gapminder_wide.csv", header = TRUE, stringsAsFactors = FALSE)</span></span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a>Researchers often want to **reshape their data frames** from 'wide' to 'longer'</span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a>layouts, or vice-versa. The 'long' layout or format is where:</span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>each column is a variable</span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>each row is an observation</span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a>In the purely 'long' (or 'longest') format, you usually have 1 column for the observed variable and the other columns are ID variables.</span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a>For the 'wide' format each row is often a site/subject/patient and you have</span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a>multiple observation variables containing the same type of data. These can be</span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a>either repeated observations over time, or observation of multiple variables (or</span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a>a mix of both). You may find data input may be simpler or some other</span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a>applications may prefer the 'wide' format.</span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; However, many of </span><span class="in">`R`</span><span class="at">'s functions have</span></span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a><span class="at">been designed assuming you have 'longer' formatted data. </span></span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a>This tutorial will help you</span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true" tabindex="-1"></a>efficiently transform your data shape regardless of original format.</span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-78"><a href="#cb37-78" aria-hidden="true" tabindex="-1"></a><span class="al">![](fig/14-tidyr-fig1.png)</span>{alt='Diagram illustrating the difference between a wide versus long layout of a data frame'}</span>
<span id="cb37-79"><a href="#cb37-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-80"><a href="#cb37-80" aria-hidden="true" tabindex="-1"></a>Long and wide data frame layouts mainly affect readability. **For humans, the wide format** is often more intuitive since we can often see more of the data on the screen due</span>
<span id="cb37-81"><a href="#cb37-81" aria-hidden="true" tabindex="-1"></a>to its shape. However, the **long format is more machine readable** and is closer</span>
<span id="cb37-82"><a href="#cb37-82" aria-hidden="true" tabindex="-1"></a>to the formatting of databases. The ID variables in our data frames are similar to</span>
<span id="cb37-83"><a href="#cb37-83" aria-hidden="true" tabindex="-1"></a>the fields in a database and observed variables are like the database values.</span>
<span id="cb37-84"><a href="#cb37-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-85"><a href="#cb37-85" aria-hidden="true" tabindex="-1"></a><span class="fu">## Getting started</span></span>
<span id="cb37-86"><a href="#cb37-86" aria-hidden="true" tabindex="-1"></a><span class="fu">## The `tidyr` package</span></span>
<span id="cb37-87"><a href="#cb37-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-88"><a href="#cb37-88" aria-hidden="true" tabindex="-1"></a>Luckily, the <span class="co">[</span><span class="ot">`tidyr`</span><span class="co">](https://cran.r-project.org/package=tidyr)</span></span>
<span id="cb37-89"><a href="#cb37-89" aria-hidden="true" tabindex="-1"></a>package provides a number of very useful functions for reshaping data frames.</span>
<span id="cb37-90"><a href="#cb37-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-91"><a href="#cb37-91" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb37-92"><a href="#cb37-92" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Tip: Tidyverse</span></span>
<span id="cb37-93"><a href="#cb37-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-94"><a href="#cb37-94" aria-hidden="true" tabindex="-1"></a><span class="in">`tidyr`</span> package belongs to a broader family of opinionated R packages</span>
<span id="cb37-95"><a href="#cb37-95" aria-hidden="true" tabindex="-1"></a>designed for data science called the "Tidyverse". These</span>
<span id="cb37-96"><a href="#cb37-96" aria-hidden="true" tabindex="-1"></a>packages are specifically designed to work harmoniously together.</span>
<span id="cb37-97"><a href="#cb37-97" aria-hidden="true" tabindex="-1"></a>Some of these packages will be covered along this course, but you can find more</span>
<span id="cb37-98"><a href="#cb37-98" aria-hidden="true" tabindex="-1"></a>complete information here: <span class="co">[</span><span class="ot">https://www.tidyverse.org/</span><span class="co">](https://www.tidyverse.org/)</span>.</span>
<span id="cb37-99"><a href="#cb37-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-100"><a href="#cb37-100" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb37-101"><a href="#cb37-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-102"><a href="#cb37-102" aria-hidden="true" tabindex="-1"></a>Or install the packages individually if you haven't already done so (you may check with <span class="in">`library("tidyr")`</span> &amp; <span class="in">`library("dplyr")`</span> )</span>
<span id="cb37-103"><a href="#cb37-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-104"><a href="#cb37-104" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb37-105"><a href="#cb37-105" aria-hidden="true" tabindex="-1"></a><span class="in">#install.packages("tidyr")</span></span>
<span id="cb37-106"><a href="#cb37-106" aria-hidden="true" tabindex="-1"></a><span class="in">#install.packages("dplyr")   # in case you use pipe '%&gt;%' </span></span>
<span id="cb37-107"><a href="#cb37-107" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-108"><a href="#cb37-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-109"><a href="#cb37-109" aria-hidden="true" tabindex="-1"></a>Load the packages</span>
<span id="cb37-110"><a href="#cb37-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-111"><a href="#cb37-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb37-112"><a href="#cb37-112" aria-hidden="true" tabindex="-1"></a><span class="in">library("tidyr")</span></span>
<span id="cb37-113"><a href="#cb37-113" aria-hidden="true" tabindex="-1"></a><span class="in">library("dplyr")</span></span>
<span id="cb37-114"><a href="#cb37-114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-115"><a href="#cb37-115" aria-hidden="true" tabindex="-1"></a>Here we're going to cover 5 of the most commonly used functions as well as using</span>
<span id="cb37-116"><a href="#cb37-116" aria-hidden="true" tabindex="-1"></a>pipes (<span class="in">`%&gt;%`</span>) to combine them.</span>
<span id="cb37-117"><a href="#cb37-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-118"><a href="#cb37-118" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span><span class="in">`pivot_loger()`</span></span>
<span id="cb37-119"><a href="#cb37-119" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span><span class="in">`pivot_wider()`</span></span>
<span id="cb37-120"><a href="#cb37-120" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span><span class="in">`seperate()`</span></span>
<span id="cb37-121"><a href="#cb37-121" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span><span class="in">`unite()`</span></span>
<span id="cb37-122"><a href="#cb37-122" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span><span class="in">`NA removal`</span></span>
<span id="cb37-123"><a href="#cb37-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-124"><a href="#cb37-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-125"><a href="#cb37-125" aria-hidden="true" tabindex="-1"></a>Load the <span class="co">[</span><span class="ot">gapminder</span><span class="co">](https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/main/episodes/data/gapminder_data.csv)</span> data from the s link</span>
<span id="cb37-128"><a href="#cb37-128" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-129"><a href="#cb37-129" aria-hidden="true" tabindex="-1"></a>gapminder <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/main/episodes/data/gapminder_data.csv"</span>)</span>
<span id="cb37-130"><a href="#cb37-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-131"><a href="#cb37-131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-132"><a href="#cb37-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-133"><a href="#cb37-133" aria-hidden="true" tabindex="-1"></a>First, lets look at the structure of our original **gapminder** data frame:</span>
<span id="cb37-134"><a href="#cb37-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-137"><a href="#cb37-137" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-138"><a href="#cb37-138" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gapminder)</span>
<span id="cb37-139"><a href="#cb37-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-140"><a href="#cb37-140" aria-hidden="true" tabindex="-1"></a><span class="co"># or str(gapminder)</span></span>
<span id="cb37-141"><a href="#cb37-141" aria-hidden="true" tabindex="-1"></a><span class="co"># or View(gapminder)</span></span>
<span id="cb37-142"><a href="#cb37-142" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-143"><a href="#cb37-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-144"><a href="#cb37-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-145"><a href="#cb37-145" aria-hidden="true" tabindex="-1"></a><span class="fu">## Challenge 1</span></span>
<span id="cb37-146"><a href="#cb37-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-147"><a href="#cb37-147" aria-hidden="true" tabindex="-1"></a>::: {.callout-important title="Is gapminder a purely long, purely wide, or some intermediate format?"}</span>
<span id="cb37-148"><a href="#cb37-148" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb37-149"><a href="#cb37-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-150"><a href="#cb37-150" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}    </span>
<span id="cb37-151"><a href="#cb37-151" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Solution to challenge 1</span></span>
<span id="cb37-152"><a href="#cb37-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-153"><a href="#cb37-153" aria-hidden="true" tabindex="-1"></a><span class="in">    The original gapminder data.frame is in an intermediate format. It is not</span></span>
<span id="cb37-154"><a href="#cb37-154" aria-hidden="true" tabindex="-1"></a><span class="in">    purely long since it had multiple observation variables</span></span>
<span id="cb37-155"><a href="#cb37-155" aria-hidden="true" tabindex="-1"></a><span class="in">    (`pop`,`lifeExp`,`gdpPercap`).</span></span>
<span id="cb37-156"><a href="#cb37-156" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb37-157"><a href="#cb37-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-158"><a href="#cb37-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-159"><a href="#cb37-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-160"><a href="#cb37-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-161"><a href="#cb37-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-162"><a href="#cb37-162" aria-hidden="true" tabindex="-1"></a>Sometimes, as with the gapminder dataset, we have multiple types of observed</span>
<span id="cb37-163"><a href="#cb37-163" aria-hidden="true" tabindex="-1"></a>data. It is somewhere in between the purely 'long' and 'wide' data formats. We</span>
<span id="cb37-164"><a href="#cb37-164" aria-hidden="true" tabindex="-1"></a>have 3 "ID variables" (<span class="in">`continent`</span>, <span class="in">`country`</span>, <span class="in">`year`</span>) and 3 "Observation</span>
<span id="cb37-165"><a href="#cb37-165" aria-hidden="true" tabindex="-1"></a>variables" (<span class="in">`pop`</span>,<span class="in">`lifeExp`</span>,<span class="in">`gdpPercap`</span>). This intermediate format can be</span>
<span id="cb37-166"><a href="#cb37-166" aria-hidden="true" tabindex="-1"></a>preferred despite not having ALL observations in 1 column given that all 3</span>
<span id="cb37-167"><a href="#cb37-167" aria-hidden="true" tabindex="-1"></a>observation variables have different units. There are few operations that would</span>
<span id="cb37-168"><a href="#cb37-168" aria-hidden="true" tabindex="-1"></a>need us to make this data frame any longer (i.e. 4 ID variables and 1</span>
<span id="cb37-169"><a href="#cb37-169" aria-hidden="true" tabindex="-1"></a>Observation variable).</span>
<span id="cb37-170"><a href="#cb37-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-171"><a href="#cb37-171" aria-hidden="true" tabindex="-1"></a>While using many of the functions in R, which are often vector based, you</span>
<span id="cb37-172"><a href="#cb37-172" aria-hidden="true" tabindex="-1"></a>usually do not want to do mathematical operations on values with different</span>
<span id="cb37-173"><a href="#cb37-173" aria-hidden="true" tabindex="-1"></a>units. For example, using the purely long format, a single mean for all of the</span>
<span id="cb37-174"><a href="#cb37-174" aria-hidden="true" tabindex="-1"></a>values of population, life expectancy, and GDP would not be meaningful since it</span>
<span id="cb37-175"><a href="#cb37-175" aria-hidden="true" tabindex="-1"></a>would return the mean of values with 3 incompatible units. The solution is that</span>
<span id="cb37-176"><a href="#cb37-176" aria-hidden="true" tabindex="-1"></a>we first manipulate the data either by grouping (see the tomorrows lesson on <span class="in">`dplyr`</span>), or</span>
<span id="cb37-177"><a href="#cb37-177" aria-hidden="true" tabindex="-1"></a>we change the structure of the data frame. </span>
<span id="cb37-178"><a href="#cb37-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-179"><a href="#cb37-179" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb37-180"><a href="#cb37-180" aria-hidden="true" tabindex="-1"></a><span class="fu">### Note: </span></span>
<span id="cb37-181"><a href="#cb37-181" aria-hidden="true" tabindex="-1"></a>Some plotting functions in R actually work better in the wide format data.</span>
<span id="cb37-182"><a href="#cb37-182" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb37-183"><a href="#cb37-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-184"><a href="#cb37-184" aria-hidden="true" tabindex="-1"></a><span class="fu">## From wide to long format with `pivot_longer()`</span></span>
<span id="cb37-185"><a href="#cb37-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-186"><a href="#cb37-186" aria-hidden="true" tabindex="-1"></a>Until now, we've been using the nicely formatted original gapminder dataset, but</span>
<span id="cb37-187"><a href="#cb37-187" aria-hidden="true" tabindex="-1"></a>'real' data (i.e. our own research data) will never be so well organized. Here</span>
<span id="cb37-188"><a href="#cb37-188" aria-hidden="true" tabindex="-1"></a>let's start with the wide formatted version of the gapminder dataset.</span>
<span id="cb37-189"><a href="#cb37-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-190"><a href="#cb37-190" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb37-191"><a href="#cb37-191" aria-hidden="true" tabindex="-1"></a> Download the **wide version** of the gapminder data from <span class="co">[</span><span class="ot">this link to a csv file</span><span class="co">](data/gapminder_wide.csv)</span></span>
<span id="cb37-192"><a href="#cb37-192" aria-hidden="true" tabindex="-1"></a>and save it in your data folder.</span>
<span id="cb37-193"><a href="#cb37-193" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb37-194"><a href="#cb37-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-195"><a href="#cb37-195" aria-hidden="true" tabindex="-1"></a>We'll load the data file and look at it. Note: we don't want our continent and</span>
<span id="cb37-196"><a href="#cb37-196" aria-hidden="true" tabindex="-1"></a>country columns to be factors, so we use the stringsAsFactors argument for</span>
<span id="cb37-197"><a href="#cb37-197" aria-hidden="true" tabindex="-1"></a><span class="in">`read.csv()`</span> to disable that.</span>
<span id="cb37-198"><a href="#cb37-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-201"><a href="#cb37-201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-202"><a href="#cb37-202" aria-hidden="true" tabindex="-1"></a>gap_wide <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/gh-pages/data/gapminder_wide.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb37-203"><a href="#cb37-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-204"><a href="#cb37-204" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_wide)</span>
<span id="cb37-205"><a href="#cb37-205" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-206"><a href="#cb37-206" aria-hidden="true" tabindex="-1"></a>Or try <span class="in">`str(gap_wide)`</span></span>
<span id="cb37-207"><a href="#cb37-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-208"><a href="#cb37-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-209"><a href="#cb37-209" aria-hidden="true" tabindex="-1"></a><span class="al">![](fig/14-tidyr-fig2.png)</span>{alt='Diagram illustrating the wide format of the gapminder data frame'}</span>
<span id="cb37-210"><a href="#cb37-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-211"><a href="#cb37-211" aria-hidden="true" tabindex="-1"></a>To change this very wide data frame layout back to our nice, intermediate (or longer) layout, we will use one of the two available <span class="in">`pivot`</span>  functions from the <span class="in">`tidyr`</span> package. To convert from wide to a longer format, we will use the <span class="in">`pivot_longer()`</span> function. <span class="in">`pivot_longer()`</span> makes datasets longer by increasing the number of rows and decreasing the number of columns, or 'lengthening' your observation variables into a single variable.</span>
<span id="cb37-212"><a href="#cb37-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-213"><a href="#cb37-213" aria-hidden="true" tabindex="-1"></a><span class="al">![](fig/14-tidyr-fig3.png)</span>{alt='Diagram illustrating how pivot longer reorganizes a data frame from a wide to long format'}</span>
<span id="cb37-214"><a href="#cb37-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-217"><a href="#cb37-217" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-218"><a href="#cb37-218" aria-hidden="true" tabindex="-1"></a>gap_long <span class="ot">&lt;-</span> gap_wide <span class="sc">%&gt;%</span></span>
<span id="cb37-219"><a href="#cb37-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb37-220"><a href="#cb37-220" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">'pop'</span>), <span class="fu">starts_with</span>(<span class="st">'lifeExp'</span>), <span class="fu">starts_with</span>(<span class="st">'gdpPercap'</span>)),</span>
<span id="cb37-221"><a href="#cb37-221" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"obstype_year"</span>, <span class="at">values_to =</span> <span class="st">"obs_values"</span></span>
<span id="cb37-222"><a href="#cb37-222" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-223"><a href="#cb37-223" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_long)</span>
<span id="cb37-224"><a href="#cb37-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-225"><a href="#cb37-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-226"><a href="#cb37-226" aria-hidden="true" tabindex="-1"></a>Here we have used **piping (%&gt;%)** syntax which is part of dplyr Package, we will see more tomorow at dplyr lesson too.</span>
<span id="cb37-227"><a href="#cb37-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-228"><a href="#cb37-228" aria-hidden="true" tabindex="-1"></a>We first provide to <span class="in">`pivot_longer()`</span> a vector of column names that will be</span>
<span id="cb37-229"><a href="#cb37-229" aria-hidden="true" tabindex="-1"></a>pivoted into longer format. We could type out all the observation variables, but</span>
<span id="cb37-230"><a href="#cb37-230" aria-hidden="true" tabindex="-1"></a>as in the <span class="in">`select()`</span> function (see <span class="in">`dplyr`</span> lesson if needed), we can use the <span class="in">`starts_with()`</span></span>
<span id="cb37-231"><a href="#cb37-231" aria-hidden="true" tabindex="-1"></a>argument to select all variables that start with the desired character string.</span>
<span id="cb37-232"><a href="#cb37-232" aria-hidden="true" tabindex="-1"></a><span class="in">`pivot_longer()`</span> also allows the alternative syntax of using the <span class="in">`-`</span> symbol to</span>
<span id="cb37-233"><a href="#cb37-233" aria-hidden="true" tabindex="-1"></a>identify which variables are not to be pivoted (i.e. ID variables).</span>
<span id="cb37-234"><a href="#cb37-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-235"><a href="#cb37-235" aria-hidden="true" tabindex="-1"></a>The next arguments to <span class="in">`pivot_longer()`</span> are <span class="in">`names_to`</span> for naming the column that</span>
<span id="cb37-236"><a href="#cb37-236" aria-hidden="true" tabindex="-1"></a>will contain the new ID variable (<span class="in">`obstype_year`</span>) and <span class="in">`values_to`</span> for naming the</span>
<span id="cb37-237"><a href="#cb37-237" aria-hidden="true" tabindex="-1"></a>new amalgamated observation variable (<span class="in">`obs_value`</span>). We supply these new column</span>
<span id="cb37-238"><a href="#cb37-238" aria-hidden="true" tabindex="-1"></a>names as strings.</span>
<span id="cb37-239"><a href="#cb37-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-240"><a href="#cb37-240" aria-hidden="true" tabindex="-1"></a><span class="al">![](fig/14-tidyr-fig4.png)</span>{alt='Diagram illustrating the long format of the gapminder data'}</span>
<span id="cb37-241"><a href="#cb37-241" aria-hidden="true" tabindex="-1"></a>Apply the <span class="in">`pivot_longer()`</span> and print the first few lines with <span class="in">`head()`</span></span>
<span id="cb37-244"><a href="#cb37-244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-245"><a href="#cb37-245" aria-hidden="true" tabindex="-1"></a>gap_long <span class="ot">&lt;-</span> gap_wide <span class="sc">%&gt;%</span></span>
<span id="cb37-246"><a href="#cb37-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb37-247"><a href="#cb37-247" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="sc">-</span>continent, <span class="sc">-</span>country),</span>
<span id="cb37-248"><a href="#cb37-248" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"obstype_year"</span>, <span class="at">values_to =</span> <span class="st">"obs_values"</span></span>
<span id="cb37-249"><a href="#cb37-249" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-250"><a href="#cb37-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-251"><a href="#cb37-251" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_long)</span>
<span id="cb37-252"><a href="#cb37-252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-253"><a href="#cb37-253" aria-hidden="true" tabindex="-1"></a>Check the last couple of lines with <span class="in">`tail()`</span></span>
<span id="cb37-256"><a href="#cb37-256" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-257"><a href="#cb37-257" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(gap_long)</span>
<span id="cb37-258"><a href="#cb37-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-259"><a href="#cb37-259" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-260"><a href="#cb37-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-261"><a href="#cb37-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-262"><a href="#cb37-262" aria-hidden="true" tabindex="-1"></a>That may seem trivial with this particular data frame, but sometimes you have 1</span>
<span id="cb37-263"><a href="#cb37-263" aria-hidden="true" tabindex="-1"></a>ID variable and 40 observation variables with irregular variable names. The</span>
<span id="cb37-264"><a href="#cb37-264" aria-hidden="true" tabindex="-1"></a>flexibility is a huge time saver!</span>
<span id="cb37-265"><a href="#cb37-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-266"><a href="#cb37-266" aria-hidden="true" tabindex="-1"></a><span class="fu">## Split the variable into many with `seperate()`</span></span>
<span id="cb37-267"><a href="#cb37-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-268"><a href="#cb37-268" aria-hidden="true" tabindex="-1"></a>Now <span class="in">`obstype_year`</span> actually contains 2 pieces of information, the observation</span>
<span id="cb37-269"><a href="#cb37-269" aria-hidden="true" tabindex="-1"></a>type (<span class="in">`pop`</span>,<span class="in">`lifeExp`</span>, or <span class="in">`gdpPercap`</span>) and the <span class="in">`year`</span>. We can use the</span>
<span id="cb37-270"><a href="#cb37-270" aria-hidden="true" tabindex="-1"></a><span class="in">`separate()`</span> function to split the character strings into multiple variables</span>
<span id="cb37-271"><a href="#cb37-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-274"><a href="#cb37-274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-275"><a href="#cb37-275" aria-hidden="true" tabindex="-1"></a>gap_long <span class="ot">&lt;-</span> gap_long <span class="sc">%&gt;%</span> </span>
<span id="cb37-276"><a href="#cb37-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(obstype_year, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">'obs_type'</span>, <span class="st">'year'</span>), <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb37-277"><a href="#cb37-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-278"><a href="#cb37-278" aria-hidden="true" tabindex="-1"></a>gap_long<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(gap_long<span class="sc">$</span>year)</span>
<span id="cb37-279"><a href="#cb37-279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-280"><a href="#cb37-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-281"><a href="#cb37-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-282"><a href="#cb37-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-283"><a href="#cb37-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-284"><a href="#cb37-284" aria-hidden="true" tabindex="-1"></a><span class="fu">## From long to intermediate format with `pivot_wider()`</span></span>
<span id="cb37-285"><a href="#cb37-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-286"><a href="#cb37-286" aria-hidden="true" tabindex="-1"></a>It is always good to check work. So, let's use the second <span class="in">`pivot`</span> function, <span class="in">`pivot_wider()`</span>, to 'widen' our observation variables back out.  <span class="in">`pivot_wider()`</span> is the opposite of <span class="in">`pivot_longer()`</span>, making a dataset wider by increasing the number of columns and decreasing the number of rows. We can use <span class="in">`pivot_wider()`</span> to pivot or reshape our <span class="in">`gap_long`</span> to the original intermediate format or the widest format. Let's start with the intermediate format.</span>
<span id="cb37-287"><a href="#cb37-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-288"><a href="#cb37-288" aria-hidden="true" tabindex="-1"></a>The <span class="in">`pivot_wider()`</span> function takes <span class="in">`names_from`</span> and <span class="in">`values_from`</span> arguments.</span>
<span id="cb37-289"><a href="#cb37-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-290"><a href="#cb37-290" aria-hidden="true" tabindex="-1"></a>To <span class="in">`names_from`</span> we supply the column name whose contents will be pivoted into new</span>
<span id="cb37-291"><a href="#cb37-291" aria-hidden="true" tabindex="-1"></a>output columns in the widened data frame. The corresponding values will be added</span>
<span id="cb37-292"><a href="#cb37-292" aria-hidden="true" tabindex="-1"></a>from the column named in the <span class="in">`values_from`</span> argument.</span>
<span id="cb37-293"><a href="#cb37-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-296"><a href="#cb37-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-297"><a href="#cb37-297" aria-hidden="true" tabindex="-1"></a>gap_normal <span class="ot">&lt;-</span> gap_long <span class="sc">%&gt;%</span></span>
<span id="cb37-298"><a href="#cb37-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> obs_type, <span class="at">values_from =</span> obs_values)</span>
<span id="cb37-299"><a href="#cb37-299" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(gap_normal)</span>
<span id="cb37-300"><a href="#cb37-300" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(gapminder)</span>
<span id="cb37-301"><a href="#cb37-301" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(gap_normal)</span>
<span id="cb37-302"><a href="#cb37-302" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(gapminder)</span>
<span id="cb37-303"><a href="#cb37-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-304"><a href="#cb37-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-305"><a href="#cb37-305" aria-hidden="true" tabindex="-1"></a>Now we've got an intermediate data frame <span class="in">`gap_normal`</span> with the same dimensions as</span>
<span id="cb37-306"><a href="#cb37-306" aria-hidden="true" tabindex="-1"></a>the original <span class="in">`gapminder`</span>, but the order of the variables is different. Let's fix</span>
<span id="cb37-307"><a href="#cb37-307" aria-hidden="true" tabindex="-1"></a>that before checking if they are <span class="in">`all.equal()`</span>.</span>
<span id="cb37-308"><a href="#cb37-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-311"><a href="#cb37-311" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-312"><a href="#cb37-312" aria-hidden="true" tabindex="-1"></a>gap_normal <span class="ot">&lt;-</span> gap_normal[, <span class="fu">names</span>(gapminder)]</span>
<span id="cb37-313"><a href="#cb37-313" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(gap_normal, gapminder)</span>
<span id="cb37-314"><a href="#cb37-314" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_normal)</span>
<span id="cb37-315"><a href="#cb37-315" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gapminder)</span>
<span id="cb37-316"><a href="#cb37-316" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-317"><a href="#cb37-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-318"><a href="#cb37-318" aria-hidden="true" tabindex="-1"></a>We're almost there, the original was sorted by <span class="in">`country`</span>, then</span>
<span id="cb37-319"><a href="#cb37-319" aria-hidden="true" tabindex="-1"></a><span class="in">`year`</span>.</span>
<span id="cb37-320"><a href="#cb37-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-323"><a href="#cb37-323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-324"><a href="#cb37-324" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(gap_normal, gapminder)</span>
<span id="cb37-325"><a href="#cb37-325" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-326"><a href="#cb37-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-327"><a href="#cb37-327" aria-hidden="true" tabindex="-1"></a>That's great! We've gone from the longest format back to the intermediate and we</span>
<span id="cb37-328"><a href="#cb37-328" aria-hidden="true" tabindex="-1"></a>didn't introduce any errors in our code.</span>
<span id="cb37-329"><a href="#cb37-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-330"><a href="#cb37-330" aria-hidden="true" tabindex="-1"></a><span class="fu">## Join the variables into one with `unite()`</span></span>
<span id="cb37-331"><a href="#cb37-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-332"><a href="#cb37-332" aria-hidden="true" tabindex="-1"></a>Now let's convert the long all the way back to the wide. In the wide format, we</span>
<span id="cb37-333"><a href="#cb37-333" aria-hidden="true" tabindex="-1"></a>will keep country and continent as ID variables and pivot the observations</span>
<span id="cb37-334"><a href="#cb37-334" aria-hidden="true" tabindex="-1"></a>across the 3 metrics (<span class="in">`pop`</span>,<span class="in">`lifeExp`</span>,<span class="in">`gdpPercap`</span>) and time (<span class="in">`year`</span>). First we</span>
<span id="cb37-335"><a href="#cb37-335" aria-hidden="true" tabindex="-1"></a>need to create appropriate labels for all our new variables (time<span class="sc">\*</span>metric</span>
<span id="cb37-336"><a href="#cb37-336" aria-hidden="true" tabindex="-1"></a>combinations) and we also need to unify our ID variables to simplify the process</span>
<span id="cb37-337"><a href="#cb37-337" aria-hidden="true" tabindex="-1"></a>of defining <span class="in">`gap_wide`</span>.</span>
<span id="cb37-338"><a href="#cb37-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-341"><a href="#cb37-341" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-342"><a href="#cb37-342" aria-hidden="true" tabindex="-1"></a>gap_temp <span class="ot">&lt;-</span> gap_long <span class="sc">%&gt;%</span> <span class="fu">unite</span>(var_ID, continent, country, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb37-343"><a href="#cb37-343" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gap_temp)</span>
<span id="cb37-344"><a href="#cb37-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-345"><a href="#cb37-345" aria-hidden="true" tabindex="-1"></a>gap_temp <span class="ot">&lt;-</span> gap_long <span class="sc">%&gt;%</span></span>
<span id="cb37-346"><a href="#cb37-346" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unite</span>(ID_var, continent, country, <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-347"><a href="#cb37-347" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unite</span>(var_names, obs_type, year, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb37-348"><a href="#cb37-348" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gap_temp)</span>
<span id="cb37-349"><a href="#cb37-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-350"><a href="#cb37-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-351"><a href="#cb37-351" aria-hidden="true" tabindex="-1"></a>Using <span class="in">`unite()`</span> we now have a single ID variable which is a combination of</span>
<span id="cb37-352"><a href="#cb37-352" aria-hidden="true" tabindex="-1"></a><span class="in">`continent`</span>,<span class="in">`country`</span>,and we have defined variable names. We're now ready to</span>
<span id="cb37-353"><a href="#cb37-353" aria-hidden="true" tabindex="-1"></a>pipe in <span class="in">`pivot_wider()`</span></span>
<span id="cb37-354"><a href="#cb37-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-357"><a href="#cb37-357" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-358"><a href="#cb37-358" aria-hidden="true" tabindex="-1"></a>gap_wide_new <span class="ot">&lt;-</span> gap_long <span class="sc">%&gt;%</span></span>
<span id="cb37-359"><a href="#cb37-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(ID_var, continent, country, <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-360"><a href="#cb37-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(var_names, obs_type, year, <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-361"><a href="#cb37-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> var_names, <span class="at">values_from =</span> obs_values)</span>
<span id="cb37-362"><a href="#cb37-362" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gap_wide_new)</span>
<span id="cb37-363"><a href="#cb37-363" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-364"><a href="#cb37-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-365"><a href="#cb37-365" aria-hidden="true" tabindex="-1"></a><span class="fu">## Challenge 2</span></span>
<span id="cb37-366"><a href="#cb37-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-367"><a href="#cb37-367" aria-hidden="true" tabindex="-1"></a>::: {.callout-important title="Take this 1 step further and create a <span class="in">`gap_ludicrously_wide`</span> format data by pivoting over countries, year and the 3 metrics?"}</span>
<span id="cb37-368"><a href="#cb37-368" aria-hidden="true" tabindex="-1"></a>::: </span>
<span id="cb37-369"><a href="#cb37-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-370"><a href="#cb37-370" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb37-371"><a href="#cb37-371" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hint </span></span>
<span id="cb37-372"><a href="#cb37-372" aria-hidden="true" tabindex="-1"></a>This new data frame should only have 5 rows.</span>
<span id="cb37-373"><a href="#cb37-373" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb37-374"><a href="#cb37-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-375"><a href="#cb37-375" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}    </span>
<span id="cb37-376"><a href="#cb37-376" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Solution to challenge 2</span></span>
<span id="cb37-377"><a href="#cb37-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-380"><a href="#cb37-380" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-381"><a href="#cb37-381" aria-hidden="true" tabindex="-1"></a>gap_ludicrously_wide <span class="ot">&lt;-</span> gap_long <span class="sc">%&gt;%</span></span>
<span id="cb37-382"><a href="#cb37-382" aria-hidden="true" tabindex="-1"></a>   <span class="fu">unite</span>(var_names, obs_type, year, country, <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-383"><a href="#cb37-383" aria-hidden="true" tabindex="-1"></a>   <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> var_names, <span class="at">values_from =</span> obs_values)</span>
<span id="cb37-384"><a href="#cb37-384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-385"><a href="#cb37-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-386"><a href="#cb37-386" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb37-387"><a href="#cb37-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-388"><a href="#cb37-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-389"><a href="#cb37-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-390"><a href="#cb37-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-391"><a href="#cb37-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-392"><a href="#cb37-392" aria-hidden="true" tabindex="-1"></a>Now we have a great 'wide' format data frame, but the <span class="in">`ID_var`</span> could be more</span>
<span id="cb37-393"><a href="#cb37-393" aria-hidden="true" tabindex="-1"></a>usable, let's separate it into 2 variables with <span class="in">`separate()`</span></span>
<span id="cb37-394"><a href="#cb37-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-397"><a href="#cb37-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-398"><a href="#cb37-398" aria-hidden="true" tabindex="-1"></a>gap_wide_betterID <span class="ot">&lt;-</span> <span class="fu">separate</span>(gap_wide_new, ID_var, <span class="fu">c</span>(<span class="st">"continent"</span>, <span class="st">"country"</span>), <span class="at">sep=</span><span class="st">"_"</span>)</span>
<span id="cb37-399"><a href="#cb37-399" aria-hidden="true" tabindex="-1"></a>gap_wide_betterID <span class="ot">&lt;-</span> gap_long <span class="sc">%&gt;%</span></span>
<span id="cb37-400"><a href="#cb37-400" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unite</span>(ID_var, continent, country, <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-401"><a href="#cb37-401" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unite</span>(var_names, obs_type, year, <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-402"><a href="#cb37-402" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> var_names, <span class="at">values_from =</span> obs_values) <span class="sc">%&gt;%</span></span>
<span id="cb37-403"><a href="#cb37-403" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(ID_var, <span class="fu">c</span>(<span class="st">"continent"</span>,<span class="st">"country"</span>), <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb37-404"><a href="#cb37-404" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(gap_wide_betterID)</span>
<span id="cb37-405"><a href="#cb37-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-406"><a href="#cb37-406" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(gap_wide, gap_wide_betterID)</span>
<span id="cb37-407"><a href="#cb37-407" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-408"><a href="#cb37-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-409"><a href="#cb37-409" aria-hidden="true" tabindex="-1"></a>There and back again!</span>
<span id="cb37-410"><a href="#cb37-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-411"><a href="#cb37-411" aria-hidden="true" tabindex="-1"></a><span class="fu">## Other great resources</span></span>
<span id="cb37-412"><a href="#cb37-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-413"><a href="#cb37-413" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">R for Data Science</span><span class="co">](https://r4ds.hadley.nz/)</span> (online book)</span>
<span id="cb37-414"><a href="#cb37-414" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Data Wrangling Cheat sheet</span><span class="co">](https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf)</span> (pdf file)</span>
<span id="cb37-415"><a href="#cb37-415" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Introduction to tidyr</span><span class="co">](https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html)</span> (online documentation)</span>
<span id="cb37-416"><a href="#cb37-416" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Data wrangling with R and RStudio</span><span class="co">](https://www.rstudio.com/resources/webinars/data-wrangling-with-r-and-rstudio/)</span> (online video)</span>
<span id="cb37-417"><a href="#cb37-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-418"><a href="#cb37-418" aria-hidden="true" tabindex="-1"></a><span class="fu">## Keypoints</span></span>
<span id="cb37-419"><a href="#cb37-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-420"><a href="#cb37-420" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use the <span class="in">`tidyr`</span> package to change the layout of data frames.</span>
<span id="cb37-421"><a href="#cb37-421" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`pivot_longer()`</span> to go from wide to longer layout.</span>
<span id="cb37-422"><a href="#cb37-422" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use <span class="in">`pivot_wider()`</span> to go from long to wider layout.</span>
<span id="cb37-423"><a href="#cb37-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-424"><a href="#cb37-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-425"><a href="#cb37-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-426"><a href="#cb37-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-427"><a href="#cb37-427" aria-hidden="true" tabindex="-1"></a><span class="fu">#### R Session info</span></span>
<span id="cb37-428"><a href="#cb37-428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-429"><a href="#cb37-429" aria-hidden="true" tabindex="-1"></a><span class="in">sessionInfo()</span></span>
<span id="cb37-430"><a href="#cb37-430" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-431"><a href="#cb37-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-432"><a href="#cb37-432" aria-hidden="true" tabindex="-1"></a>############## END</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>